(function(){var m;function aa(a){var b=16,c;if(a){b||(b=16);if("$"==a.charAt(0))b=16,a=a.substr(1);else if("0x"==a.substr(0,2))b=16,a=a.substr(2);else{var d=a.charAt(a.length-1).toLowerCase();"h"==d?(b=16,d=null):"."==d&&(b=10,d=null);null==d&&(a=a.substr(0,a.length-1))}var e,d=a,f=b;(f&&10!=f?16==f?null!==d.match(/^[0-9a-f]+$/i):2==f&&null!==d.match(/^[01]+$/i):null!==d.match(/^[0-9]+$/))&&!isNaN(e=parseInt(a,b))&&(c=e|0)}return c}
function ba(a,b){var c="";void 0===b?b=8:8<b&&(b=8);if(null==a||isNaN(a))for(;0<b--;)c="?"+c;else for(;0<b--;){var d=a&15,d=d+(0<=d&&9>=d?48:55),c=String.fromCharCode(d)+c;a>>=4}return c}function ca(a,b){var c=a,d=a.lastIndexOf("/");0<=d&&(c=a.substr(d+1));d=c.indexOf("&");0<d&&(c=c.substr(0,d));b&&(d=c.lastIndexOf("."),0<d&&(c=c.substring(0,d)));return c}function da(a){var b="",c=a.lastIndexOf(".");0<=c&&(b=a.substr(c+1).toLowerCase());return b}
function ea(a,b){return-1!==a.indexOf(b,a.length-b.length)}var fa={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#039;"};function ga(a){return a.replace(/[&<>"']/g,function(a){return fa[a]})}var ha=Date.now||function(){return+new Date};function ia(){function a(a){return(10>a?"0":"")+a}var b=new Date;return b.getFullYear()+"-"+a(b.getMonth()+1)+"-"+a(b.getDate())+" "+a(b.getHours())+":"+a(b.getMinutes())+":"+a(b.getSeconds())}
function n(a,b,c,d){var e=0,f=null,h=null;if("object"==typeof resources&&(f=resources[a]))return d&&d(a,f,e),[f,e];if(c&&"function"==typeof resources)return resources(a,function(b,c){d&&d(a,b,c)}),h;var g=window.XMLHttpRequest?new window.XMLHttpRequest:new window.ActiveXObject("Microsoft.XMLHTTP");c&&(g.onreadystatechange=function(){4===g.readyState&&(f=g.responseText,200==g.status||!g.status&&f.length&&"file:"==(window?window.location.protocol:"file:")||(e=g.status||-1),d&&d(a,f,e))});if(b&&"object"==
typeof b){var k="",l;for(l in b)b.hasOwnProperty(l)&&(k&&(k+="&"),k+=l+"="+encodeURIComponent(b[l]));k=k.replace(/%20/g,"+");g.open("POST",a,!!c);g.setRequestHeader("Content-type","application/x-www-form-urlencoded");g.send(k)}else g.open("GET",a,!!c),"bytes"==b&&g.overrideMimeType("text/plain; charset=x-user-defined"),g.send();c||(f=g.responseText,200!=g.status&&(e=g.status||-1),d&&d(a,f,e),h=[f,e]);return h}function ja(){return"http://"+(window?window.location.host:"www.pcjs.org")}
function p(a){window&&window.alert(a)}function ka(a){var b=!1;window&&(b=window.confirm(a));return b}var la=null;function ma(){if(null==la){var a=!1;if(window)try{window.localStorage.setItem("PCjs.localStorage","PCjs.localStorage"),a="PCjs.localStorage"==window.localStorage.getItem("PCjs.localStorage"),window.localStorage.removeItem("PCjs.localStorage")}catch(b){a=!1}la=a}return la}function na(a){var b;if(window)try{b=window.localStorage.getItem(a)}catch(c){}return b}
function oa(a,b){try{return window.localStorage.setItem(a,b),!0}catch(c){}return!1}function pa(a){if(window){var b=window?window.navigator.userAgent:"";return"iOS"==a&&b.match(/(iPod|iPhone|iPad)/)&&b.match(/AppleWebKit/)||"MSIE"==a&&b.match(/(MSIE|Trident)/)||0<=b.indexOf(a)?!0:!1}return!1}var q={init:[],show:[],exit:[]},qa=!1,ra=!0;function sa(a,b){if(window){var c=window[a];window[a]="function"!==typeof c?b:function(){c&&c();b()}}}function ta(a){q.init.push(a)}
function ua(a){if(ra)try{for(var b=0;b<a.length;b++)a[b]()}catch(c){p("An unexpected exception occurred:\n\n"+c.message+"\n\nPlease send this information to support@pcjs.org. Thanks.")}}function va(a){!ra&&a?(ra=!0,qa&&wa("init")):ra=a}function wa(a){q[a]&&ua(q[a])}sa("onload",function(){qa=!0;ua(q.init)});sa("onpageshow",function(){ua(q.show)});sa(pa("Opera")||pa("iOS")?"onunload":"onbeforeunload",function(){ua(q.exit)});
function r(a,b,c){this.type=a;b||(b={id:"",name:""});this.id=b.id;this.name=b.name;this.La=b.comment;this.Wa=b;void 0===this.id&&(this.id="");b=this.id.indexOf(".");0<b?(this.Na=this.id.substr(0,b),this.Ma=this.id.substr(b+1)):this.Ma=this.id;this[a]=c;this.g={da:!1,la:!1,Fa:!1,H:!1,$:!1};this.za=null;this.g.$=!1;this.v={};this.J=null;t.push(this)}var xa=void 0,ya={};
if(window){xa||(xa=window.location.search.substr(1));for(var za,Aa=/\+/g,Ba=/([^&=]+)=?([^&]*)/g;za=Ba.exec(xa);)ya[decodeURIComponent(za[1].replace(Aa," "))]=decodeURIComponent(za[2].replace(Aa," "))}function Ca(a){function b(){}if(window){if(!a)throw new TypeError;if(Object.create)return Object.create(a);var c=typeof a;if("object"!==c&&"function"!==c)throw new TypeError;}b.prototype=a;return new b}
function u(a,b){b||(b=r);a.prototype=Ca(b.prototype);a.prototype.constructor=a;a.prototype.parent=b.prototype}var t=[],Da={};function Ea(a,b,c){Da[a]&&b&&(Da[a][b]=c)}function v(a){var b,c=[];a&&(a=0<(b=a.indexOf("."))?a.substr(0,b+1):"");for(b=0;b<t.length;b++){var d=t[b];a&&d.id.indexOf(a)||c.push(d)}return c}
function Fa(a,b){var c;if(void 0!==a){var d;b&&(b=0<(d=b.indexOf("."))?b.substr(0,d+1):"");for(d=0;d<t.length;d++)if(c)c==t[d]&&(c=null);else if(!(a!=t[d].type||b&&t[d].id.indexOf(b)))return t[d]}return null}function w(a){var b=null;if(a=a.getAttribute("data-value"))try{b=eval("("+a+")")}catch(c){p(c.message+" ("+a+")")}return b}
function Ga(a,b){for(var c=y(b.parentNode,"pc8080-control"),d=0;d<c.length;d++)for(var e=c[d].childNodes,f=0;f<e.length;f++){var h=e[f];if(1===h.nodeType){var g=h.getAttribute("class");if(g)for(var k=g.split(" "),l=0;l<k.length;l++)switch(g=k[l],g){case "pc8080-binding":(g=w(h))&&g.binding&&a.M(g.type,g.binding,h,g.value),l=k.length}}}}
function y(a,b,c){c&&(b+="-"+c+"-object");if(a.getElementsByClassName)return a.getElementsByClassName(b);var d;c=[];a=a.getElementsByTagName("*");var e=new RegExp("(^| )"+b+"( |$)");b=0;for(d=a.length;b<d;b++)e.test(a[b].className)&&c.push(a[b]);return c}
r.prototype={constructor:r,parent:null,toString:function(){return this.name?this.name:this.id||this.type},M:function(a,b,c){switch(b){case "clear":return this.v[b]||(this.v[b]=c,c.onclick=function(a){return function(){a.v.print&&(a.v.print.value="")}}(this)),!0;case "print":return this.v[b]||(this.Ea=this.v[b]=c,c.value="",this.L=function(a){return function(b,c){8192<a.value.length&&(a.value=a.value.substr(a.value.length-4096));a.value+=(void 0!==c?c+": ":"")+(b||"")+"\n";a.scrollTop=a.scrollHeight}}(c),
this.I=function(a,b,c){this.L(a,"notice",c)}),!0;default:return!1}},log:function(){},L:function(){},status:function(a){this.L(this.Ma+": "+a)},I:function(a,b){b||p(a)},X:function(){return this.g.H=!0},W:function(a,b){b&&(this.g.H=!1);return!0}};function Ha(a,b){if(a.g.Fa)return a.g.la&&(a.g.la=!1),a.g.Fa=!1;if(a.g.$)return a.L(a.toString()+" error"),!1;a.g.la=b;return a.g.la}function z(a){if(!a.g.$&&(a.g.da=!0,a.g.da)){var b=a.za;a.za=null;b&&b()}}
function Ia(a,b){b&&(a.g.da?b():a.za=b);return a.g.da}
var Ja="undefined"!==typeof ArrayBuffer,Ka=[1,0,0,1,0,1,1,0,0,1,1,0,1,0,0,1,0,1,1,0,1,0,0,1,1,0,0,1,0,1,1,0,0,1,1,0,1,0,0,1,1,0,0,1,0,1,1,0,1,0,0,1,0,1,1,0,0,1,1,0,1,0,0,1,0,1,1,0,1,0,0,1,1,0,0,1,0,1,1,0,1,0,0,1,0,1,1,0,0,1,1,0,1,0,0,1,1,0,0,1,0,1,1,0,0,1,1,0,1,0,0,1,0,1,1,0,1,0,0,1,1,0,0,1,0,1,1,0,0,1,1,0,1,0,0,1,1,0,0,1,0,1,1,0,1,0,0,1,0,1,1,0,0,1,1,0,1,0,0,1,1,0,0,1,0,1,1,0,0,1,1,0,1,0,0,1,0,1,1,0,1,0,0,1,1,0,0,1,0,1,1,0,1,0,0,1,0,1,1,0,0,1,1,0,1,0,0,1,0,1,1,0,1,0,0,1,1,0,0,1,0,1,1,0,0,1,1,0,1,
0,0,1,1,0,0,1,0,1,1,0,1,0,0,1,0,1,1,0,0,1,1,0,1,0,0,1];function La(a){r.call(this,"Panel",a,La)}u(La);m=La.prototype;m.M=function(a,b,c,d){return this.w&&this.w.M(a,b,c,d)||this.a&&this.a.M(a,b,c,d)||this.b&&this.b.M(a,b,c,d)?!0:this.parent.M.call(this,a,b,c,d)};m.ma=function(a,b,c,d){this.w=a;this.C=b;this.a=c;this.J=d;this.b=Ma(a,"Keyboard")};m.X=function(a,b){b||Na();return!0};m.W=function(){return!0};m.ca=function(){};
function Na(){for(var a=!1,b=y(document,"pc8080","panel"),c=0;c<b.length;c++){var d=b[c],e=w(d),f;a:{f=e.id;if(void 0!==f)for(var h=void 0,h=0;h<t.length;h++)if(t[h].id===f){f=t[h];break a}f=null}f||(a=!0,f=new La(e));Ga(f,d);a&&z(f)}}ta(Na);
function Oa(a,b,c){r.call(this,"Bus",a,Oa);this.a=b;this.J=c;this.f=a.buswidth||16;this.i=Math.pow(2,this.f);this.h=this.i-1|0;this.F=20>=this.f?12:24>=this.f?14:15;this.D=1<<this.F;this.j=this.D>>2;this.l=this.D-1;this.c=this.i/this.D|0;this.m=[];this.s=[];this.o=[];this.u=[];a=new A;Pa(a,this.J);this.b=Array(this.c);for(b=0;b<this.c;b++)this.b[b]=a;a=this.a;b=this.b;c=this.F;var d=this.h;a.K=b;a.F=c;a.D=1<<a.F;a.P=a.D-1;a.wa=b.length;a.ja=a.wa-1;a.Y=d;z(this)}u(Oa);Oa.prototype.reset=function(){};
Oa.prototype.X=function(a,b){b||this.reset();return!0};function Ra(a,b,c,d){for(var e=b>>>a.F;0<c&&e<a.b.length;){var f=a.b[e],h=e*a.D,g=c>a.D?a.D:c;if(f&&f.size){if(f.type==d){if(b+c<=f.ka)return f.Da+=f.ka-b,f.ka=b,!0;if(b>=f.ka+f.Da){g=f.size-(b-h);g>c&&(g=c);f.Da=b-f.ka+g;c-=g;b=h+a.D;continue}}return Sa(1,b,c)}f=a.b[e];b=new A(b,g,a.D,d);Pa(b,a.J,f);a.b[e++]=b;b=h+a.D;c-=g}return 0>=c?!0:Sa(2,b,c)}function Sa(a,b,c){p("Memory block error ("+a+": "+ba(b)+","+ba(c)+")");return!1}var Ta;
if(Ja){var Ua=new ArrayBuffer(2);(new DataView(Ua)).setUint16(0,256,!0);Ta=256===(new Uint16Array(Ua))[0]}else Ta=!1;var Va=Ta;
function A(a,b,c,d){this.id=Wa+=2;this.a=null;this.ka=a;this.Da=b;this.size=c||0;this.type=d||Xa;this.h=d==Ya;Pa(this);this.V=this.eb=!1;if(c)if(Ja)this.c=new ArrayBuffer(c),this.f=new DataView(this.c,0,c),this.b=new Uint8Array(this.c,0,c),this.l=new Uint16Array(this.c,0,c>>1),this.a=new Int32Array(this.c,0,c>>2),Za(this,Va?$a:ab);else{this.a=Array(c>>2);for(a=0;a<this.a.length;a++)this.a[a]=0;Za(this,bb)}else Za(this)}var Xa=0,Ya=2,Wa=0;
A.prototype={constructor:A,parent:null,save:function(){var a,b;if(Ja)for(a=Array(this.size>>2),b=0;b<a.length;b++)a[b]=this.f.getInt32(b<<2,!0);else a=this.a;return a},restore:function(a){if(a&&this.size==a.length<<2){var b;if(Ja)for(b=0;b<a.length;b++)this.f.setInt32(b<<2,a[b],!0);else this.a=a;return this.V=!0}return!1},m:function(){return 255},s:function(){},o:function(a,b){return this.ua(a++,b++)|this.ua(a,b)<<8},v:function(a,b,c){this.va(a++,b&255,c++);this.va(a,b>>8,c)},B:function(a){return this.a[a>>
2]>>>((a&3)<<3)&255},N:function(a){var b=a>>2;a=(a&3)<<3;var c=this.a[b]>>a;return 24>a?c&65535:c&255|(this.a[b+1]&255)<<8},T:function(a,b){var c=a>>2,d=(a&3)<<3;this.a[c]=this.a[c]&~(255<<d)|b<<d;this.V=!0},wa:function(a,b){var c=a>>2,d=(a&3)<<3;24>d?this.a[c]=this.a[c]&~(65535<<d)|b<<d:(this.a[c]=this.a[c]&16777215|b<<24,c++,this.a[c]=this.a[c]&-256|b>>8);this.V=!0},C:function(a,b){return this.w(a,b)},F:function(a,b){return this.G(a,b)},R:function(a,b,c){this.h||this.Za(a,b,c)},Y:function(a,b,c){this.h||
this.Z(a,b,c)},u:function(a){return this.b[a]},A:function(a){return this.b[a]},D:function(a){return this.f.getUint16(a,!0)},K:function(a){return a&1?this.b[a]|this.b[a+1]<<8:this.l[a>>1]},P:function(a,b){this.b[a]=b;this.V=!0},S:function(a,b){this.b[a]=b;this.V=!0},U:function(a,b){this.f.setUint16(a,b,!0);this.V=!0},ja:function(a,b){a&1?(this.b[a]=b,this.b[a+1]=b>>8):this.l[a>>1]=b;this.V=!0}};function Pa(a,b,c){a.J=b;a.i=a.j=0;c&&((a.i=c.i)&&cb(a,db,!1),(a.j=c.j)&&eb(a,db,!1))}
function eb(a,b,c){c&&a.j||(a.va=!a.h&&b[2]||a.s,a.ib=!a.h&&b[3]||a.v);if(c||void 0===c)a.Za=b[2]||a.s,a.Z=b[3]||a.v}function cb(a,b,c){c&&a.i||(a.ua=b[0]||a.m,a.gb=b[1]||a.o);if(c||void 0===c)a.w=b[0]||a.m,a.G=b[1]||a.o}function Za(a,b){b||(b=fb);cb(a,b,void 0);eb(a,b,void 0)}var fb=[],bb=[A.prototype.B,A.prototype.N,A.prototype.T,A.prototype.wa],db=[A.prototype.C,A.prototype.F,A.prototype.R,A.prototype.Y];
if(Ja)var ab=[A.prototype.u,A.prototype.D,A.prototype.P,A.prototype.U],$a=[A.prototype.A,A.prototype.K,A.prototype.S,A.prototype.ja];
function gb(a,b){r.call(this,"CPU",a,gb);var c=a.cycles||b,d=a.multiplier||1;this.c={};this.c.ia=c;this.c.ha=d;this.c.Ga=Math.round(this.c.ia/1E4)/100;this.c.ea=this.c.Ga*this.c.ha;this.g.O=!1;this.g.Ra=!1;this.g.Pa=a.autoStart;this.g.Qa=!1;this.g.xa=!1;this.c.Ba=this.c.ga=0;this.c.Ca=a.csStart;this.c.na=a.csInterval;this.c.oa=a.csStop;this.bb=this.Ja.bind(this);z(this)}u(gb);var hb=["power","reset"];m=gb.prototype;
m.ma=function(a,b,c,d){this.w=a;this.C=b;this.J=d;for(b=0;b<hb.length;b++)(c=this.v[hb[b]])&&this.w.M(null,hb[b],c);Ma(a,"FPU");this.G=Ma(a,"ChipSet");a=ib(a,"autoStart");null!=a&&(this.g.Pa="true"==a?!0:"false"==a?!1:!!a);z(this)};m.reset=function(){};m.save=function(){return null};m.restore=function(){return!1};m.X=function(a,b){if(!b){if(a&&this.restore){jb(this);if(!this.restore(a))return!1;kb(this)}else this.reset();this.L("No debugger detected")}lb(this);return!0};
m.W=function(a){return a?this.save():!0};function mb(a){(a.g.Pa||void 0===a.v.run)&&a.Ja()}m.Sa=function(){return 0};function kb(a){void 0===a.c.Ca&&(a.c.Ca=0);void 0===a.c.na&&(a.c.na=-1);void 0===a.c.oa&&(a.c.oa=-1);a.g.xa=0<=a.c.Ca&&0<a.c.na;a.g.xa&&(a.c.Ba=0,a.c.ga=a.c.Ca-a.S)}
m.M=function(a,b,c){var d=this;a=!1;switch(b){case "power":case "reset":this.v[b]=c;a=!0;break;case "run":this.v[b]=c;c.onclick=function(){var a;if(a=d.w)if(a=d.w,a.g.H)a=!0;else{var b=null,c,g=v(a.id);for(c=0;c<g.length&&(b=g[c],b===a||b.g.da);c++);if(c==g.length)for(c=0;c<g.length&&(b=g[c],b===a||b.g.H);c++);c==g.length&&(b=a);p("The "+b.type+" component ("+b.id+") is not "+(b.g.da?"powered yet":"ready yet"+(b.za?" (waiting for notification)":""))+".");a=!1}a&&(d.g.O?nb(d,!0):d.Ja())};a=!0;break;
case "speed":this.v[b]=c;a=!0;break;case "setSpeed":this.v[b]=c,c.onclick=function(){ob(d,d.c.ha<<1)},c.textContent=this.c.ea.toFixed(2)+"Mhz",a=!0}return a};function pb(a,b,c){a.S+=b;c&&(a.R=a.a=0)}function qb(a,b){var c=30;60>c&&(c=60);2>c&&(c=2);var d=1;b&&1<a.c.ha&&a.c.aa&&(d=a.c.aa/a.c.Ga);a.c.Ta=Math.round(1E3/30);a.c.fb=Math.floor(a.c.ia/c*d);a.c.Ha=Math.floor(a.c.ia/30*d);a.c.Va=Math.floor(a.c.ia/60*d);a.c.Ua=Math.floor(a.c.ia/2*d);b||(a.c.ra=a.c.Ha,a.c.qa=a.c.Va,a.c.pa=a.c.Ua);a.c.Ia=0}
function rb(a){return a.S+a.N+a.R-a.a}function jb(a){a.c.aa=0;a.S=a.N=a.R=a.a=0;kb(a);ob(a,1)}function ob(a,b){if(void 0!==b){.8>a.c.aa/a.c.ea&&(b=1);a.c.ha=b;var c=a.c.Ga*a.c.ha;if(a.c.ea!=c){a.c.ea=c;var c=a.c.ea.toFixed(2)+"Mhz",d=a.v.setSpeed;d&&(d.textContent=c);a.L("target speed: "+c)}}pb(a,a.N);a.N=0;a.c.fa=ha();a.c.ba=0;qb(a)}
m.Ja=function(){if(Ha(this,!0)){if(!this.g.O){ob(this);this.w&&this.w.start(this.c.fa,rb(this));this.g.O=!0;this.g.Ra=!0;this.G&&this.G.hb();var a=this.v.run;a&&(a.textContent="Halt");this.w&&this.w.ca(!0)}this.c.Ia>=this.c.ia&&qb(this,!0);this.c.sa=0;this.c.Aa=ha();this.c.ba&&(a=this.c.Aa-this.c.ba,a>this.c.Ta&&(this.c.fa+=a,this.c.fa>this.c.Aa&&(this.c.fa=this.c.Aa)));try{do{var b=this.g.xa?1:this.c.fb;this.G&&(this.G.Ya(),b=this.G.kb(0,b),b=this.G.jb(b));try{this.Xa(b)}catch(e){if("number"!=typeof e)throw e;
}var c=this.R-this.a;this.N+=c;this.c.sa+=c;pb(this,0,!0);a=c;if(this.g.xa){var d=!1;this.c.Ba=this.c.Ba+this.Sa()|0;this.c.ga-=a;0>=this.c.ga&&(this.c.ga+=this.c.na,d=!0);0<=this.c.oa&&this.c.oa<=rb(this)&&(this.c.na=this.c.oa=-1,kb(this),nb(this),d=!0);d&&this.L(rb(this)+" cycles: checksum="+ba(this.c.Ba))}this.c.qa-=c;0>=this.c.qa&&(this.c.qa+=this.c.Va);this.c.pa-=c;0>=this.c.pa&&(this.c.pa+=this.c.Ua,this.w&&this.w.ca());this.c.ra-=c;if(0>=this.c.ra){this.c.ra+=this.c.Ha;break}}while(this.g.O)}catch(e){nb(this);
lb(this);this.w&&this.w.stop(ha(),rb(this));Ha(this,!1);b=e.stack||e.message;this.g.$=!0;this.I(b);return}b=setTimeout;c=this.bb;this.c.ba=ha();a=this.c.Ta;this.c.sa&&(a=Math.round(a*this.c.sa/this.c.Ha));a-=this.c.ba-this.c.Aa;if(d=this.c.ba-this.c.fa)this.c.aa=Math.round(this.N/(10*d))/100,864E5<=d&&(this.S=0,this.G&&this.G.Ya(!0),ob(this));if(0>a||this.c.aa<this.c.ea)a=0;this.c.Ia+=this.c.sa;this.c.ba+=a;b(c,a)}else lb(this),this.w&&this.w.stop(ha(),rb(this))};m.Xa=function(){return 0};
function nb(a,b){a.g.la&&(a.g.Fa=!0);a.R-=a.a;a.a=0;pb(a,a.N);a.N=0;if(a.g.O){a.g.O=!1;a.G&&a.G.hb();var c=a.v.run;c&&(c.textContent="Run")}a.g.ya=b}function lb(a){a.w&&a.w.ca(void 0)}function sb(a){this.ab=a.model||8080;gb.call(this,a,1E6);this.$a=tb;jb(this);this.g.ya=this.g.cb=!1;this.Ka=0;this.K=[];this.F=this.D=this.P=this.wa=this.ja=this.Y=0;ub(this)}u(sb,gb);m=sb.prototype;m.reset=function(){this.g.O&&nb(this);ub(this);jb(this);this.g.$=!1};
function ub(a){a.b=0;a.h=0;a.i=0;a.j=0;a.l=0;a.m=0;a.o=0;a.A=0;B(a,0);vb(a,0);a.U=0}m.Sa=function(){var a=this.b+this.h+this.i+this.j+this.l+this.m+this.o|0;return a=a+this.A+this.u+wb(this)|0};
m.save=function(){var a=new C(this);D(a,0,[this.b,this.h,this.i,this.j,this.l,this.m,this.o,this.A,this.u,wb(this)]);D(a,1,[this.Z,this.U,this.S,this.c.ha]);for(var b=this.C,c=0,d=[],e=0;e<b.c;e++){var f=b.b[e];if(f.V||f.eb){d[c++]=e;var h=c++;a:if(f=f.save()){for(var g=0,k=0,l=[];g<f.length;){for(var H=f[g],x=g+1;x<f.length&&f[x]===H;)x++;l[k++]=x-g;l[k++]=H;g=x}if(l.length<f.length){f=l;break a}}d[h]=f}}D(a,2,d);return a.data()};
m.restore=function(a){var b=a[0];this.b=b[0];this.h=b[1];this.i=b[2];this.j=b[3];this.l=b[4];this.m=b[5];this.o=b[6];this.A=b[7]&65535;B(this,b[8]);vb(this,b[9]);b=a[1];this.Z=b[0];this.U=b[1];this.S=b[2];ob(this,b[3]);a:{b=this.C;a=a[2];var c;for(c=0;c<a.length-1;c+=2){var d=a[c],e=a[c+1];if(e&&e.length<b.j){for(var f=0,h=Array(b.j),g=0;g<e.length-1;)for(var k=e[g++],l=e[g++];k--;)h[f++]=l;e=h}f=b.b[d];if(!f||!f.restore(e)){p("Unable to restore memory block "+d);b=!1;break a}}b=!0}return b};
m.M=function(a,b,c){var d=!1;switch(b){case "A":case "B":case "C":case "D":case "E":case "H":case "L":case "SP":case "PC":case "F":case "SF":case "ZF":case "AF":case "PF":case "CF":this.v[b]=c;this.Ka++;d=!0;break;default:d=this.parent.M.call(this,a,b,c)}return d};function xb(a){return a.h<<8|a.i}function yb(a,b){a.h=b>>8&255;a.i=b&255}function zb(a){return a.j<<8|a.l}function Ab(a,b){a.j=b>>8&255;a.l=b&255}function E(a){return a.m<<8|a.o}function F(a,b){a.m=b>>8&255;a.o=b&255}
function B(a,b){a.u=b&65535}function G(a){return a.f&256?1:0}function Bb(a){return Ka[a.s&255]?4:0}function wb(a){return a.T&-214|(a.s&128?128:0)|(a.f&255?0:64)|((a.s^a.B)&16?16:0)|Bb(a)|G(a)}function vb(a,b){a.f=a.s=a.B=0;b&1&&(a.f|=256);b&4||(a.s|=1);b&16&&(a.B|=16);b&64||(a.f|=255);b&128&&(a.s^=192);a.T=a.T&-513|b&512|2}function I(a,b){a.B=a.b^b;return(a.f=a.s=a.b+b)&255}function J(a,b){a.B=a.b^b;return(a.f=a.s=a.b+b+(a.f&256?1:0))&255}function K(a,b){return a.f=a.s=a.B=a.b&b}
function L(a,b){a.B=a.b^b;a.f=a.s=a.b-b}function M(a,b){a.B=b;b=(a.s=b-1)&255;a.f=a.f&-256|b;return b}function N(a,b){a.B=b;b=(a.s=b+1)&255;a.f=a.f&-256|b;return b}function O(a,b){return a.f=a.s=a.B=a.b|b}function P(a,b){a.B=a.b^b;return(a.f=a.s=a.b-b)&255}function Q(a,b){a.B=a.b^b;return(a.f=a.s=a.b-b-(a.f&256?1:0))&255}function R(a,b){return a.f=a.s=a.B=a.b^b}function S(a,b){return a.K[(b&a.Y)>>>a.F].ua(b&a.P,b)}
function Cb(a,b){var c=b&a.P,d=(b&a.Y)>>>a.F;if(c<a.P)return a.K[d].gb(c,b);c=a.K[d].ua(c,b);return c|=a.K[d+1&a.ja].ua(0,b+1)<<8}function T(a,b,c){a.K[(b&a.Y)>>>a.F].va(b&a.P,c&255,b)}function Db(a,b,c){var d=b&a.P,e=(b&a.Y)>>>a.F;d<a.P?a.K[e].ib(d,c&65535,b):(a.K[e++].va(d,c&255,b),a.K[e&a.ja].va(0,c>>8&255,b+1))}function U(a){var b=S(a,a.u);B(a,a.u+1);return b}function V(a){var b=Cb(a,a.u);B(a,a.u+2);return b}function W(a){var b=Cb(a,a.A);a.A=a.A+2&65535;return b}
function X(a,b){a.A=a.A-2&65535;Db(a,a.A,b)}function Y(a,b,c,d){d=d||2;a.v[b]&&(void 0===c&&(a.g.$=!0,a.I("Value for "+b+" is invalid"),nb(a)),c=!a.g.O||a.g.Qa?ba(c,d):"--------".substr(0,d),a.v[b].textContent!=c&&(a.v[b].textContent=c))}
m.ca=function(a){this.Ka&&(a||!this.g.O||this.g.Qa)&&(Y(this,"A",this.b),Y(this,"B",this.h),Y(this,"C",this.i),Y(this,"D",this.j),Y(this,"E",this.l),Y(this,"H",this.m),Y(this,"L",this.o),Y(this,"SP",this.A,4),Y(this,"PC",this.u,4),a=wb(this),Y(this,"F",a,2),Y(this,"SF",a&128,1),Y(this,"ZF",a&64,1),Y(this,"AF",a&16,1),Y(this,"PF",a&4,1),Y(this,"CF",a&1,1));if(a=this.v.speed)a.textContent=this.g.O&&this.c.aa?this.c.aa.toFixed(2)+"Mhz":"Stopped"};
m.Xa=function(a){this.g.ya=!0;this.g.cb=!1;this.g.Ra=!1;this.R=this.a=a;this.G&&!a&&this.G.Ya();a||(this.Z|=4);do{if(this.U&&this.U&4){this.Z=this.a=0;break}this.Z=0;this.$a[U(this)].call(this)}while(0<this.a);return this.g.ya?this.R-this.a:void 0===this.g.ya?0:-1};ta(function(){for(var a=y(document,"pc8080","cpu"),b=0;b<a.length;b++){var c=a[b],d=w(c),d=new sb(d);Ga(d,c)}});function Eb(){this.a-=4}function Fb(){B(this,V(this));this.a-=10}function Gb(){B(this,W(this));this.a-=10}
function Hb(){var a=V(this);X(this,this.u);B(this,a);this.a-=17}
var tb=[Eb,function(){yb(this,V(this));this.a-=10},function(){T(this,xb(this),this.b);this.a-=7},function(){yb(this,xb(this)+1);this.a-=5},function(){this.h=N(this,this.h);this.a-=5},function(){this.h=M(this,this.h);this.a-=5},function(){this.h=U(this);this.a-=7},function(){var a=this.b<<1;this.b=a&255|a>>8;this.f=this.f&255|a&256;this.a-=4},Eb,function(){var a;F(this,a=E(this)+xb(this));this.f=this.f&255|a>>8&256;this.a-=10},function(){this.b=S(this,xb(this));this.a-=7},function(){yb(this,xb(this)-
1);this.a-=5},function(){this.i=N(this,this.i);this.a-=5},function(){this.i=M(this,this.i);this.a-=5},function(){this.i=U(this);this.a-=7},function(){var a=this.b<<8&256;this.b=(a|this.b)>>1;this.f=this.f&255|a;this.a-=4},Eb,function(){Ab(this,V(this));this.a-=10},function(){T(this,zb(this),this.b);this.a-=7},function(){Ab(this,zb(this)+1);this.a-=5},function(){this.j=N(this,this.j);this.a-=5},function(){this.j=M(this,this.j);this.a-=5},function(){this.j=U(this);this.a-=7},function(){var a=this.b<<
1;this.b=a&255|this.f>>8;this.f=this.f&255|a&256;this.a-=4},Eb,function(){var a;F(this,a=E(this)+zb(this));this.f=this.f&255|a>>8&256;this.a-=10},function(){this.b=S(this,zb(this));this.a-=7},function(){Ab(this,zb(this)-1);this.a-=5},function(){this.l=N(this,this.l);this.a-=5},function(){this.l=M(this,this.l);this.a-=5},function(){this.l=U(this);this.a-=7},function(){var a=this.b<<8&256;this.b=(this.f&256|this.b)>>1;this.f=this.f&255|a;this.a-=4},Eb,function(){F(this,V(this));this.a-=10},function(){Db(this,
V(this),E(this));this.a-=16},function(){F(this,E(this)+1);this.a-=5},function(){this.m=N(this,this.m);this.a-=5},function(){this.m=M(this,this.m);this.a-=5},function(){this.m=U(this);this.a-=7},function(){var a=this.b,b=!!G(this),c=!!((this.s^this.B)&16);9<(a&15)||c?(a+=6,c=!0):c=!1;160<=a||b?(a+=96,b=!0):b=!1;this.f=this.s=this.b=a&255;this.f=b?this.f|256:this.f&-257;this.B=c?~this.s&16|this.B&-17:this.s&16|this.B&-17;this.a-=4},Eb,function(){var a;F(this,a=E(this)+E(this));this.f=this.f&255|a>>
8&256;this.a-=10},function(){F(this,Cb(this,V(this)));this.a-=16},function(){F(this,E(this)-1);this.a-=5},function(){this.o=N(this,this.o);this.a-=5},function(){this.o=M(this,this.o);this.a-=5},function(){this.o=U(this);this.a-=7},function(){this.b=~this.b&255;this.a-=4},Eb,function(){this.A=V(this)&65535;this.a-=10},function(){T(this,V(this),this.b);this.a-=13},function(){this.A=this.A+1&65535;this.a-=5},function(){var a=E(this);T(this,a,N(this,S(this,a)));this.a-=10},function(){var a=E(this);T(this,
a,M(this,S(this,a)));this.a-=10},function(){T(this,E(this),U(this));this.a-=10},function(){this.f|=256;this.a-=4},Eb,function(){var a;this.A=(a=E(this)+this.A)&65535;this.f=this.f&255|a>>8&256;this.a-=10},function(){this.b=S(this,V(this));this.a-=13},function(){this.A=this.A-1&65535;this.a-=5},function(){this.b=N(this,this.b);this.a-=5},function(){this.b=M(this,this.b);this.a-=5},function(){this.b=U(this);this.a-=7},function(){this.f=G(this)?this.f&-257:this.f|256;this.a-=4},function(){this.a-=5},
function(){this.h=this.i;this.a-=5},function(){this.h=this.j;this.a-=5},function(){this.h=this.l;this.a-=5},function(){this.h=this.m;this.a-=5},function(){this.h=this.o;this.a-=5},function(){this.h=S(this,E(this));this.a-=7},function(){this.h=this.b;this.a-=5},function(){this.i=this.h;this.a-=5},function(){this.a-=5},function(){this.i=this.j;this.a-=5},function(){this.i=this.l;this.a-=5},function(){this.i=this.m;this.a-=5},function(){this.i=this.o;this.a-=5},function(){this.i=S(this,E(this));this.a-=
7},function(){this.i=this.b;this.a-=5},function(){this.j=this.h;this.a-=5},function(){this.j=this.i;this.a-=5},function(){this.a-=5},function(){this.j=this.l;this.a-=5},function(){this.j=this.m;this.a-=5},function(){this.j=this.o;this.a-=5},function(){this.j=S(this,E(this));this.a-=7},function(){this.j=this.b;this.a-=5},function(){this.l=this.h;this.a-=5},function(){this.l=this.i;this.a-=5},function(){this.l=this.j;this.a-=5},function(){this.a-=5},function(){this.l=this.m;this.a-=5},function(){this.l=
this.o;this.a-=5},function(){this.l=S(this,E(this));this.a-=7},function(){this.l=this.b;this.a-=5},function(){this.m=this.h;this.a-=5},function(){this.m=this.i;this.a-=5},function(){this.m=this.j;this.a-=5},function(){this.m=this.l;this.a-=5},function(){this.a-=5},function(){this.m=this.o;this.a-=5},function(){this.m=S(this,E(this));this.a-=7},function(){this.m=this.b;this.a-=5},function(){this.o=this.h;this.a-=5},function(){this.o=this.i;this.a-=5},function(){this.o=this.j;this.a-=5},function(){this.o=
this.l;this.a-=5},function(){this.o=this.m;this.a-=5},function(){this.a-=5},function(){this.o=S(this,E(this));this.a-=7},function(){this.o=this.b;this.a-=5},function(){T(this,E(this),this.h);this.a-=7},function(){T(this,E(this),this.i);this.a-=7},function(){T(this,E(this),this.j);this.a-=7},function(){T(this,E(this),this.l);this.a-=7},function(){T(this,E(this),this.m);this.a-=7},function(){T(this,E(this),this.o);this.a-=7},function(){this.U|=4;this.a-=7;this.T&512||nb(this)},function(){T(this,E(this),
this.b);this.a-=7},function(){this.b=this.h;this.a-=5},function(){this.b=this.i;this.a-=5},function(){this.b=this.j;this.a-=5},function(){this.b=this.l;this.a-=5},function(){this.b=this.m;this.a-=5},function(){this.b=this.o;this.a-=5},function(){this.b=S(this,E(this));this.a-=7},function(){this.a-=5},function(){this.b=I(this,this.h);this.a-=4},function(){this.b=I(this,this.i);this.a-=4},function(){this.b=I(this,this.j);this.a-=4},function(){this.b=I(this,this.l);this.a-=4},function(){this.b=I(this,
this.m);this.a-=4},function(){this.b=I(this,this.o);this.a-=4},function(){this.b=I(this,S(this,E(this)));this.a-=7},function(){this.b=I(this,this.b);this.a-=4},function(){this.b=J(this,this.h);this.a-=4},function(){this.b=J(this,this.i);this.a-=4},function(){this.b=J(this,this.j);this.a-=4},function(){this.b=J(this,this.l);this.a-=4},function(){this.b=J(this,this.m);this.a-=4},function(){this.b=J(this,this.o);this.a-=4},function(){this.b=J(this,S(this,E(this)));this.a-=7},function(){this.b=J(this,
this.b);this.a-=4},function(){this.b=P(this,this.h);this.a-=4},function(){this.b=P(this,this.i);this.a-=4},function(){this.b=P(this,this.j);this.a-=4},function(){this.b=P(this,this.l);this.a-=4},function(){this.b=P(this,this.m);this.a-=4},function(){this.b=P(this,this.o);this.a-=4},function(){this.b=P(this,S(this,E(this)));this.a-=7},function(){this.b=P(this,this.b);this.a-=4},function(){this.b=Q(this,this.h);this.a-=4},function(){this.b=Q(this,this.i);this.a-=4},function(){this.b=Q(this,this.j);
this.a-=4},function(){this.b=Q(this,this.l);this.a-=4},function(){this.b=Q(this,this.m);this.a-=4},function(){this.b=Q(this,this.o);this.a-=4},function(){this.b=Q(this,S(this,E(this)));this.a-=7},function(){this.b=Q(this,this.b);this.a-=4},function(){this.b=K(this,this.h);this.a-=4},function(){this.b=K(this,this.i);this.a-=4},function(){this.b=K(this,this.j);this.a-=4},function(){this.b=K(this,this.l);this.a-=4},function(){this.b=K(this,this.m);this.a-=4},function(){this.b=K(this,this.o);this.a-=
4},function(){this.b=K(this,S(this,E(this)));this.a-=7},function(){this.b=K(this,this.b);this.a-=4},function(){this.b=R(this,this.h);this.a-=4},function(){this.b=R(this,this.i);this.a-=4},function(){this.b=R(this,this.j);this.a-=4},function(){this.b=R(this,this.l);this.a-=4},function(){this.b=R(this,this.m);this.a-=4},function(){this.b=R(this,this.o);this.a-=4},function(){this.b=R(this,S(this,E(this)));this.a-=7},function(){this.b=R(this,this.b);this.a-=4},function(){this.b=O(this,this.h);this.a-=
4},function(){this.b=O(this,this.i);this.a-=4},function(){this.b=O(this,this.j);this.a-=4},function(){this.b=O(this,this.l);this.a-=4},function(){this.b=O(this,this.m);this.a-=4},function(){this.b=O(this,this.o);this.a-=4},function(){this.b=O(this,S(this,E(this)));this.a-=7},function(){this.b=O(this,this.b);this.a-=4},function(){L(this,this.h);this.a-=4},function(){L(this,this.i);this.a-=4},function(){L(this,this.j);this.a-=4},function(){L(this,this.l);this.a-=4},function(){L(this,this.m);this.a-=
4},function(){L(this,this.o);this.a-=4},function(){L(this,S(this,E(this)));this.a-=7},function(){L(this,this.b);this.a-=4},function(){this.f&255&&(B(this,W(this)),this.a-=6);this.a-=5},function(){yb(this,W(this));this.a-=10},function(){var a=V(this);this.f&255&&B(this,a);this.a-=10},Fb,function(){var a=V(this);this.f&255&&(X(this,this.u),B(this,a),this.a-=6);this.a-=11},function(){X(this,xb(this));this.a-=11},function(){this.b=I(this,U(this));this.a-=7},function(){X(this,this.u);B(this,0);this.a-=
11},function(){this.f&255||(B(this,W(this)),this.a-=6);this.a-=5},Gb,function(){var a=V(this);this.f&255||B(this,a);this.a-=10},Fb,function(){var a=V(this);this.f&255||(X(this,this.u),B(this,a),this.a-=6);this.a-=11},Hb,function(){this.b=J(this,U(this));this.a-=7},function(){X(this,this.u);B(this,8);this.a-=11},function(){G(this)||(B(this,W(this)),this.a-=6);this.a-=5},function(){Ab(this,W(this));this.a-=10},function(){var a=V(this);G(this)||B(this,a);this.a-=10},function(){for(var a=U(this),b=this.C,
c=this.b,d=1,e=0;0<d;){var f=b.s[a],h=b.u[a]||1,g=1==h?255:2==h?65535:-1,g=(c>>>=e)&g;if(void 0!==f&&f[0])f[0](a,g,void 0);e+=h<<3;a+=h;d-=h}this.a-=10},function(){var a=V(this);G(this)||(X(this,this.u),B(this,a),this.a-=6);this.a-=11},function(){X(this,zb(this));this.a-=11},function(){this.b=P(this,U(this));this.a-=7},function(){X(this,this.u);B(this,16);this.a-=11},function(){G(this)&&(B(this,W(this)),this.a-=6);this.a-=5},Gb,function(){var a=V(this);G(this)&&B(this,a);this.a-=10},function(){for(var a=
U(this),b=this.C,c=1,d=0,e=0;0<c;){var f=b.m[a],h=b.o[a]||1,g=1==h?255:2==h?65535:-1,k=g;void 0!==f&&f[0]&&(k=f[0](a,void 0),void 0===k?k=g:k&=g);d|=k<<e;e+=h<<3;a+=h;c-=h}this.b=d&255;this.a-=10},function(){var a=V(this);G(this)&&(X(this,this.u),B(this,a),this.a-=6);this.a-=11},Hb,function(){this.b=Q(this,U(this));this.a-=7},function(){X(this,this.u);B(this,24);this.a-=11},function(){Bb(this)||(B(this,W(this)),this.a-=6);this.a-=5},function(){F(this,W(this));this.a-=10},function(){var a=V(this);
Bb(this)||B(this,a);this.a-=10},function(){var a=W(this);X(this,E(this));F(this,a);this.a-=18},function(){var a=V(this);Bb(this)||(X(this,this.u),B(this,a),this.a-=6);this.a-=11},function(){X(this,E(this));this.a-=11},function(){this.b=K(this,U(this));this.a-=7},function(){X(this,this.u);B(this,32);this.a-=11},function(){Bb(this)&&(B(this,W(this)),this.a-=6);this.a-=5},function(){B(this,E(this));this.a-=5},function(){var a=V(this);Bb(this)&&B(this,a);this.a-=10},function(){var a=E(this);F(this,zb(this));
Ab(this,a);this.a-=5},function(){var a=V(this);Bb(this)&&(X(this,this.u),B(this,a),this.a-=6);this.a-=11},Hb,function(){this.b=R(this,U(this));this.a-=7},function(){X(this,this.u);B(this,40);this.a-=11},function(){this.s&128||(B(this,W(this)),this.a-=6);this.a-=5},function(){var a=W(this);vb(this,a);this.b=a>>8;this.a-=10},function(){var a=V(this);this.s&128||B(this,a);this.a-=10},function(){this.T&=-513;this.a-=4},function(){var a=V(this);this.s&128||(X(this,this.u),B(this,a),this.a-=6);this.a-=
11},function(){X(this,wb(this)|this.b<<8);this.a-=11},function(){this.b=O(this,U(this));this.a-=7},function(){X(this,this.u);B(this,48);this.a-=11},function(){this.s&128&&(B(this,W(this)),this.a-=6);this.a-=5},function(){this.A=E(this)&65535;this.a-=5},function(){var a=V(this);this.s&128&&B(this,a);this.a-=10},function(){this.T|=512;this.a-=4},function(){var a=V(this);this.s&128&&(X(this,this.u),B(this,a),this.a-=6);this.a-=11},Hb,function(){L(this,U(this));this.a-=7},function(){X(this,this.u);B(this,
56);this.a-=11}];function Ib(a){r.call(this,"ROM",a,Ib);this.b=null;this.j=a.addr;this.c=a.size;this.f=a.alias;this.h=a.file;this.l=ca(this.h);if(this.h){a=this.h;var b=da(this.l);"json"!=b&&"hex"!=b&&(a=ja()+"/api/v1/dump?file="+this.h+"&format=bytes&decimal=true");var c=this;n(a,null,!0,function(a,b,f){Jb(c,a,b,f)})}}u(Ib);Ib.prototype.ma=function(a,b,c,d){this.C=b;this.a=c;this.J=d;Kb(this)};Ib.prototype.X=function(){this.i&&(this.J&&this.J.a(this.id,this.j,this.c,this.i),delete this.i);return!0};
Ib.prototype.W=function(){return!0};
function Jb(a,b,c,d){if(d)a.I("Unable to load system ROM (error "+d+": "+b+")");else{Ea(a.Na,b,c);if("["==c.charAt(0)||"{"==c.charAt(0))try{var e=eval("("+c+")"),f=e.bytes,h=e.data;if(f)a.b=f;else if(h)for(a.b=Array(4*h.length),d=c=0;c<h.length;c++)a.b[d++]=h[c]&255,a.b[d++]=h[c]>>8&255,a.b[d++]=h[c]>>16&255,a.b[d++]=h[c]>>24&255;else a.b=e;a.i=e.symbols;if(!a.b.length){p("Empty ROM: "+b);return}if(1==a.b.length){p(a.b[0]);return}}catch(g){a.I("ROM data error: "+g.message);return}else for(b=c.replace(/\n/gm,
" ").replace(/ +$/,"").split(" "),a.b=Array(b.length),e=0;e<b.length;e++)a.b[e]=aa(b[e]);Kb(a)}}
function Kb(a){if(!Ia(a))if(!a.h)z(a);else if(a.b&&a.C){if(a.b.length!=a.c){var b="ROM size (0x"+ba(a.b.length)+") does not match specified size ("+("0x"+ba(a.c))+")";a.g.$=!0;a.I(b)}else{b=a.j;if(Ra(a.C,b,a.c,Ya)){for(var c=0;c<a.b.length;c++){var d=a.C,e=b+c;d.b[(e&d.h)>>>d.F].Za(e&d.l,a.b[c]&255,e)}b=!0}else b=!1;if(b){b=[];"number"==typeof a.f?b.push(a.f):null!=a.f&&a.f.length&&(b=a.f);for(c=0;c<b.length;c++){for(var f=a,d=b[c],e=f.C,h=f.c,g=[],k=f.j>>>e.F;0<h&&k<e.b.length;)g.push(e.b[k++]),
h-=e.D;e=f.C;f=f.c;h=0;for(d>>>=e.F;0<f&&d<e.b.length;){k=g[h++];if(!k)break;e.b[d++]=k;f-=e.D}}delete a.b}}z(a)}}ta(function(){for(var a=y(document,"pc8080","rom"),b=0;b<a.length;b++){var c=a[b],d=w(c),d=new Ib(d);Ga(d,c)}});function Lb(a){r.call(this,"RAM",a,Lb);this.f=a.addr;this.c=a.size;this.b=!1}u(Lb);m=Lb.prototype;m.ma=function(a,b,c,d){this.C=b;this.a=c;this.J=d;z(this)};m.X=function(a,b){b||this.reset();return!0};m.W=function(a){return a?this.save():!0};
m.reset=function(){!this.b&&this.c&&Ra(this.C,this.f,this.c,1)&&(this.b=!0,this.status(Math.floor(this.c/1024)+"Kb allocated"));this.b||p("No RAM allocated")};m.save=function(){return null};m.restore=function(){return!0};ta(function(){for(var a=y(document,"pc8080","ram"),b=0;b<a.length;b++){var c=a[b],d=w(c),d=new Lb(d);Ga(d,c)}});function Mb(a){r.call(this,"Keyboard",a,Mb);z(this)}u(Mb);
ta(function(){for(var a=y(document,"pc8080","keyboard"),b=0;b<a.length;b++){var c=a[b],d=w(c),d=new Mb(d);Ga(d,c)}});function Nb(a){r.call(this,"Video",a,Nb);z(this)}u(Nb);
ta(function(){for(var a=y(document,"pc8080","video"),b=0;b<a.length;b++){var c=a[b],d=w(c),e=document.createElement("canvas");if(void 0===e||!e.getContext){c.innerHTML="<br/>Missing &lt;canvas&gt; support. Please try a newer web browser.";break}e.setAttribute("class","pcjs-canvas");e.setAttribute("width",d.screenWidth);e.setAttribute("height",d.screenHeight);e.style.backgroundColor=d.screenColor;e.style.height="auto";0<=(window?window.navigator.userAgent:"").indexOf("MSIE")&&(c.onresize=function(a,
b,c,d){return function(){b.style.height=(a.clientWidth*d/c|0)+"px"}}(c,e,d.screenWidth,d.screenHeight),c.onresize());var f=+(d.aspect||ya.aspect);f&&.3<=f&&3.33>=f&&(sa("onresize",function(a,b,c){return function(){b.style.height=(a.clientWidth/c|0)+"px"}}(c,e,f)),window.onresize());c.appendChild(e);f=document.createElement("textarea");pa("iOS")&&(f.setAttribute("autocapitalize","off"),f.setAttribute("autocorrect","off"));c.appendChild(f);e.getContext("2d");d=new Nb(d);Ga(d,c)}});
function C(a,b,c){this.id=a.id;this.key=Ob(a,b,c);this.J=a.J;Pb(this,a.Wa)}function Ob(a,b,c){a=a.id;if(b){var d=b.indexOf(".");0<d&&(a+=".v"+b.substr(0,d))}c&&(a+="."+c);return a}
C.prototype={constructor:C,value:function(){return this[this.id]},data:function(){return this[this.id]},toString:function(){var a=this[this.id];return"string"==typeof a?a:JSON.stringify(a)},clear:function(a){Pb(this);var b=[];try{for(var c=0,d=window.localStorage.length;c<d;c++)b.push(window.localStorage.key(c))}catch(e){}for(c=0;c<b.length;c++)if((d=b[c])&&(a||d.substr(0,this.key.length)==this.key)){try{window.localStorage.removeItem(d)}catch(e){}b.splice(c,1);c=0}}};
function Pb(a,b){a[a.id]={};b&&D(a,"parms",b);a.a=!1}function Qb(a){var b=!0;if(ma()){var c=JSON.stringify(a[a.id]);oa(a.key,c)||(p("Unable to store "+c.length+" bytes in browser local storage"),b=!1)}return b}function Rb(a){var b=!0;try{a[a.id]=JSON.parse(a[a.id])}catch(c){p(c.message||c),b=!1}return b}function Sb(a,b){return b?(a[a.id]=b,a.a=!0):a.a?!0:ma()&&(b=na(a.key))?(a[a.id]=b,a.a=!0):!1}function Tb(a,b){return a[a.id][b]||null}function D(a,b,c){try{a[a.id][b]=c}catch(d){}}
function Ub(a,b,c){r.call(this,"Computer",a,Ub);this.g.H=!1;Vb(this,b);this.u=ib(this,"autoPower",a);this.f=0;this.F=a.busWidth||a.buswidth;this.b=Wb;this.o=null;this.j=this.D=!1;this.G=ib(this,"url")||"";(Math.random()+.1).toString(36);this.c=Xb(this);if(this.a=Fa("CPU",this.id)){this.J=Fa("Debugger",this.id);this.K=[];for(b=null;b=Ma(this,"Video",b);)this.K.push(b);this.C=new Oa({id:this.Na+".bus",buswidth:this.F},this.a,this.J);var d,e=v(this.id);if((this.h=Fa("Panel",this.id))&&this.h.Ea)for(b=
0;b<e.length;b++)d=e[b],d.I=this.h.I,d.L=this.h.L,d.Ea=this.h.Ea;for(b=0;b<e.length;b++)d=e[b],d.ma&&d.ma(this,this.C,this.a,this.J);b=null;d=a.resume;void 0!==d&&(1<d.length?b=this.m=d:this.b=parseInt(d,10));var f;if(a=ib(this,"state")||(f=!0,a.state))b=this.w=a,f||(this.j=!0,this.b=Wb),this.b&&(this.s=new C(this,Z),Sb(this.s)?b=null:delete this.s);!b&&this.b&&(b=Yb(this))&&(this.j=!0);if(b){var h=this;n(b,null,!0,function(a,b,c){c?(h.m=null,h.j=!1,h.I("Unable to load machine state from server (error "+
c+(b?": "+(String.prototype.trim?b.trim():b.replace(/^\s+|\s+$/g,"")):"")+")")):(h.o=b,h.D=!0);z(h)})}else z(this);this.v.power||(this.u=!0);!c&&this.u&&Zb(this,this.ta)}else p("Unable to find CPU component")}u(Ub);var Z="1.21.7",Wb=0;function Vb(a,b){if(!b){var c;if("object"==typeof resources&&(c=resources.parms))try{b=eval("("+c+")")}catch(d){p(d.message+" ("+c+")")}}a.l=b}
function ib(a,b,c){var d=b.toLowerCase(),d=ya[b]||ya[d];void 0===d&&a.l&&(d=a.l[b]);void 0===d&&c&&(d=c[b]);void 0===d&&"object"==typeof resources&&resources[b]&&(d=b);return d}function Zb(a,b,c){for(var d=v(a.id),e=0;e<=d.length;e++){var f=e<d.length?d[e]:a;if(!Ia(f)){Ia(f,function(){Zb(a,b,c)});return}}b.call(a,c)}
function $b(a,b){var c=new C(a,Z,"validate");if(Sb(c)&&Rb(c)){var d=Tb(c,"timestamp"),e=b?Tb(b,"timestamp"):"unknown";d!=e&&(a.I("Machine state may be out-of-date\n("+d+" vs. "+e+")\nCheck your browser's local storage limits"),b||c.clear())}}m=Ub.prototype;
m.ta=function(a){void 0===a&&(a=this.b||(this.o?1:Wb));if(!this.f){this.f++;var b=!1,c=!1;this.B=!1;var d=this.s||new C(this,Z);if(-1==a)b=!0;else if(a>Wb){if(Sb(d,this.o)){this.i=new C(this,Z,"failsafe");Sb(this.i)&&(ac(this,d),a=2,Pb(this.i));D(this.i,"timestamp",ia());Qb(this.i);var e=this.b&&!this.j;if(1==a||ka("Click OK to restore the previous PC8080 machine state, or CANCEL to reset the machine.")){if(c=Rb(d)){var f=Tb(d,"code"),h=Tb(d,"data");f&&("ok"==f?Sb(d,h):("error"==f&&"no machine state"!=
h?(this.I("Error: "+h),"unable to verify user"==h&&(oa("user",""),this.c=null)):this.L(f+": "+h),Pb(d),Sb(d)?(c=Rb(d),e=!0):c=!1))}e&&$b(this,c?d:null)}else 2==a&&d.clear()}else $b(this);delete this.o;delete this.s}e=v(this.id);for(f=0;f<e.length;f++)h=e[f],h!==this&&h!=this.a&&(c=bc(this,h,d,b,c));b=[d,a,c];-1!=a?Zb(this,this.Oa,b):this.Oa(b)}};
function bc(a,b,c,d,e){if(!b.g.H){b.g.H=!0;if(b.X){var f=null;e&&((f=Tb(c,b.id))||(f=Tb(c,b.id.replace(/[a-z0-9]\./i,"."))));"string"===typeof f&&(f=null);!b.X(f,d)&&f&&(p("Unable to restore state for "+b.type),a.w&&!a.D?(c.clear(),a.b=Wb,window&&window.location.reload()):a.B=!0,b.X(null),e=!1)}if(!d&&b.La)for(a=b.La.split("|"),c=0;c<a.length;c++)b.status(a[c])}return e}
m.Oa=function(a){var b=a[0],c=0>a[1];a=a[2];this.g.H=!0;var d=this.v.power;d&&(d.textContent="Shutdown");this.A||(this.L("PC8080 v"+Z+"\nCopyright \u00a9 2012-2016 Jeff Parsons <Jeff@pcjs.org>\nLicense: GPL version 3 or later <http://gnu.org/licenses/gpl.html>"),this.A=!0);this.a&&(bc(this,this.a,b,c,a),mb(this.a));this.B&&(ac(this,b),b.clear());!c&&this.i&&(this.i.clear(),delete this.i);this.f=0};
function ac(a,b){if(ka("There may be a problem with your PC8080 machine.\n\nTo help us diagnose it, click OK to send this PC8080 machine state to http://www.pcjs.org.")){var c=a.G,d=a.c||"",e=b.toString(),f={app:"PC8080"};f.ver=Z;f.url=c;f.user=d;f.type="bug";f.data=e;n("http://www.pcjs.org/api/v1/report",f,!0)}}
function cc(a,b,c){var d,e="none";if(a.f)return null;a.f--;var f=new C(a,Z),h=new C(a,Z,"validate"),g=ia();D(h,"timestamp",g);D(f,"timestamp",g);D(f,"version","1.21.7");D(f,"url",window?window.location.href:null);D(f,"browser",window?window.navigator.userAgent:"");a.a&&a.a.W&&(c&&nb(a.a),d=a.a.W(b,c),"object"===typeof d&&D(f,a.a.id,d),c&&(a.a.g.H=!1,!1===d&&(e=null)));for(var g=v(a.id),k=0;k<g.length;k++){var l=g[k];l.g.H&&(l.W&&(d=l.W(b,c),"object"===typeof d&&D(f,l.id,d)),c&&(l.g.H=!1,!1===d&&(e=
null)))}e&&(c?(g=d=!1,b?(a.c&&dc(a,a.c,f.toString()),Qb(h)&&Qb(f)||(e=null,d=g=!0)):a.b&&(d=!0,g=3==a.b),d&&f.clear(g)):e=f.toString());c&&(a.g.H=!1,b=a.v.power)&&(b.textContent="Power");a.f=0;return e}m.reset=function(){this.C&&this.C.reset&&this.C.reset();for(var a=v(this.id),b=0;b<a.length;b++){var c=a[b];c!==this&&c!==this.C&&c.reset&&c.reset()}};m.start=function(a,b){for(var c=v(this.id),d=0;d<c.length;d++){var e=c[d];"CPU"!=e.type&&e!==this&&e.start&&e.start(a,b)}};
m.stop=function(a,b){for(var c=v(this.id),d=0;d<c.length;d++){var e=c[d];"CPU"!=e.type&&e!==this&&e.stop&&e.stop(a,b)}};
m.M=function(a,b,c){var d=this;switch(b){case "power":return this.v[b]=c,c.onclick=function(){d.f||(d.g.H?cc(d,!1,!0):Zb(d,d.ta))},!0;case "reset":return this.v[b]=c,c.onclick=function(){if(d.g.H&&!d.f)if(d.b&&!d.m){var a=ka("Click OK to save changes to this PC8080 machine.\n\nWARNING: If you CANCEL, all disk changes will be discarded.");cc(d,a,!0);!a&&d.w?window&&window.location.reload():d.ta(Wb)}else d.reset(),d.a&&mb(d.a)},!0;case "save":if(ea(ja(),"pcjs.org")){c.parentNode.removeChild(c);break}this.v[b]=
c;c.onclick=function(){var a=Xb(d,!0);if(a){var b=!!(d.b&&!d.m||d.w),c=cc(d,b);b?dc(d,a,c):d.I("Resume disabled, machine state not saved")}};return!0}return!1};
function Xb(a,b){var c=a.c;c||(c=na("user"),void 0!==c?!c&&b&&(c=null,window&&(c=window.prompt("Saving machine states on the pcjs.org server is currently unsupported.\n\nIf you're running your own server, enter your user ID below.","")),c&&((c=ec(a,c))||a.I("The user ID is invalid."))):b&&a.I("Browser local storage is not available"));return c}
function ec(a,b){a.c=null;var c=n(ja()+"/api/v1/user?req=verify&user="+b),d=c[1];if(!c[0]&&d)try{c=eval("("+d+")"),c.code&&"ok"==c.code&&(oa("user",c.data),a.c=c.data)}catch(e){p(e.message+" ("+d+")")}return a.c}function Yb(a){var b=null;a.c&&(b=ja()+"/api/v1/user?req=load&user="+a.c+"&state="+Ob(a,Z));return b}
function dc(a,b,c){if(c){var d={req:"store"};d.user=b;d.state=Ob(a,Z);d.data=c;b=n(ja()+"/api/v1/user",d);d=b[0];if(b[1]){if(d){var e=d.indexOf("\n");0<e&&(d=d.substr(0,e));d.indexOf("Error: ")||(d=d.substr(7))}d='{"code":'+b[1]+',"data":"'+d+'"}'}b=JSON.parse(d);b&&"ok"==b.code?a.I("Machine state saved to server"):c&&(c=b&&b.data||"unable to save machine state",c="error"==b.code?"Error: "+c:"Error "+b.code+": "+c,a.I(c),oa("user",""),a.c=null)}}
function Ma(a,b,c){a=v(a.id);for(var d=0;d<a.length;d++){var e=a[d];if(c)c==e&&(c=null);else if(e.type==b)return e}return null}m.ca=function(a){this.a&&this.a.ca(a);this.h&&this.h.ca(a)};ta(function(){for(var a=y(document,"pc8080-machine"),b=0;b<a.length;b++)for(var c=a[b],d=w(c),c=y(c,"pc8080","computer"),e=0;e<c.length;e++){var f=c[e],h=w(f),h=new Ub(h,d,!0);Ga(h,f);h.u&&Zb(h,h.ta)}});
q.show.push(function(){for(var a=y(document,"pc8080","computer"),b=0;b<a.length;b++){var c=w(a[b]);(c=Fa("Computer",c.id))&&c.A&&!c.g.H&&c.ta(-1)}});q.exit.push(function(){for(var a=y(document,"pc8080","computer"),b=0;b<a.length;b++){var c=w(a[b]);(c=Fa("Computer",c.id))&&c.g.H&&cc(c,!(!c.b||c.m),!0)}});var fc=0;function gc(a,b,c,d,e,f){e("Loading "+a+"...");n(a,null,!0,function(h,g,k){k?(g||(g="unable to load "+a+" ("+k+")"),f(g,null)):hc(g,a,b,c,d,e,f)})}
function hc(a,b,c,d,e,f,h){function g(a,f){if(f)h(f,null);else{if(c){Ea(c,b,a);var g=b;g&&0>g.indexOf("/")&&"/"==window.location.pathname.slice(-1)&&(g=window.location.pathname+g);d?"}"==d.slice(-1)?(d=d.slice(0,-1),1<d.length&&(d+=",")):d='{state:"'+d+'",':d="{";d+='url:"'+g+'"}';"object"==typeof resources&&(g=null);a=a.replace(/(<machine[^>]*\sid=)(['"]).*?\2/,"$1$2"+c+"$2"+(d?" parms='"+d+"'":"")+(g?' url="'+g+'"':""))}e||(a=a.replace(/(<xsl:variable name="APPCLASS">).*?(<\/xsl:variable>)/,"$1pc8080$2"));
g=null;if("<"==a.charAt(0))try{e||(a=a.replace(/<!DOCTYPE(.|[\r\n])*]>\s*/g,"")),window.ActiveXObject||"ActiveXObject"in window?(g=new window.ActiveXObject("Microsoft.XMLDOM"),g.async=!1,g.loadXML(a)):g=(new window.DOMParser).parseFromString(a,"text/xml")}catch(x){g=null,a=x.message}else a="unrecognized XML: "+(255<a.length?a.substr(0,255)+"...":a);h(a,g)}}a?e?ic(a,f,g):g(a,null):h("no data"+(b?" for file: "+b:""),null)}
function ic(a,b,c){var d;if(d=/<([a-z]+)\s+ref="(.*?)"(.*?)\/>/g.exec(a)){var e=d[2];b("Loading "+e+"...");n(e,null,!0,function(f,h,g){if(g||!h)c(a,"unable to resolve XML reference: "+d[0]+" ("+g+")");else{if(f=d[3])if(g=h.match(new RegExp("<"+d[1]+"[^>]*>"))){for(var k=g[0],l,H=/( [a-z]+=)(['"])(.*?)\2/g;l=H.exec(f);)k=0>k.indexOf(l[1])?k.replace(">",l[0]+">"):k.replace(new RegExp(l[1]+"(['\"])(.*?)\\1"),l[0]);g[0]!=k&&(h=h.replace(g[0],k))}else{c(a,"missing <"+d[1]+"> in "+e);return}h=h.replace(/<\?xml[^>]*>[\r\n]*/,
"");a=a.replace(d[0],h);ic(a,b,c)}})}else c(a,null)}
function jc(a,b,c,d){function e(a){if(void 0===g){var b=h&&y(h,"machine-warning");g=b&&b[0]||h}g&&(g.innerHTML=ga(a))}function f(a){e("Error: "+a);k&&(--fc||va(!0));k=!1}var h,g,k=!0;fc++;Da[a]={};try{if(h=document.getElementById(a)){var l;if("object"==typeof resources&&(l=resources.css)){var H=document.head||document.getElementsByTagName("head")[0],x=document.createElement("style");x.type="text/css";x.styleSheet?x.styleSheet.cssText=l:x.appendChild(document.createTextNode(l));H.appendChild(x)}c||
(c="/versions/pc8080/1.21.7/components.xsl");l=function(d,g){g?gc(c,null,null,!1,e,function(d,k){if(k)if(Ea(a,c,d),e("Processing "+b+"..."),window.ActiveXObject||"ActiveXObject"in window){var l=g.transformNode(k);l?(h.outerHTML=l,--fc||va(!0)):f("transformNodeToObject failed")}else document.implementation&&document.implementation.createDocument?(l=new XSLTProcessor,l.importStylesheet(k),(l=l.transformToFragment(g,document))?h.parentNode?(h.parentNode.replaceChild(l,h),--fc||va(!0)):f("invalid machine element: "+
a):f("transformToFragment failed")):f("unable to transform XML: unsupported browser");else f(d)}):f(d)};"<"!=b.charAt(0)?gc(b,a,d,!0,e,l):hc(b,null,a,d,!1,e,l)}else f("missing machine element: "+a)}catch(Qa){f(Qa.message)}return k}window.embedPC8080=function(a,b,c,d){va(!1);return jc(a,b,c,d)};window.enableEvents=va;window.sendEvent=wa;
function kc(a,b,c,d){if(!c&&b){d.push(b);a=Da[d[0]];b=null;for(var e in a)if(ea(e,"components.xsl")){b=e.replace(".xsl",".css");break}b?n(b,null,!0,function(a,b){lc(b,d)}):lc(null,d)}else p("Error ("+c+") requesting "+a)}
function lc(a,b){var c,d,e,f=b[0],h=b[1];c=b[4];c=c.match(/^(\s*\(function\(\)\{)([\s\S]*)(}\)\(\);\s*)$/);var g=Da[f],k={},l;for(l in g){var H=g[l],x=da(l);if("xml"==x){for(x=/[ \t]*<disk [^>]*path=(['"])(.*?)\1.*?<\/disk>\n?/g;d=x.exec(g[l]);){var Qa=d[2];Qa&&(g[Qa]||(H=H.replace(d[0],"")))}d=l=ca(l)}else"xsl"==x&&(e=l=ca(l));k[l]=H}a&&(k[l="css"]=a);b[2]&&(k[l="parms"]=b[2]);b[3]&&(k[l="state"]=b[3]);d&&e?(l=JSON.stringify(k),h+=".js",c=c[1]+"var resources="+l+";"+c[2]+c[3],c=c.replace(/\u00A9/g,
"&#xA9;"),l=h,g=null,k="data:application/javascript,",k=pa("Firefox")?k+encodeURIComponent(c):k+encodeURI(c),l&&(g=document.createElement("a"),"string"!=typeof g.download&&(g=null)),g?(g.href=k,g.download=l,document.body.appendChild(g),g.click(),document.body.removeChild(g),c="Check your Downloads folder for "+l+"."):(window.open(k),c="Check your browser for a new window/tab containing the requested data"+(l?" ("+l+")":"")+"."),c+=', copy it to your web server as "'+h+'", and then add the following to your web page:\n\n',
c+='<div id="'+f+'"></div>\n',c+="...\n",c+='<script type="text/javascript" src="'+h+'">\x3c/script>\n',c+='<script type="text/javascript">embedPC("'+f+'","'+d+'","'+e+'");\x3c/script>\n\n',c+="The machine should appear where the <div> is located.",p(c)):p("Missing XML/XSL resources")}
window.savePC=function(a,b,c){var d=Fa("Computer",a),e=Fa("Debugger",a);if(d){var f=cc(d,!0),h=d.l?JSON.stringify(d.l):null;b||(b="/versions/pcjs/1.21.7/pc"+(e?"-dbg":"")+".js");if(c&&c({state:f,Wa:h}))return!0;n(b,null,!0,function(c,d,e){kc(c,d,e,[a,ca(b,!0),h,f])});return!0}p("Unable to identify machine '"+a+"'");return!1};})();
