(function(){var e;function aa(a){var b=16,c;if(a){b||(b=16);if("$"==a.charAt(0))b=16,a=a.substr(1);else if("0x"==a.substr(0,2))b=16,a=a.substr(2);else{var d=a.charAt(a.length-1).toLowerCase();"h"==d?(b=16,d=null):"."==d&&(b=10,d=null);null==d&&(a=a.substr(0,a.length-1))}var f,d=a,g=b;(g&&10!=g?16==g?null!==d.match(/^[0-9a-f]+$/i):2==g&&null!==d.match(/^[01]+$/i):null!==d.match(/^[0-9]+$/))&&!isNaN(f=parseInt(a,b))&&(c=f|0)}return c}
function n(a,b){var c="";void 0===b?b=8:8<b&&(b=8);if(null==a||isNaN(a))for(;0<b--;)c="?"+c;else for(;0<b--;){var d=a&15,d=d+(0<=d&&9>=d?48:55),c=String.fromCharCode(d)+c;a>>=4}return c}function ba(a,b){var c=a,d=a.lastIndexOf("/");0<=d&&(c=a.substr(d+1));d=c.indexOf("&");0<d&&(c=c.substr(0,d));b&&(d=c.lastIndexOf("."),0<d&&(c=c.substring(0,d)));return c}function ca(a){var b="",c=a.lastIndexOf(".");0<=c&&(b=a.substr(c+1).toLowerCase());return b}
function da(a,b){return-1!==a.indexOf(b,a.length-b.length)}var ea={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#039;"};function fa(a){return a.replace(/[&<>"']/g,function(a){return ea[a]})}var p=Date.now||function(){return+new Date};function ga(){function a(a){return(10>a?"0":"")+a}var b=new Date;return b.getFullYear()+"-"+a(b.getMonth()+1)+"-"+a(b.getDate())+" "+a(b.getHours())+":"+a(b.getMinutes())+":"+a(b.getSeconds())}
function q(a,b,c,d){var f=0,g=null,k=null;if("object"==typeof resources&&(g=resources[a]))return d&&d(a,g,f),[g,f];if(c&&"function"==typeof resources)return resources(a,function(b,c){d&&d(a,b,c)}),k;var h=window.XMLHttpRequest?new window.XMLHttpRequest:new window.ActiveXObject("Microsoft.XMLHTTP");c&&(h.onreadystatechange=function(){4===h.readyState&&(g=h.responseText,200==h.status||!h.status&&g.length&&"file:"==(window?window.location.protocol:"file:")||(f=h.status||-1),d&&d(a,g,f))});if(b&&"object"==
typeof b){var l="",m;for(m in b)b.hasOwnProperty(m)&&(l&&(l+="&"),l+=m+"="+encodeURIComponent(b[m]));l=l.replace(/%20/g,"+");h.open("POST",a,!!c);h.setRequestHeader("Content-type","application/x-www-form-urlencoded");h.send(l)}else h.open("GET",a,!!c),"bytes"==b&&h.overrideMimeType("text/plain; charset=x-user-defined"),h.send();c||(g=h.responseText,200!=h.status&&(f=h.status||-1),d&&d(a,g,f),k=[g,f]);return k}function t(){return"http://"+(window?window.location.host:"www.pcjs.org")}
function u(a){window&&window.alert(a)}function ha(a){var b=!1;window&&(b=window.confirm(a));return b}var ia=null;function ja(){if(null==ia){var a=!1;if(window)try{window.localStorage.setItem("PCjs.localStorage","PCjs.localStorage"),a="PCjs.localStorage"==window.localStorage.getItem("PCjs.localStorage"),window.localStorage.removeItem("PCjs.localStorage")}catch(b){a=!1}ia=a}return ia}function ka(a){var b;if(window)try{b=window.localStorage.getItem(a)}catch(c){}return b}
function la(a,b){try{return window.localStorage.setItem(a,b),!0}catch(c){}return!1}function ma(a){if(window){var b=window?window.navigator.userAgent:"";return"iOS"==a&&b.match(/(iPod|iPhone|iPad)/)&&b.match(/AppleWebKit/)||"MSIE"==a&&b.match(/(MSIE|Trident)/)||0<=b.indexOf(a)?!0:!1}return!1}var v={init:[],show:[],exit:[]},na=!1,oa=!0;function pa(a,b){if(window){var c=window[a];window[a]="function"!==typeof c?b:function(){c&&c();b()}}}function w(a){v.init.push(a)}
function qa(a){if(oa)try{for(var b=0;b<a.length;b++)a[b]()}catch(c){u("An unexpected exception occurred:\n\n"+c.message+"\n\nPlease send this information to support@pcjs.org. Thanks.")}}function x(a){!oa&&a?(oa=!0,na&&ra("init")):oa=a}function ra(a){v[a]&&qa(v[a])}pa("onload",function(){na=!0;qa(v.init)});pa("onpageshow",function(){qa(v.show)});pa(ma("Opera")||ma("iOS")?"onunload":"onbeforeunload",function(){qa(v.exit)});
function y(a,b,c){this.type=a;b||(b={id:"",name:""});this.id=b.id;this.name=b.name;this.Ka=b.comment;this.Wa=b;void 0===this.id&&(this.id="");b=this.id.indexOf(".");0<b?(this.Ma=this.id.substr(0,b),this.La=this.id.substr(b+1)):this.La=this.id;this[a]=c;this.c={ca:!1,la:!1,Fa:!1,F:!1,X:!1};this.za=null;this.c.X=!1;this.i={};this.H=null;z.push(this)}var sa=void 0,ta={};
if(window){sa||(sa=window.location.search.substr(1));for(var ua,va=/\+/g,wa=/([^&=]+)=?([^&]*)/g;ua=wa.exec(sa);)ta[decodeURIComponent(ua[1].replace(va," "))]=decodeURIComponent(ua[2].replace(va," "))}function xa(a){function b(){}if(window){if(!a)throw new TypeError;if(Object.create)return Object.create(a);var c=typeof a;if("object"!==c&&"function"!==c)throw new TypeError;}b.prototype=a;return new b}
function B(a,b){b||(b=y);a.prototype=xa(b.prototype);a.prototype.constructor=a;a.prototype.parent=b.prototype}var z=[],C={};function za(a,b,c){C[a]&&b&&(C[a][b]=c)}function D(a){var b,c=[];a&&(a=0<(b=a.indexOf("."))?a.substr(0,b+1):"");for(b=0;b<z.length;b++){var d=z[b];a&&d.id.indexOf(a)||c.push(d)}return c}
function E(a,b){var c;if(void 0!==a){var d;b&&(b=0<(d=b.indexOf("."))?b.substr(0,d+1):"");for(d=0;d<z.length;d++)if(c)c==z[d]&&(c=null);else if(!(a!=z[d].type||b&&z[d].id.indexOf(b)))return z[d]}return null}function F(a){var b=null;if(a=a.getAttribute("data-value"))try{b=eval("("+a+")")}catch(c){u(c.message+" ("+a+")")}return b}
function G(a,b){for(var c=H(b.parentNode,"pc8080-control"),d=0;d<c.length;d++)for(var f=c[d].childNodes,g=0;g<f.length;g++){var k=f[g];if(1===k.nodeType){var h=k.getAttribute("class");if(h)for(var l=h.split(" "),m=0;m<l.length;m++)switch(h=l[m],h){case "pc8080-binding":(h=F(k))&&h.binding&&a.M(h.type,h.binding,k,h.value),m=l.length}}}}
function H(a,b,c){c&&(b+="-"+c+"-object");if(a.getElementsByClassName)return a.getElementsByClassName(b);var d;c=[];a=a.getElementsByTagName("*");var f=new RegExp("(^| )"+b+"( |$)");b=0;for(d=a.length;b<d;b++)f.test(a[b].className)&&c.push(a[b]);return c}
y.prototype={constructor:y,parent:null,toString:function(){return this.name?this.name:this.id||this.type},M:function(a,b,c){switch(b){case "clear":return this.i[b]||(this.i[b]=c,c.onclick=function(a){return function(){a.i.print&&(a.i.print.value="")}}(this)),!0;case "print":return this.i[b]||(this.Ea=this.i[b]=c,c.value="",this.L=function(a){return function(b,c){8192<a.value.length&&(a.value=a.value.substr(a.value.length-4096));a.value+=(void 0!==c?c+": ":"")+(b||"")+"\n";a.scrollTop=a.scrollHeight}}(c),
this.G=function(a,b,c){this.L(a,"notice",c)}),!0;default:return!1}},log:function(){},L:function(){},status:function(a){this.L(this.La+": "+a)},G:function(a,b){b||u(a)},V:function(){return this.c.F=!0},U:function(a,b){b&&(this.c.F=!1);return!0}};function Aa(a,b){if(a.c.Fa)return a.c.la&&(a.c.la=!1),a.c.Fa=!1;if(a.c.X)return a.L(a.toString()+" error"),!1;a.c.la=b;return a.c.la}function I(a){if(!a.c.X&&(a.c.ca=!0,a.c.ca)){var b=a.za;a.za=null;b&&b()}}
function Ba(a,b){b&&(a.c.ca?b():a.za=b);return a.c.ca}
var Ca="undefined"!==typeof ArrayBuffer,Da=[1,0,0,1,0,1,1,0,0,1,1,0,1,0,0,1,0,1,1,0,1,0,0,1,1,0,0,1,0,1,1,0,0,1,1,0,1,0,0,1,1,0,0,1,0,1,1,0,1,0,0,1,0,1,1,0,0,1,1,0,1,0,0,1,0,1,1,0,1,0,0,1,1,0,0,1,0,1,1,0,1,0,0,1,0,1,1,0,0,1,1,0,1,0,0,1,1,0,0,1,0,1,1,0,0,1,1,0,1,0,0,1,0,1,1,0,1,0,0,1,1,0,0,1,0,1,1,0,0,1,1,0,1,0,0,1,1,0,0,1,0,1,1,0,1,0,0,1,0,1,1,0,0,1,1,0,1,0,0,1,1,0,0,1,0,1,1,0,0,1,1,0,1,0,0,1,0,1,1,0,1,0,0,1,1,0,0,1,0,1,1,0,1,0,0,1,0,1,1,0,0,1,1,0,1,0,0,1,0,1,1,0,1,0,0,1,1,0,0,1,0,1,1,0,0,1,1,0,1,
0,0,1,1,0,0,1,0,1,1,0,1,0,0,1,0,1,1,0,0,1,1,0,1,0,0,1];function Ea(a){y.call(this,"Panel",a,Ea)}B(Ea);e=Ea.prototype;e.M=function(a,b,c,d){return this.h&&this.h.M(a,b,c,d)||this.a&&this.a.M(a,b,c,d)||this.b&&this.b.M(a,b,c,d)?!0:this.parent.M.call(this,a,b,c,d)};e.ma=function(a,b,c,d){this.h=a;this.o=b;this.a=c;this.H=d;this.b=Fa(a,"Keyboard")};e.V=function(a,b){b||Ga();return!0};e.U=function(){return!0};e.$=function(){};
function Ga(){for(var a=!1,b=H(document,"pc8080","panel"),c=0;c<b.length;c++){var d=b[c],f=F(d),g;a:{g=f.id;if(void 0!==g)for(var k=void 0,k=0;k<z.length;k++)if(z[k].id===g){g=z[k];break a}g=null}g||(a=!0,g=new Ea(f));G(g,d);a&&I(g)}}w(Ga);
function Ha(a,b,c){y.call(this,"Bus",a,Ha);this.a=b;this.H=c;this.g=a.buswidth||16;this.o=Math.pow(2,this.g);this.h=this.o-1|0;this.j=20>=this.g?12:24>=this.g?14:15;this.l=1<<this.j;this.m=this.l>>2;this.s=this.l-1;this.f=this.o/this.l|0;a=new J;Ia(a,this.H);this.b=Array(this.f);for(b=0;b<this.f;b++)this.b[b]=a;a=this.a;b=this.b;c=this.j;var d=this.h;a.I=b;a.j=c;a.l=1<<a.j;a.K=a.l-1;a.va=b.length;a.ja=a.va-1;a.S=d;I(this)}B(Ha);Ha.prototype.reset=function(){};
Ha.prototype.V=function(a,b){b||this.reset();return!0};function Ja(a,b,c,d){for(var f=b>>>a.j;0<c&&f<a.b.length;){var g=a.b[f],k=f*a.l,h=c>a.l?a.l:c;if(g&&g.size){if(g.type==d){if(b+c<=g.ka)return g.Da+=g.ka-b,g.ka=b,!0;if(b>=g.ka+g.Da){h=g.size-(b-k);h>c&&(h=c);g.Da=b-g.ka+h;c-=h;b=k+a.l;continue}}return Ka(1,b,c)}g=a.b[f];b=new J(b,h,a.l,d);Ia(b,a.H,g);a.b[f++]=b;b=k+a.l;c-=h}return 0>=c?!0:Ka(2,b,c)}function Ka(a,b,c){u("Memory block error ("+a+": "+n(b)+","+n(c)+")");return!1}var La;
if(Ca){var Ma=new ArrayBuffer(2);(new DataView(Ma)).setUint16(0,256,!0);La=256===(new Uint16Array(Ma))[0]}else La=!1;var Na=La;
function J(a,b,c,d){this.id=Oa+=2;this.a=null;this.ka=a;this.Da=b;this.size=c||0;this.type=d||Pa;this.g=d==Qa;Ia(this);this.T=this.eb=!1;if(c)if(Ca)this.f=new ArrayBuffer(c),this.i=new DataView(this.f,0,c),this.b=new Uint8Array(this.f,0,c),this.j=new Uint16Array(this.f,0,c>>1),this.a=new Int32Array(this.f,0,c>>2),Ra(this,Na?Sa:Ta);else{this.a=Array(c>>2);for(a=0;a<this.a.length;a++)this.a[a]=0;Ra(this,Ua)}else Ra(this)}var Pa=0,Qa=2,Oa=0;
J.prototype={constructor:J,parent:null,save:function(){var a,b;if(Ca)for(a=Array(this.size>>2),b=0;b<a.length;b++)a[b]=this.i.getInt32(b<<2,!0);else a=this.a;return a},restore:function(a){if(a&&this.size==a.length<<2){var b;if(Ca)for(b=0;b<a.length;b++)this.i.setInt32(b<<2,a[b],!0);else this.a=a;return this.T=!0}return!1},l:function(){return 255},s:function(){},m:function(a,b){return this.ua(a++,b++)|this.ua(a,b)<<8},u:function(a,b,c){this.ia(a++,b&255,c++);this.ia(a,b>>8,c)},C:function(a){return this.a[a>>
2]>>>((a&3)<<3)&255},N:function(a){var b=a>>2;a=(a&3)<<3;var c=this.a[b]>>a;return 24>a?c&65535:c&255|(this.a[b+1]&255)<<8},W:function(a,b){var c=a>>2,d=(a&3)<<3;this.a[c]=this.a[c]&~(255<<d)|b<<d;this.T=!0},wa:function(a,b){var c=a>>2,d=(a&3)<<3;24>d?this.a[c]=this.a[c]&~(65535<<d)|b<<d:(this.a[c]=this.a[c]&16777215|b<<24,c++,this.a[c]=this.a[c]&-256|b>>8);this.T=!0},A:function(a,b){return this.w(a,b)},I:function(a,b){return this.J(a,b)},R:function(a,b,c){this.g||this.Za(a,b,c)},ba:function(a,b,
c){this.g||this.ja(a,b,c)},v:function(a){return this.b[a]},B:function(a){return this.b[a]},D:function(a){return this.i.getUint16(a,!0)},K:function(a){return a&1?this.b[a]|this.b[a+1]<<8:this.j[a>>1]},P:function(a,b){this.b[a]=b;this.T=!0},S:function(a,b){this.b[a]=b;this.T=!0},aa:function(a,b){this.i.setUint16(a,b,!0);this.T=!0},va:function(a,b){a&1?(this.b[a]=b,this.b[a+1]=b>>8):this.j[a>>1]=b;this.T=!0}};function Ia(a,b,c){a.H=b;a.h=a.o=0;c&&((a.h=c.h)&&Va(a,Wa,!1),(a.o=c.o)&&Xa(a,Wa,!1))}
function Xa(a,b,c){c&&a.o||(a.ia=!a.g&&b[2]||a.s,a.ib=!a.g&&b[3]||a.u);if(c||void 0===c)a.Za=b[2]||a.s,a.ja=b[3]||a.u}function Va(a,b,c){c&&a.h||(a.ua=b[0]||a.l,a.gb=b[1]||a.m);if(c||void 0===c)a.w=b[0]||a.l,a.J=b[1]||a.m}function Ra(a,b){b||(b=Ya);Va(a,b,void 0);Xa(a,b,void 0)}var Ya=[],Ua=[J.prototype.C,J.prototype.N,J.prototype.W,J.prototype.wa],Wa=[J.prototype.A,J.prototype.I,J.prototype.R,J.prototype.ba];
if(Ca)var Ta=[J.prototype.v,J.prototype.D,J.prototype.P,J.prototype.aa],Sa=[J.prototype.B,J.prototype.K,J.prototype.S,J.prototype.va];
function Za(a,b){y.call(this,"CPU",a,Za);var c=a.cycles||b,d=a.multiplier||1;this.a={};this.a.ha=c;this.a.ga=d;this.a.Ga=Math.round(this.a.ha/1E4)/100;this.a.da=this.a.Ga*this.a.ga;this.c.O=!1;this.c.Ra=!1;this.c.Pa=a.autoStart;this.c.Qa=!1;this.c.xa=!1;this.a.Ba=this.a.fa=0;this.a.Ca=a.csStart;this.a.na=a.csInterval;this.a.oa=a.csStop;this.bb=this.Ja.bind(this);I(this)}B(Za);var $a=["power","reset"];e=Za.prototype;
e.ma=function(a,b,c,d){this.h=a;this.o=b;this.H=d;for(b=0;b<$a.length;b++)(c=this.i[$a[b]])&&this.h.M(null,$a[b],c);Fa(a,"FPU");this.s=Fa(a,"ChipSet");a=ab(a,"autoStart");null!=a&&(this.c.Pa="true"==a?!0:"false"==a?!1:!!a);I(this)};e.reset=function(){};e.save=function(){return null};e.restore=function(){return!1};e.V=function(a,b){if(!b){if(a&&this.restore){bb(this);if(!this.restore(a))return!1;cb(this)}else this.reset();this.L("No debugger detected")}db(this);return!0};
e.U=function(a){return a?this.save():!0};function eb(a){(a.c.Pa||void 0===a.i.run)&&a.Ja()}e.Sa=function(){return 0};function cb(a){void 0===a.a.Ca&&(a.a.Ca=0);void 0===a.a.na&&(a.a.na=-1);void 0===a.a.oa&&(a.a.oa=-1);a.c.xa=0<=a.a.Ca&&0<a.a.na;a.c.xa&&(a.a.Ba=0,a.a.fa=a.a.Ca-a.R)}
e.M=function(a,b,c){var d=this;a=!1;switch(b){case "power":case "reset":this.i[b]=c;a=!0;break;case "run":this.i[b]=c;c.onclick=function(){var a;if(a=d.h)if(a=d.h,a.c.F)a=!0;else{var b=null,c,h=D(a.id);for(c=0;c<h.length&&(b=h[c],b===a||b.c.ca);c++);if(c==h.length)for(c=0;c<h.length&&(b=h[c],b===a||b.c.F);c++);c==h.length&&(b=a);u("The "+b.type+" component ("+b.id+") is not "+(b.c.ca?"powered yet":"ready yet"+(b.za?" (waiting for notification)":""))+".");a=!1}a&&(d.c.O?K(d,!0):d.Ja())};a=!0;break;
case "speed":this.i[b]=c;a=!0;break;case "setSpeed":this.i[b]=c,c.onclick=function(){fb(d,d.a.ga<<1)},c.textContent=this.a.da.toFixed(2)+"Mhz",a=!0}return a};function gb(a,b,c){a.R+=b;c&&(a.P=a.b=0)}function hb(a,b){var c=30;60>c&&(c=60);2>c&&(c=2);var d=1;b&&1<a.a.ga&&a.a.Y&&(d=a.a.Y/a.a.Ga);a.a.Ta=Math.round(1E3/30);a.a.fb=Math.floor(a.a.ha/c*d);a.a.Ha=Math.floor(a.a.ha/30*d);a.a.Va=Math.floor(a.a.ha/60*d);a.a.Ua=Math.floor(a.a.ha/2*d);b||(a.a.ra=a.a.Ha,a.a.qa=a.a.Va,a.a.pa=a.a.Ua);a.a.Ia=0}
function ib(a){return a.R+a.N+a.P-a.b}function bb(a){a.a.Y=0;a.R=a.N=a.P=a.b=0;cb(a);fb(a,1)}function fb(a,b){if(void 0!==b){.8>a.a.Y/a.a.da&&(b=1);a.a.ga=b;var c=a.a.Ga*a.a.ga;if(a.a.da!=c){a.a.da=c;var c=a.a.da.toFixed(2)+"Mhz",d=a.i.setSpeed;d&&(d.textContent=c);a.L("target speed: "+c)}}gb(a,a.N);a.N=0;a.a.ea=p();a.a.Z=0;hb(a)}
e.Ja=function(){if(Aa(this,!0)){if(!this.c.O){fb(this);this.h&&this.h.start(this.a.ea,ib(this));this.c.O=!0;this.c.Ra=!0;this.s&&this.s.hb();var a=this.i.run;a&&(a.textContent="Halt");this.h&&this.h.$(!0)}this.a.Ia>=this.a.ha&&hb(this,!0);this.a.sa=0;this.a.Aa=p();this.a.Z&&(a=this.a.Aa-this.a.Z,a>this.a.Ta&&(this.a.ea+=a,this.a.ea>this.a.Aa&&(this.a.ea=this.a.Aa)));try{do{var b=this.c.xa?1:this.a.fb;this.s&&(this.s.Ya(),b=this.s.kb(0,b),b=this.s.jb(b));try{this.Xa(b)}catch(f){if("number"!=typeof f)throw f;
}var c=this.P-this.b;this.N+=c;this.a.sa+=c;gb(this,0,!0);a=c;if(this.c.xa){var d=!1;this.a.Ba=this.a.Ba+this.Sa()|0;this.a.fa-=a;0>=this.a.fa&&(this.a.fa+=this.a.na,d=!0);0<=this.a.oa&&this.a.oa<=ib(this)&&(this.a.na=this.a.oa=-1,cb(this),K(this),d=!0);d&&this.L(ib(this)+" cycles: checksum="+n(this.a.Ba))}this.a.qa-=c;0>=this.a.qa&&(this.a.qa+=this.a.Va);this.a.pa-=c;0>=this.a.pa&&(this.a.pa+=this.a.Ua,this.h&&this.h.$());this.a.ra-=c;if(0>=this.a.ra){this.a.ra+=this.a.Ha;break}}while(this.c.O)}catch(f){K(this);
db(this);this.h&&this.h.stop(p(),ib(this));Aa(this,!1);b=f.stack||f.message;this.c.X=!0;this.G(b);return}b=setTimeout;c=this.bb;this.a.Z=p();a=this.a.Ta;this.a.sa&&(a=Math.round(a*this.a.sa/this.a.Ha));a-=this.a.Z-this.a.Aa;if(d=this.a.Z-this.a.ea)this.a.Y=Math.round(this.N/(10*d))/100,864E5<=d&&(this.R=0,this.s&&this.s.Ya(!0),fb(this));if(0>a||this.a.Y<this.a.da)a=0;this.a.Ia+=this.a.sa;this.a.Z+=a;b(c,a)}else db(this),this.h&&this.h.stop(p(),ib(this))};e.Xa=function(){return 0};
function K(a,b){a.c.la&&(a.c.Fa=!0);a.P-=a.b;a.b=0;gb(a,a.N);a.N=0;if(a.c.O){a.c.O=!1;a.s&&a.s.hb();var c=a.i.run;c&&(c.textContent="Run")}a.c.ya=b}function db(a){a.h&&a.h.$(void 0)}function jb(a){this.ab=a.model||8080;Za.call(this,a,1E6);this.$a=kb;bb(this);this.c.ya=this.c.cb=!1;this.wa=0;this.I=[];this.j=this.l=this.K=this.va=this.ja=this.S=0;lb(this)}B(jb,Za);e=jb.prototype;e.reset=function(){this.c.O&&K(this);lb(this);bb(this);this.c.X=!1};
function lb(a){a.g=0;a.v=0;a.A=0;a.w=0;a.B=0;a.C=0;a.D=0;a.ba=0;a.u=0;mb(a,0);a.aa=0}e.Sa=function(){var a=this.g+this.v+this.A+this.w+this.B+this.C+this.D|0;return a=a+this.ba+this.u+nb(this)|0};
e.save=function(){var a=new L(this);M(a,0,[this.g,this.v,this.A,this.w,this.B,this.C,this.D,this.ba,this.u,nb(this)]);M(a,1,[this.W,this.aa,this.R,this.a.ga]);for(var b=this.o,c=0,d=[],f=0;f<b.f;f++){var g=b.b[f];if(g.T||g.eb){d[c++]=f;var k=c++;a:if(g=g.save()){for(var h=0,l=0,m=[];h<g.length;){for(var A=g[h],r=h+1;r<g.length&&g[r]===A;)r++;m[l++]=r-h;m[l++]=A;h=r}if(m.length<g.length){g=m;break a}}d[k]=g}}M(a,2,d);return a.data()};
e.restore=function(a){var b=a[0];this.g=b[0];this.v=b[1];this.A=b[2];this.w=b[3];this.B=b[4];this.C=b[5];this.D=b[6];this.ba=b[7]&65535;this.u=b[8]&65535;mb(this,b[9]);b=a[1];this.W=b[0];this.aa=b[1];this.R=b[2];fb(this,b[3]);a:{b=this.o;a=a[2];var c;for(c=0;c<a.length-1;c+=2){var d=a[c],f=a[c+1];if(f&&f.length<b.m){for(var g=0,k=Array(b.m),h=0;h<f.length-1;)for(var l=f[h++],m=f[h++];l--;)k[g++]=m;f=k}g=b.b[d];if(!g||!g.restore(f)){u("Unable to restore memory block "+d);b=!1;break a}}b=!0}return b};
e.M=function(a,b,c){var d=!1;switch(b){case "A":case "B":case "C":case "D":case "E":case "H":case "L":case "SP":case "PC":case "F":case "SF":case "ZF":case "AF":case "PF":case "CF":this.i[b]=c;this.wa++;d=!0;break;default:d=this.parent.M.call(this,a,b,c)}return d};function ob(a){return a.v<<8|a.A}function pb(a,b){a.v=b>>8&255;a.A=b&255}function qb(a){return a.w<<8|a.B}function rb(a,b){a.w=b>>8&255;a.B=b&255}function N(a){return a.C<<8|a.D}function O(a,b){a.C=b>>8&255;a.D=b&255}
function nb(a){return a.Na&-214|(a.m&128?128:0)|(a.f&255?0:64)|((a.m^a.J)&16?16:0)|(Da[a.m&255]?4:0)|(a.f&256?1:0)}function mb(a,b){a.f=a.m=a.J=0;b&1&&(a.f|=256);b&4||(a.m|=1);b&16&&(a.J|=16);b&64||(a.f|=255);b&128&&(a.m^=192);a.Na=a.Na&-513|b&512|2}function P(a,b){a.J=b;b=(a.m=b+1)&255;a.f=a.f&-256|b;return b}function Q(a,b){a.J=b;b=(a.m=b-1)&255;a.f=a.f&-256|b;return b}function sb(a,b){return a.I[(b&a.S)>>>a.j].ua(b&a.K,b)}
function tb(a,b){var c=b&a.K,d=(b&a.S)>>>a.j;if(c<a.K)return a.I[d].gb(c,b);c=a.I[d].ua(c,b);return c|=a.I[d+1&a.ja].ua(0,b+1)<<8}function R(a){var b=sb(a,a.u);a.u=a.u+1&65535;return b}function ub(a){var b=tb(a,a.u);a.u=a.u+2&65535;return b}function S(a,b,c,d){d=d||2;a.i[b]&&(void 0===c&&(a.c.X=!0,a.G("Value for "+b+" is invalid"),K(a)),c=!a.c.O||a.c.Qa?n(c,d):"--------".substr(0,d),a.i[b].textContent!=c&&(a.i[b].textContent=c))}
e.$=function(a){this.wa&&(a||!this.c.O||this.c.Qa)&&(S(this,"A",this.g),S(this,"B",this.v),S(this,"C",this.A),S(this,"D",this.w),S(this,"E",this.B),S(this,"H",this.C),S(this,"L",this.D),S(this,"SP",this.ba,4),S(this,"PC",this.u,4),a=nb(this),S(this,"F",a,2),S(this,"SF",a&128,1),S(this,"ZF",a&64,1),S(this,"AF",a&16,1),S(this,"PF",a&4,1),S(this,"CF",a&1,1));if(a=this.i.speed)a.textContent=this.c.O&&this.a.Y?this.a.Y.toFixed(2)+"Mhz":"Stopped"};
e.Xa=function(a){this.c.ya=!0;this.c.cb=!1;this.c.Ra=!1;this.P=this.b=a;this.s&&!a&&this.s.Ya();a||(this.W|=4);do{if(this.aa&&this.aa&4){this.W=this.b=0;break}this.W=0;this.$a[R(this)].call(this)}while(0<this.b);return this.c.ya?this.P-this.b:void 0===this.c.ya?0:-1};w(function(){for(var a=H(document,"pc8080","cpu"),b=0;b<a.length;b++){var c=a[b],d=F(c),d=new jb(d);G(d,c)}});function T(){this.b-=4}function U(){this.u=this.u-1&65535;K(this)}
var kb=[T,function(){pb(this,ub(this));this.b-=10},function(){var a=ob(this);this.I[(a&this.S)>>>this.j].ia(a&this.K,this.g&255,a);this.b-=7},function(){pb(this,ob(this)+1);this.b-=5},function(){this.v=P(this,this.v);this.b-=5},function(){this.v=Q(this,this.v);this.b-=5},function(){this.v=R(this);this.b-=7},function(){var a=this.g<<1;this.g=a&255|a>>8;this.f=this.f&255|a&256;this.b-=4},T,function(){var a;O(this,a=N(this)+ob(this));this.f=this.f&255|a>>8&256;this.b-=10},function(){this.g=sb(this,ob(this));
this.b-=7},function(){pb(this,ob(this)-1);this.b-=5},function(){this.A=P(this,this.A);this.b-=5},function(){this.A=Q(this,this.A);this.b-=5},function(){this.A=R(this);this.b-=7},function(){var a=this.g<<8&256;this.g=(a|this.g)>>1;this.f=this.f&255|a;this.b-=4},T,function(){rb(this,ub(this));this.b-=10},function(){var a=qb(this);this.I[(a&this.S)>>>this.j].ia(a&this.K,this.g&255,a);this.b-=7},function(){rb(this,qb(this)+1);this.b-=5},function(){this.w=P(this,this.w);this.b-=5},function(){this.w=Q(this,
this.w);this.b-=5},function(){this.w=R(this);this.b-=7},function(){var a=this.g<<1;this.g=a&255|this.f>>8;this.f=this.f&255|a&256;this.b-=4},T,function(){var a;O(this,a=N(this)+qb(this));this.f=this.f&255|a>>8&256;this.b-=10},function(){this.g=sb(this,qb(this));this.b-=7},function(){rb(this,qb(this)-1);this.b-=5},function(){this.B=P(this,this.B);this.b-=5},function(){this.B=Q(this,this.B);this.b-=5},function(){this.B=R(this);this.b-=7},function(){var a=this.g<<8&256;this.g=(this.f&256|this.g)>>1;
this.f=this.f&255|a;this.b-=4},T,function(){O(this,ub(this));this.b-=10},function(){var a=ub(this),b=N(this),c=a&this.K,d=(a&this.S)>>>this.j;c<this.K?this.I[d].ib(c,b&65535,a):(this.I[d++].ia(c,b&255,a),this.I[d&this.ja].ia(0,b>>8&255,a+1));this.b-=16},function(){O(this,N(this)+1);this.b-=5},function(){this.C=P(this,this.C);this.b-=5},function(){this.C=Q(this,this.C);this.b-=5},function(){this.C=R(this);this.b-=7},function(){var a=this.g,b=!!(this.f&256),c=!!((this.m^this.J)&16);9<(a&15)||c?(a+=
6,c=!0):c=!1;160<=a||b?(a+=96,b=!0):b=!1;this.f=this.m=this.g=a&255;this.f=b?this.f|256:this.f&-257;this.J=c?~this.m&16|this.J&-17:this.m&16|this.J&-17;this.b-=4},T,function(){var a;O(this,a=N(this)+N(this));this.f=this.f&255|a>>8&256;this.b-=10},function(){O(this,tb(this,ub(this)));this.b-=16},function(){O(this,N(this)-1);this.b-=5},function(){this.D=P(this,this.D);this.b-=5},function(){this.D=Q(this,this.D);this.b-=5},function(){this.D=R(this);this.b-=7},function(){this.g=~this.g&255;this.b-=4},
U,U,U,U,U,U,U,U,U,U,U,U,U,U,U,U,U,U,U,U,U,U,U,U,U,U,U,U,U,U,U,U,U,U,U,U,U,U,U,U,U,U,U,U,U,U,U,U,U,U,U,U,U,U,U,U,U,U,U,U,U,U,U,U,U,U,U,U,U,U,U,U,U,U,U,U,U,U,U,U,U,U,U,U,U,U,U,U,U,U,U,U,U,U,U,U,U,U,U,U,U,U,U,U,U,U,U,U,U,U,U,U,U,U,U,U,U,U,U,U,U,U,U,U,U,U,U,U,U,U,U,U,U,U,U,U,U,U,U,U,U,U,U,U,U,U,U,U,U,U,U,U,U,U,U,U,U,U,U,U,U,U,U,U,U,U,U,U,U,U,U,U,U,U,U,U,U,U,U,U,U,U,U,U,U,U,U,U,U,U,U,U,U,U,U,U,U,U,U,U,U,U,U,U,U,U,U,U];
function V(a){y.call(this,"ROM",a,V);this.b=null;this.l=a.addr;this.f=a.size;this.g=a.alias;this.h=a.file;this.m=ba(this.h);if(this.h){a=this.h;var b=ca(this.m);"json"!=b&&"hex"!=b&&(a=t()+"/api/v1/dump?file="+this.h+"&format=bytes&decimal=true");var c=this;q(a,null,!0,function(a,b,g){vb(c,a,b,g)})}}B(V);V.prototype.ma=function(a,b,c,d){this.o=b;this.a=c;this.H=d;wb(this)};V.prototype.V=function(){this.j&&(this.H&&this.H.a(this.id,this.l,this.f,this.j),delete this.j);return!0};V.prototype.U=function(){return!0};
function vb(a,b,c,d){if(d)a.G("Unable to load system ROM (error "+d+": "+b+")");else{za(a.Ma,b,c);if("["==c.charAt(0)||"{"==c.charAt(0))try{var f=eval("("+c+")"),g=f.bytes,k=f.data;if(g)a.b=g;else if(k)for(a.b=Array(4*k.length),d=c=0;c<k.length;c++)a.b[d++]=k[c]&255,a.b[d++]=k[c]>>8&255,a.b[d++]=k[c]>>16&255,a.b[d++]=k[c]>>24&255;else a.b=f;a.j=f.symbols;if(!a.b.length){u("Empty ROM: "+b);return}if(1==a.b.length){u(a.b[0]);return}}catch(h){a.G("ROM data error: "+h.message);return}else for(b=c.replace(/\n/gm,
" ").replace(/ +$/,"").split(" "),a.b=Array(b.length),f=0;f<b.length;f++)a.b[f]=aa(b[f]);wb(a)}}
function wb(a){if(!Ba(a))if(!a.h)I(a);else if(a.b&&a.o){if(a.b.length!=a.f){var b="ROM size (0x"+n(a.b.length)+") does not match specified size ("+("0x"+n(a.f))+")";a.c.X=!0;a.G(b)}else{b=a.l;if(Ja(a.o,b,a.f,Qa)){for(var c=0;c<a.b.length;c++){var d=a.o,f=b+c;d.b[(f&d.h)>>>d.j].Za(f&d.s,a.b[c]&255,f)}b=!0}else b=!1;if(b){b=[];"number"==typeof a.g?b.push(a.g):null!=a.g&&a.g.length&&(b=a.g);for(c=0;c<b.length;c++){for(var g=a,d=b[c],f=g.o,k=g.f,h=[],l=g.l>>>f.j;0<k&&l<f.b.length;)h.push(f.b[l++]),k-=
f.l;f=g.o;g=g.f;k=0;for(d>>>=f.j;0<g&&d<f.b.length;){l=h[k++];if(!l)break;f.b[d++]=l;g-=f.l}}delete a.b}}I(a)}}w(function(){for(var a=H(document,"pc8080","rom"),b=0;b<a.length;b++){var c=a[b],d=F(c),d=new V(d);G(d,c)}});function xb(a){y.call(this,"RAM",a,xb);this.g=a.addr;this.f=a.size;this.b=!1}B(xb);e=xb.prototype;e.ma=function(a,b,c,d){this.o=b;this.a=c;this.H=d;I(this)};e.V=function(a,b){b||this.reset();return!0};e.U=function(a){return a?this.save():!0};
e.reset=function(){!this.b&&this.f&&Ja(this.o,this.g,this.f,1)&&(this.b=!0,this.status(Math.floor(this.f/1024)+"Kb allocated"));this.b||u("No RAM allocated")};e.save=function(){return null};e.restore=function(){return!0};w(function(){for(var a=H(document,"pc8080","ram"),b=0;b<a.length;b++){var c=a[b],d=F(c),d=new xb(d);G(d,c)}});function yb(a){y.call(this,"Keyboard",a,yb);I(this)}B(yb);w(function(){for(var a=H(document,"pc8080","keyboard"),b=0;b<a.length;b++){var c=a[b],d=F(c),d=new yb(d);G(d,c)}});
function zb(a){y.call(this,"Video",a,zb);I(this)}B(zb);
w(function(){for(var a=H(document,"pc8080","video"),b=0;b<a.length;b++){var c=a[b],d=F(c),f=document.createElement("canvas");if(void 0===f||!f.getContext){c.innerHTML="<br/>Missing &lt;canvas&gt; support. Please try a newer web browser.";break}f.setAttribute("class","pcjs-canvas");f.setAttribute("width",d.screenWidth);f.setAttribute("height",d.screenHeight);f.style.backgroundColor=d.screenColor;f.style.height="auto";0<=(window?window.navigator.userAgent:"").indexOf("MSIE")&&(c.onresize=function(a,
b,c,d){return function(){b.style.height=(a.clientWidth*d/c|0)+"px"}}(c,f,d.screenWidth,d.screenHeight),c.onresize());var g=+(d.aspect||ta.aspect);g&&.3<=g&&3.33>=g&&(pa("onresize",function(a,b,c){return function(){b.style.height=(a.clientWidth/c|0)+"px"}}(c,f,g)),window.onresize());c.appendChild(f);g=document.createElement("textarea");ma("iOS")&&(g.setAttribute("autocapitalize","off"),g.setAttribute("autocorrect","off"));c.appendChild(g);f.getContext("2d");d=new zb(d);G(d,c)}});
function L(a,b,c){this.id=a.id;this.key=Ab(a,b,c);this.H=a.H;Bb(this,a.Wa)}function Ab(a,b,c){a=a.id;if(b){var d=b.indexOf(".");0<d&&(a+=".v"+b.substr(0,d))}c&&(a+="."+c);return a}
L.prototype={constructor:L,value:function(){return this[this.id]},data:function(){return this[this.id]},toString:function(){var a=this[this.id];return"string"==typeof a?a:JSON.stringify(a)},clear:function(a){Bb(this);var b=[];try{for(var c=0,d=window.localStorage.length;c<d;c++)b.push(window.localStorage.key(c))}catch(f){}for(c=0;c<b.length;c++)if((d=b[c])&&(a||d.substr(0,this.key.length)==this.key)){try{window.localStorage.removeItem(d)}catch(f){}b.splice(c,1);c=0}}};
function Bb(a,b){a[a.id]={};b&&M(a,"parms",b);a.a=!1}function Cb(a){var b=!0;if(ja()){var c=JSON.stringify(a[a.id]);la(a.key,c)||(u("Unable to store "+c.length+" bytes in browser local storage"),b=!1)}return b}function Db(a){var b=!0;try{a[a.id]=JSON.parse(a[a.id])}catch(c){u(c.message||c),b=!1}return b}function W(a,b){return b?(a[a.id]=b,a.a=!0):a.a?!0:ja()&&(b=ka(a.key))?(a[a.id]=b,a.a=!0):!1}function X(a,b){return a[a.id][b]||null}function M(a,b,c){try{a[a.id][b]=c}catch(d){}}
function Eb(a,b,c){y.call(this,"Computer",a,Eb);this.c.F=!1;Fb(this,b);this.A=ab(this,"autoPower",a);this.g=0;this.I=a.busWidth||a.buswidth;this.b=Y;this.u=null;this.l=this.D=!1;this.J=ab(this,"url")||"";(Math.random()+.1).toString(36);this.f=Gb(this);if(this.a=E("CPU",this.id)){this.H=E("Debugger",this.id);this.K=[];for(b=null;b=Fa(this,"Video",b);)this.K.push(b);this.o=new Ha({id:this.Ma+".bus",buswidth:this.I},this.a,this.H);var d,f=D(this.id);if((this.h=E("Panel",this.id))&&this.h.Ea)for(b=0;b<
f.length;b++)d=f[b],d.G=this.h.G,d.L=this.h.L,d.Ea=this.h.Ea;for(b=0;b<f.length;b++)d=f[b],d.ma&&d.ma(this,this.o,this.a,this.H);b=null;d=a.resume;void 0!==d&&(1<d.length?b=this.s=d:this.b=parseInt(d,10));var g;if(a=ab(this,"state")||(g=!0,a.state))b=this.w=a,g||(this.l=!0,this.b=Y),this.b&&(this.v=new L(this,Z),W(this.v)?b=null:delete this.v);!b&&this.b&&(b=Hb(this))&&(this.l=!0);if(b){var k=this;q(b,null,!0,function(a,b,c){c?(k.s=null,k.l=!1,k.G("Unable to load machine state from server (error "+
c+(b?": "+(String.prototype.trim?b.trim():b.replace(/^\s+|\s+$/g,"")):"")+")")):(k.u=b,k.D=!0);I(k)})}else I(this);this.i.power||(this.A=!0);!c&&this.A&&Ib(this,this.ta)}else u("Unable to find CPU component")}B(Eb);var Z="1.21.7",Y=0;function Fb(a,b){if(!b){var c;if("object"==typeof resources&&(c=resources.parms))try{b=eval("("+c+")")}catch(d){u(d.message+" ("+c+")")}}a.m=b}
function ab(a,b,c){var d=b.toLowerCase(),d=ta[b]||ta[d];void 0===d&&a.m&&(d=a.m[b]);void 0===d&&c&&(d=c[b]);void 0===d&&"object"==typeof resources&&resources[b]&&(d=b);return d}function Ib(a,b,c){for(var d=D(a.id),f=0;f<=d.length;f++){var g=f<d.length?d[f]:a;if(!Ba(g)){Ba(g,function(){Ib(a,b,c)});return}}b.call(a,c)}
function Jb(a,b){var c=new L(a,Z,"validate");if(W(c)&&Db(c)){var d=X(c,"timestamp"),f=b?X(b,"timestamp"):"unknown";d!=f&&(a.G("Machine state may be out-of-date\n("+d+" vs. "+f+")\nCheck your browser's local storage limits"),b||c.clear())}}e=Eb.prototype;
e.ta=function(a){void 0===a&&(a=this.b||(this.u?1:Y));if(!this.g){this.g++;var b=!1,c=!1;this.C=!1;var d=this.v||new L(this,Z);if(-1==a)b=!0;else if(a>Y){if(W(d,this.u)){this.j=new L(this,Z,"failsafe");W(this.j)&&(Kb(this,d),a=2,Bb(this.j));M(this.j,"timestamp",ga());Cb(this.j);var f=this.b&&!this.l;if(1==a||ha("Click OK to restore the previous PC8080 machine state, or CANCEL to reset the machine.")){if(c=Db(d)){var g=X(d,"code"),k=X(d,"data");g&&("ok"==g?W(d,k):("error"==g&&"no machine state"!=k?
(this.G("Error: "+k),"unable to verify user"==k&&(la("user",""),this.f=null)):this.L(g+": "+k),Bb(d),W(d)?(c=Db(d),f=!0):c=!1))}f&&Jb(this,c?d:null)}else 2==a&&d.clear()}else Jb(this);delete this.u;delete this.v}f=D(this.id);for(g=0;g<f.length;g++)k=f[g],k!==this&&k!=this.a&&(c=Lb(this,k,d,b,c));b=[d,a,c];-1!=a?Ib(this,this.Oa,b):this.Oa(b)}};
function Lb(a,b,c,d,f){if(!b.c.F){b.c.F=!0;if(b.V){var g=null;f&&((g=X(c,b.id))||(g=X(c,b.id.replace(/[a-z0-9]\./i,"."))));"string"===typeof g&&(g=null);!b.V(g,d)&&g&&(u("Unable to restore state for "+b.type),a.w&&!a.D?(c.clear(),a.b=Y,window&&window.location.reload()):a.C=!0,b.V(null),f=!1)}if(!d&&b.Ka)for(a=b.Ka.split("|"),c=0;c<a.length;c++)b.status(a[c])}return f}
e.Oa=function(a){var b=a[0],c=0>a[1];a=a[2];this.c.F=!0;var d=this.i.power;d&&(d.textContent="Shutdown");this.B||(this.L("PC8080 v"+Z+"\nCopyright \u00a9 2012-2016 Jeff Parsons <Jeff@pcjs.org>\nLicense: GPL version 3 or later <http://gnu.org/licenses/gpl.html>"),this.B=!0);this.a&&(Lb(this,this.a,b,c,a),eb(this.a));this.C&&(Kb(this,b),b.clear());!c&&this.j&&(this.j.clear(),delete this.j);this.g=0};
function Kb(a,b){if(ha("There may be a problem with your PC8080 machine.\n\nTo help us diagnose it, click OK to send this PC8080 machine state to http://www.pcjs.org.")){var c=a.J,d=a.f||"",f=b.toString(),g={app:"PC8080"};g.ver=Z;g.url=c;g.user=d;g.type="bug";g.data=f;q("http://www.pcjs.org/api/v1/report",g,!0)}}
function Mb(a,b,c){var d,f="none";if(a.g)return null;a.g--;var g=new L(a,Z),k=new L(a,Z,"validate"),h=ga();M(k,"timestamp",h);M(g,"timestamp",h);M(g,"version","1.21.7");M(g,"url",window?window.location.href:null);M(g,"browser",window?window.navigator.userAgent:"");a.a&&a.a.U&&(c&&K(a.a),d=a.a.U(b,c),"object"===typeof d&&M(g,a.a.id,d),c&&(a.a.c.F=!1,!1===d&&(f=null)));for(var h=D(a.id),l=0;l<h.length;l++){var m=h[l];m.c.F&&(m.U&&(d=m.U(b,c),"object"===typeof d&&M(g,m.id,d)),c&&(m.c.F=!1,!1===d&&(f=
null)))}f&&(c?(h=d=!1,b?(a.f&&Nb(a,a.f,g.toString()),Cb(k)&&Cb(g)||(f=null,d=h=!0)):a.b&&(d=!0,h=3==a.b),d&&g.clear(h)):f=g.toString());c&&(a.c.F=!1,b=a.i.power)&&(b.textContent="Power");a.g=0;return f}e.reset=function(){this.o&&this.o.reset&&this.o.reset();for(var a=D(this.id),b=0;b<a.length;b++){var c=a[b];c!==this&&c!==this.o&&c.reset&&c.reset()}};e.start=function(a,b){for(var c=D(this.id),d=0;d<c.length;d++){var f=c[d];"CPU"!=f.type&&f!==this&&f.start&&f.start(a,b)}};
e.stop=function(a,b){for(var c=D(this.id),d=0;d<c.length;d++){var f=c[d];"CPU"!=f.type&&f!==this&&f.stop&&f.stop(a,b)}};
e.M=function(a,b,c){var d=this;switch(b){case "power":return this.i[b]=c,c.onclick=function(){d.g||(d.c.F?Mb(d,!1,!0):Ib(d,d.ta))},!0;case "reset":return this.i[b]=c,c.onclick=function(){if(d.c.F&&!d.g)if(d.b&&!d.s){var a=ha("Click OK to save changes to this PC8080 machine.\n\nWARNING: If you CANCEL, all disk changes will be discarded.");Mb(d,a,!0);!a&&d.w?window&&window.location.reload():d.ta(Y)}else d.reset(),d.a&&eb(d.a)},!0;case "save":if(da(t(),"pcjs.org")){c.parentNode.removeChild(c);break}this.i[b]=
c;c.onclick=function(){var a=Gb(d,!0);if(a){var b=!!(d.b&&!d.s||d.w),c=Mb(d,b);b?Nb(d,a,c):d.G("Resume disabled, machine state not saved")}};return!0}return!1};
function Gb(a,b){var c=a.f;c||(c=ka("user"),void 0!==c?!c&&b&&(c=null,window&&(c=window.prompt("Saving machine states on the pcjs.org server is currently unsupported.\n\nIf you're running your own server, enter your user ID below.","")),c&&((c=Ob(a,c))||a.G("The user ID is invalid."))):b&&a.G("Browser local storage is not available"));return c}
function Ob(a,b){a.f=null;var c=q(t()+"/api/v1/user?req=verify&user="+b),d=c[1];if(!c[0]&&d)try{c=eval("("+d+")"),c.code&&"ok"==c.code&&(la("user",c.data),a.f=c.data)}catch(f){u(f.message+" ("+d+")")}return a.f}function Hb(a){var b=null;a.f&&(b=t()+"/api/v1/user?req=load&user="+a.f+"&state="+Ab(a,Z));return b}
function Nb(a,b,c){if(c){var d={req:"store"};d.user=b;d.state=Ab(a,Z);d.data=c;b=q(t()+"/api/v1/user",d);d=b[0];if(b[1]){if(d){var f=d.indexOf("\n");0<f&&(d=d.substr(0,f));d.indexOf("Error: ")||(d=d.substr(7))}d='{"code":'+b[1]+',"data":"'+d+'"}'}b=JSON.parse(d);b&&"ok"==b.code?a.G("Machine state saved to server"):c&&(c=b&&b.data||"unable to save machine state",c="error"==b.code?"Error: "+c:"Error "+b.code+": "+c,a.G(c),la("user",""),a.f=null)}}
function Fa(a,b,c){a=D(a.id);for(var d=0;d<a.length;d++){var f=a[d];if(c)c==f&&(c=null);else if(f.type==b)return f}return null}e.$=function(a){this.a&&this.a.$(a);this.h&&this.h.$(a)};w(function(){for(var a=H(document,"pc8080-machine"),b=0;b<a.length;b++)for(var c=a[b],d=F(c),c=H(c,"pc8080","computer"),f=0;f<c.length;f++){var g=c[f],k=F(g),k=new Eb(k,d,!0);G(k,g);k.A&&Ib(k,k.ta)}});
v.show.push(function(){for(var a=H(document,"pc8080","computer"),b=0;b<a.length;b++){var c=F(a[b]);(c=E("Computer",c.id))&&c.B&&!c.c.F&&c.ta(-1)}});v.exit.push(function(){for(var a=H(document,"pc8080","computer"),b=0;b<a.length;b++){var c=F(a[b]);(c=E("Computer",c.id))&&c.c.F&&Mb(c,!(!c.b||c.s),!0)}});var Pb=0;function Qb(a,b,c,d,f,g){f("Loading "+a+"...");q(a,null,!0,function(k,h,l){l?(h||(h="unable to load "+a+" ("+l+")"),g(h,null)):Rb(h,a,b,c,d,f,g)})}
function Rb(a,b,c,d,f,g,k){function h(a,g){if(g)k(g,null);else{if(c){za(c,b,a);var h=b;h&&0>h.indexOf("/")&&"/"==window.location.pathname.slice(-1)&&(h=window.location.pathname+h);d?"}"==d.slice(-1)?(d=d.slice(0,-1),1<d.length&&(d+=",")):d='{state:"'+d+'",':d="{";d+='url:"'+h+'"}';"object"==typeof resources&&(h=null);a=a.replace(/(<machine[^>]*\sid=)(['"]).*?\2/,"$1$2"+c+"$2"+(d?" parms='"+d+"'":"")+(h?' url="'+h+'"':""))}f||(a=a.replace(/(<xsl:variable name="APPCLASS">).*?(<\/xsl:variable>)/,"$1pc8080$2"));
h=null;if("<"==a.charAt(0))try{f||(a=a.replace(/<!DOCTYPE(.|[\r\n])*]>\s*/g,"")),window.ActiveXObject||"ActiveXObject"in window?(h=new window.ActiveXObject("Microsoft.XMLDOM"),h.async=!1,h.loadXML(a)):h=(new window.DOMParser).parseFromString(a,"text/xml")}catch(r){h=null,a=r.message}else a="unrecognized XML: "+(255<a.length?a.substr(0,255)+"...":a);k(a,h)}}a?f?Sb(a,g,h):h(a,null):k("no data"+(b?" for file: "+b:""),null)}
function Sb(a,b,c){var d;if(d=/<([a-z]+)\s+ref="(.*?)"(.*?)\/>/g.exec(a)){var f=d[2];b("Loading "+f+"...");q(f,null,!0,function(g,k,h){if(h||!k)c(a,"unable to resolve XML reference: "+d[0]+" ("+h+")");else{if(g=d[3])if(h=k.match(new RegExp("<"+d[1]+"[^>]*>"))){for(var l=h[0],m,A=/( [a-z]+=)(['"])(.*?)\2/g;m=A.exec(g);)l=0>l.indexOf(m[1])?l.replace(">",m[0]+">"):l.replace(new RegExp(m[1]+"(['\"])(.*?)\\1"),m[0]);h[0]!=l&&(k=k.replace(h[0],l))}else{c(a,"missing <"+d[1]+"> in "+f);return}k=k.replace(/<\?xml[^>]*>[\r\n]*/,
"");a=a.replace(d[0],k);Sb(a,b,c)}})}else c(a,null)}
function Tb(a,b,c,d){function f(a){if(void 0===h){var b=k&&H(k,"machine-warning");h=b&&b[0]||k}h&&(h.innerHTML=fa(a))}function g(a){f("Error: "+a);l&&(--Pb||x(!0));l=!1}var k,h,l=!0;Pb++;C[a]={};try{if(k=document.getElementById(a)){var m;if("object"==typeof resources&&(m=resources.css)){var A=document.head||document.getElementsByTagName("head")[0],r=document.createElement("style");r.type="text/css";r.styleSheet?r.styleSheet.cssText=m:r.appendChild(document.createTextNode(m));A.appendChild(r)}c||(c=
"/versions/pc8080/1.21.7/components.xsl");m=function(d,h){h?Qb(c,null,null,!1,f,function(d,m){if(m)if(za(a,c,d),f("Processing "+b+"..."),window.ActiveXObject||"ActiveXObject"in window){var l=h.transformNode(m);l?(k.outerHTML=l,--Pb||x(!0)):g("transformNodeToObject failed")}else document.implementation&&document.implementation.createDocument?(l=new XSLTProcessor,l.importStylesheet(m),(l=l.transformToFragment(h,document))?k.parentNode?(k.parentNode.replaceChild(l,k),--Pb||x(!0)):g("invalid machine element: "+
a):g("transformToFragment failed")):g("unable to transform XML: unsupported browser");else g(d)}):g(d)};"<"!=b.charAt(0)?Qb(b,a,d,!0,f,m):Rb(b,null,a,d,!1,f,m)}else g("missing machine element: "+a)}catch(ya){g(ya.message)}return l}window.embedPC8080=function(a,b,c,d){x(!1);return Tb(a,b,c,d)};window.enableEvents=x;window.sendEvent=ra;
function Ub(a,b,c,d){if(!c&&b){d.push(b);a=C[d[0]];b=null;for(var f in a)if(da(f,"components.xsl")){b=f.replace(".xsl",".css");break}b?q(b,null,!0,function(a,b){Vb(b,d)}):Vb(null,d)}else u("Error ("+c+") requesting "+a)}
function Vb(a,b){var c,d,f,g=b[0],k=b[1];c=b[4];c=c.match(/^(\s*\(function\(\)\{)([\s\S]*)(}\)\(\);\s*)$/);var h=C[g],l={},m;for(m in h){var A=h[m],r=ca(m);if("xml"==r){for(r=/[ \t]*<disk [^>]*path=(['"])(.*?)\1.*?<\/disk>\n?/g;d=r.exec(h[m]);){var ya=d[2];ya&&(h[ya]||(A=A.replace(d[0],"")))}d=m=ba(m)}else"xsl"==r&&(f=m=ba(m));l[m]=A}a&&(l[m="css"]=a);b[2]&&(l[m="parms"]=b[2]);b[3]&&(l[m="state"]=b[3]);d&&f?(m=JSON.stringify(l),k+=".js",c=c[1]+"var resources="+m+";"+c[2]+c[3],c=c.replace(/\u00A9/g,
"&#xA9;"),m=k,h=null,l="data:application/javascript,",l=ma("Firefox")?l+encodeURIComponent(c):l+encodeURI(c),m&&(h=document.createElement("a"),"string"!=typeof h.download&&(h=null)),h?(h.href=l,h.download=m,document.body.appendChild(h),h.click(),document.body.removeChild(h),c="Check your Downloads folder for "+m+"."):(window.open(l),c="Check your browser for a new window/tab containing the requested data"+(m?" ("+m+")":"")+"."),c+=', copy it to your web server as "'+k+'", and then add the following to your web page:\n\n',
c+='<div id="'+g+'"></div>\n',c+="...\n",c+='<script type="text/javascript" src="'+k+'">\x3c/script>\n',c+='<script type="text/javascript">embedPC("'+g+'","'+d+'","'+f+'");\x3c/script>\n\n',c+="The machine should appear where the <div> is located.",u(c)):u("Missing XML/XSL resources")}
window.savePC=function(a,b,c){var d=E("Computer",a),f=E("Debugger",a);if(d){var g=Mb(d,!0),k=d.m?JSON.stringify(d.m):null;b||(b="/versions/pcjs/1.21.7/pc"+(f?"-dbg":"")+".js");if(c&&c({state:g,Wa:k}))return!0;q(b,null,!0,function(c,d,f){Ub(c,d,f,[a,ba(b,!0),k,g])});return!0}u("Unable to identify machine '"+a+"'");return!1};})();
