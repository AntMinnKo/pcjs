(function(){var m;function aa(a){var b=16,c;if(a){b||(b=16);if("$"==a.charAt(0))b=16,a=a.substr(1);else if("0x"==a.substr(0,2))b=16,a=a.substr(2);else{var d=a.charAt(a.length-1).toLowerCase();"h"==d?(b=16,d=null):"."==d&&(b=10,d=null);null==d&&(a=a.substr(0,a.length-1))}var e,d=a,f=b;(f&&10!=f?16==f?null!==d.match(/^[0-9a-f]+$/i):2==f&&null!==d.match(/^[01]+$/i):null!==d.match(/^[0-9]+$/))&&!isNaN(e=parseInt(a,b))&&(c=e|0)}return c}
function n(a,b){var c="";void 0===b?b=8:8<b&&(b=8);if(null==a||isNaN(a))for(;0<b--;)c="?"+c;else for(;0<b--;){var d=a&15,d=d+(0<=d&&9>=d?48:55),c=String.fromCharCode(d)+c;a>>=4}return c}function ba(a,b){var c=a,d=a.lastIndexOf("/");0<=d&&(c=a.substr(d+1));d=c.indexOf("&");0<d&&(c=c.substr(0,d));b&&(d=c.lastIndexOf("."),0<d&&(c=c.substring(0,d)));return c}function ca(a){var b="",c=a.lastIndexOf(".");0<=c&&(b=a.substr(c+1).toLowerCase());return b}
function da(a,b){return-1!==a.indexOf(b,a.length-b.length)}var ea={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#039;"};function fa(a){return a.replace(/[&<>"']/g,function(a){return ea[a]})}var ga=Date.now||function(){return+new Date};function ha(){function a(a){return(10>a?"0":"")+a}var b=new Date;return b.getFullYear()+"-"+a(b.getMonth()+1)+"-"+a(b.getDate())+" "+a(b.getHours())+":"+a(b.getMinutes())+":"+a(b.getSeconds())}
function q(a,b,c,d){var e=0,f=null,h=null;if("object"==typeof resources&&(f=resources[a]))return d&&d(a,f,e),[f,e];if(c&&"function"==typeof resources)return resources(a,function(b,c){d&&d(a,b,c)}),h;var g=window.XMLHttpRequest?new window.XMLHttpRequest:new window.ActiveXObject("Microsoft.XMLHTTP");c&&(g.onreadystatechange=function(){4===g.readyState&&(f=g.responseText,200==g.status||!g.status&&f.length&&"file:"==(window?window.location.protocol:"file:")||(e=g.status||-1),d&&d(a,f,e))});if(b&&"object"==
typeof b){var k="",l;for(l in b)b.hasOwnProperty(l)&&(k&&(k+="&"),k+=l+"="+encodeURIComponent(b[l]));k=k.replace(/%20/g,"+");g.open("POST",a,!!c);g.setRequestHeader("Content-type","application/x-www-form-urlencoded");g.send(k)}else g.open("GET",a,!!c),"bytes"==b&&g.overrideMimeType("text/plain; charset=x-user-defined"),g.send();c||(f=g.responseText,200!=g.status&&(e=g.status||-1),d&&d(a,f,e),h=[f,e]);return h}function ia(){return"http://"+(window?window.location.host:"www.pcjs.org")}
function t(a){window&&window.alert(a)}function ja(a){var b=!1;window&&(b=window.confirm(a));return b}var ka=null;function la(){if(null==ka){var a=!1;if(window)try{window.localStorage.setItem("PCjs.localStorage","PCjs.localStorage"),a="PCjs.localStorage"==window.localStorage.getItem("PCjs.localStorage"),window.localStorage.removeItem("PCjs.localStorage")}catch(b){a=!1}ka=a}return ka}function ma(a){var b;if(window)try{b=window.localStorage.getItem(a)}catch(c){}return b}
function na(a,b){try{return window.localStorage.setItem(a,b),!0}catch(c){}return!1}function oa(a){if(window){var b=window?window.navigator.userAgent:"";return"iOS"==a&&b.match(/(iPod|iPhone|iPad)/)&&b.match(/AppleWebKit/)||"MSIE"==a&&b.match(/(MSIE|Trident)/)||0<=b.indexOf(a)?!0:!1}return!1}var pa={init:[],show:[],exit:[]},qa=!1,ra=!0;function sa(a,b){if(window){var c=window[a];window[a]="function"!==typeof c?b:function(){c&&c();b()}}}function ta(a){pa.init.push(a)}
function ua(a){if(ra)try{for(var b=0;b<a.length;b++)a[b]()}catch(c){t(""+("An unexpected exception occurred:\n\n"+c.message+"\n\nPlease send this information to support@pcjs.org. Thanks."))}}function va(a){!ra&&a?(ra=!0,qa&&wa("init")):ra=a}function wa(a){pa[a]&&ua(pa[a])}sa("onload",function(){qa=!0;ua(pa.init)});sa("onpageshow",function(){ua(pa.show)});sa(oa("Opera")||oa("iOS")?"onunload":"onbeforeunload",function(){ua(pa.exit)});
function u(a,b,c){this.type=a;b||(b={id:"",name:""});this.id=b.id;this.name=b.name;this.fb=b.comment;this.vb=b;void 0===this.id&&(this.id="");b=this.id.indexOf(".");0<b?(this.Wa=this.id.substr(0,b),this.Va=this.id.substr(b+1)):this.Va=this.id;this[a]=c;this.h={qa:!1,xa:!1,Ya:!1,P:!1,ja:!1};this.La=null;this.h.ja=!1;this.B={};this.K=null;v.push(this)}var xa=void 0,ya={};
if(window){xa||(xa=window.location.search.substr(1));for(var za,Aa=/\+/g,Ba=/([^&=]+)=?([^&]*)/g;za=Ba.exec(xa);)ya[decodeURIComponent(za[1].replace(Aa," "))]=decodeURIComponent(za[2].replace(Aa," "))}function Da(a){function b(){}if(window){if(!a)throw new TypeError;if(Object.create)return Object.create(a);var c=typeof a;if("object"!==c&&"function"!==c)throw new TypeError;}b.prototype=a;return new b}
function y(a,b){b||(b=u);a.prototype=Da(b.prototype);a.prototype.constructor=a;a.prototype.parent=b.prototype}var v=[],Ea={};function Fa(a,b,c){Ea[a]&&b&&(Ea[a][b]=c)}function C(a){var b,c=[];a&&(a=0<(b=a.indexOf("."))?a.substr(0,b+1):"");for(b=0;b<v.length;b++){var d=v[b];a&&d.id.indexOf(a)||c.push(d)}return c}
function Ga(a,b){var c;if(void 0!==a){var d;b&&(b=0<(d=b.indexOf("."))?b.substr(0,d+1):"");for(d=0;d<v.length;d++)if(c)c==v[d]&&(c=null);else if(!(a!=v[d].type||b&&v[d].id.indexOf(b)))return v[d]}return null}function D(a){var b=null;if(a=a.getAttribute("data-value"))try{b=eval("("+a+")")}catch(c){t(c.message+" ("+a+")")}return b}
function Ha(a,b){for(var c=E(b.parentNode,"pc8080-control"),d=0;d<c.length;d++)for(var e=c[d].childNodes,f=0;f<e.length;f++){var h=e[f];if(1===h.nodeType){var g=h.getAttribute("class");if(g)for(var k=g.split(" "),l=0;l<k.length;l++)switch(g=k[l],g){case "pc8080-binding":(g=D(h))&&g.binding&&a.R(g.type,g.binding,h,g.value),l=k.length}}}}
function E(a,b,c){c&&(b+="-"+c+"-object");if(a.getElementsByClassName)return a.getElementsByClassName(b);var d;c=[];a=a.getElementsByTagName("*");var e=new RegExp("(^| )"+b+"( |$)");b=0;for(d=a.length;b<d;b++)e.test(a[b].className)&&c.push(a[b]);return c}
u.prototype={constructor:u,parent:null,toString:function(){return this.name?this.name:this.id||this.type},R:function(a,b,c){switch(b){case "clear":return this.B[b]||(this.B[b]=c,c.onclick=function(a){return function(){a.B.print&&(a.B.print.value="")}}(this)),!0;case "print":return this.B[b]||(this.ea=this.B[b]=c,c.value="",this.V=function(a){return function(b,c){8192<a.value.length&&(a.value=a.value.substr(a.value.length-4096));a.value+=(void 0!==c?c+": ":"")+(b||"")+"\n";a.scrollTop=a.scrollHeight}}(c),
this.I=function(a){this.V(a,this.Va)}),!0;default:return!1}},log:function(){},V:function(){},status:function(a){this.V(this.Va+": "+a)},I:function(a,b,c){c=c||this.type;b||t((c?c+": ":"")+a)},aa:function(){return this.h.P=!0},da:function(a,b){b&&(this.h.P=!1);return!0}};function Ia(a,b){if(a.h.Ya)return a.h.xa&&(a.h.xa=!1),a.h.Ya=!1;if(a.h.ja)return a.V(a.toString()+" error"),!1;a.h.xa=b;return a.h.xa}function F(a){if(!a.h.ja&&(a.h.qa=!0,a.h.qa)){var b=a.La;a.La=null;b&&b()}}
function Ja(a,b){b&&(a.h.qa?b():a.La=b);return a.h.qa}
var Ka="undefined"!==typeof ArrayBuffer,La=[1,0,0,1,0,1,1,0,0,1,1,0,1,0,0,1,0,1,1,0,1,0,0,1,1,0,0,1,0,1,1,0,0,1,1,0,1,0,0,1,1,0,0,1,0,1,1,0,1,0,0,1,0,1,1,0,0,1,1,0,1,0,0,1,0,1,1,0,1,0,0,1,1,0,0,1,0,1,1,0,1,0,0,1,0,1,1,0,0,1,1,0,1,0,0,1,1,0,0,1,0,1,1,0,0,1,1,0,1,0,0,1,0,1,1,0,1,0,0,1,1,0,0,1,0,1,1,0,0,1,1,0,1,0,0,1,1,0,0,1,0,1,1,0,1,0,0,1,0,1,1,0,0,1,1,0,1,0,0,1,1,0,0,1,0,1,1,0,0,1,1,0,1,0,0,1,0,1,1,0,1,0,0,1,1,0,0,1,0,1,1,0,1,0,0,1,0,1,1,0,0,1,1,0,1,0,0,1,0,1,1,0,1,0,0,1,1,0,0,1,0,1,1,0,0,1,1,0,1,
0,0,1,1,0,0,1,0,1,1,0,1,0,0,1,0,1,1,0,0,1,1,0,1,0,0,1];function Ma(a){u.call(this,"Panel",a,Ma)}y(Ma);m=Ma.prototype;m.R=function(a,b,c,d){return this.u&&this.u.R(a,b,c,d)||this.a&&this.a.R(a,b,c,d)||this.C&&this.C.R(a,b,c,d)?!0:this.parent.R.call(this,a,b,c,d)};m.fa=function(a,b,c,d){this.u=a;this.m=b;this.a=c;this.K=d;this.C=Na(a,"Keyboard")};m.aa=function(a,b){b||Oa();return!0};m.da=function(){return!0};m.ma=function(){};
function Oa(){for(var a=!1,b=E(document,"pc8080","panel"),c=0;c<b.length;c++){var d=b[c],e=D(d),f;a:{f=e.id;if(void 0!==f)for(var h=void 0,h=0;h<v.length;h++)if(v[h].id===f){f=v[h];break a}f=null}f||(a=!0,f=new Ma(e));Ha(f,d);a&&F(f)}}ta(Oa);
function Pa(a,b,c){u.call(this,"Bus",a,Pa);this.a=b;this.K=c;this.i=a.busWidth||16;this.s=Math.pow(2,this.i);this.g=this.s-1|0;this.c=16>=this.i?10:20>=this.i?12:24>=this.i?14:15;this.m=1<<this.c;this.v=this.m>>2;this.f=this.m-1;this.j=this.s/this.m|0;this.u=this.j-1;this.l=[];this.o=[];this.D=[];this.C=[];a=new G;Qa(a,this.K);this.b=Array(this.j);for(b=0;b<this.j;b++)this.b[b]=a;F(this)}y(Pa);Pa.prototype.reset=function(){};Pa.prototype.aa=function(a,b){b||this.reset();return!0};
function Ra(a,b,c,d){for(var e=b,f=c,h=e>>>a.c;0<f&&h<a.b.length;){var g=a.b[h],k=h*a.m,l=a.m-(e-k);l>f&&(l=f);if(g&&g.size){if(g.type==d){if(e+f<=g.oa)return g.Ra+=g.oa-e,g.oa=e,!0;if(e>=g.oa+g.Ra){l=g.size-(e-k);l>f&&(l=f);g.Ra=e-g.oa+l;e=k+a.m;f-=l;h++;continue}}return Sa(1,e,f)}e=new G(e,l,a.m,d);Qa(e,a.K,g);a.b[h++]=e;e=k+a.m;f-=l}return 0>=f?(a.status(Math.floor(c/1024)+"Kb "+Ta[d]+" at "+("0x"+n(b,4))),!0):Sa(2,b,c)}
Pa.prototype.G=function(a){return this.b[(a&this.g)>>>this.c].Fa(a&this.f,a)};function Ua(a,b){return a.b[(b&a.g)>>>a.c].Qa(b&a.f,b)}function Va(a,b){var c=b&a.f,d=(b&a.g)>>>a.c;return c!=a.f?a.b[d].dc(c,b):a.b[d++].Fa(c,b)|a.b[d&a.u].Fa(0,b+1)<<8}Pa.prototype.S=function(a,b){this.b[(a&this.g)>>>this.c].Ga(a&this.f,b&255,a)};function Wa(a,b,c){a.b[(b&a.g)>>>a.c].Ab(b&a.f,c&255,b)}
function Xa(a,b,c){var d=b&a.f,e=(b&a.g)>>>a.c;d!=a.f?a.b[e].ec(d,c&65535,b):(a.b[e++].Ga(d,c&255,b),a.b[e&a.u].Ga(0,c>>8&255,b+1))}function Sa(a,b,c){t("Memory block error ("+a+": "+n(b)+","+n(c)+")");return!1}var Ya;if(Ka){var Za=new ArrayBuffer(2);(new DataView(Za)).setUint16(0,256,!0);Ya=256===(new Uint16Array(Za))[0]}else Ya=!1;var $a=Ya;
function G(a,b,c,d){this.id=ab+=2;this.a=null;this.oa=a;this.Ra=b;this.size=c||0;this.type=d||bb;this.f=d==db;Qa(this);this.Z=this.nb=!1;if(c)if(Ka)this.c=new ArrayBuffer(c),this.m=new DataView(this.c,0,c),this.b=new Uint8Array(this.c,0,c),this.j=new Uint16Array(this.c,0,c>>1),this.a=new Int32Array(this.c,0,c>>2),eb(this,$a?fb:gb);else{this.a=Array(c>>2);for(a=0;a<this.a.length;a++)this.a[a]=0;eb(this,hb)}else eb(this)}var bb=0,db=2,Ta=["NONE","RAM","ROM","VID","H/W"],ab=0;
G.prototype={constructor:G,parent:null,Za:function(a){this.oa=a},save:function(){var a,b;if(Ka)for(a=Array(this.size>>2),b=0;b<a.length;b++)a[b]=this.m.getInt32(b<<2,!0);else a=this.a;return a},restore:function(a){if(a&&this.size==a.length<<2){var b;if(Ka)for(b=0;b<a.length;b++)this.m.setInt32(b<<2,a[b],!0);else this.a=a;return this.Z=!0}return!1},B:function(){return 255},o:function(){},l:function(a,b){return this.Fa(a++,b++)|this.Fa(a,b)<<8},u:function(a,b,c){this.Ga(a++,b&255,c++);this.Ga(a,b>>
8,c)},C:function(a){return this.a[a>>2]>>>((a&3)<<3)&255},N:function(a){var b=a>>2;a=(a&3)<<3;var c=this.a[b]>>a;return 24>a?c&65535:c&255|(this.a[b+1]&255)<<8},W:function(a,b){var c=a>>2,d=(a&3)<<3;this.a[c]=this.a[c]&~(255<<d)|b<<d;this.Z=!0},na:function(a,b){var c=a>>2,d=(a&3)<<3;24>d?this.a[c]=this.a[c]&~(65535<<d)|b<<d:(this.a[c]=this.a[c]&16777215|b<<24,c++,this.a[c]=this.a[c]&-256|b>>8);this.Z=!0},v:function(a,b){return this.Qa(a,b)},H:function(a,b){return this.yb(a,b)},T:function(a,b,c){this.f||
this.Ab(a,b,c)},ga:function(a,b,c){this.f||this.Y(a,b,c)},s:function(a){return this.b[a]},D:function(a){return this.b[a]},F:function(a){return this.m.getUint16(a,!0)},L:function(a){return a&1?this.b[a]|this.b[a+1]<<8:this.j[a>>1]},O:function(a,b){this.b[a]=b;this.Z=!0},U:function(a,b){this.b[a]=b;this.Z=!0},X:function(a,b){this.m.setUint16(a,b,!0);this.Z=!0},ba:function(a,b){a&1?(this.b[a]=b,this.b[a+1]=b>>8):this.j[a>>1]=b;this.Z=!0}};
function Qa(a,b,c){a.K=b;a.g=a.i=0;c&&((a.g=c.g)&&ib(a,jb,!1),(a.i=c.i)&&kb(a,jb,!1))}function kb(a,b,c){c&&a.i||(a.Ga=!a.f&&b[2]||a.o,a.ec=!a.f&&b[3]||a.u);if(c||void 0===c)a.Ab=b[2]||a.o,a.Y=b[3]||a.u}function ib(a,b,c){c&&a.g||(a.Fa=b[0]||a.B,a.dc=b[1]||a.l);if(c||void 0===c)a.Qa=b[0]||a.B,a.yb=b[1]||a.l}function eb(a,b){b||(b=lb);ib(a,b,void 0);kb(a,b,void 0)}var lb=[],hb=[G.prototype.C,G.prototype.N,G.prototype.W,G.prototype.na],jb=[G.prototype.v,G.prototype.H,G.prototype.T,G.prototype.ga];
if(Ka)var gb=[G.prototype.s,G.prototype.F,G.prototype.O,G.prototype.X],fb=[G.prototype.D,G.prototype.L,G.prototype.U,G.prototype.ba];
function mb(a,b){u.call(this,"CPU",a,mb);var c=a.cycles||b,d=a.multiplier||1;this.c={};this.c.va=c;this.c.Pa=0;this.c.ua=d;this.c.$a=Math.round(this.c.va/1E4)/100;this.c.ra=this.c.$a*this.c.ua;this.h.$=!1;this.h.pb=!1;this.h.mb=a.autoStart;this.h.ob=!1;this.h.Ja=!1;this.c.Na=this.c.ta=0;this.c.Oa=a.csStart;this.c.ya=a.csInterval;this.c.za=a.csStop;this.ba=this.cb.bind(this);F(this)}y(mb);var nb=["power","reset"];m=mb.prototype;
m.fa=function(a,b,c,d){this.u=a;this.m=b;this.K=d;for(b=0;b<nb.length;b++)(c=this.B[nb[b]])&&this.u.R(null,nb[b],c);this.U=(b=Na(a,"Video"))&&Math.max(b.Ub,b.qb)||60;this.D=Na(a,"ChipSet");a=ob(a,"autoStart");null!=a&&(this.h.mb="true"==a?!0:"false"==a?!1:!!a);F(this)};m.reset=function(){this.c.Pa=0};m.save=function(){return null};m.restore=function(){return!1};
m.aa=function(a,b){if(!b){if(a&&this.restore){pb(this);if(!this.restore(a))return!1;qb(this)}else this.reset();this.V("No debugger detected")}rb(this);return!0};m.da=function(a){return a?this.save():!0};function sb(a){(a.h.mb||void 0===a.B.run)&&a.cb(!0)}m.rb=function(){return 0};function qb(a){void 0===a.c.Oa&&(a.c.Oa=0);void 0===a.c.ya&&(a.c.ya=-1);void 0===a.c.za&&(a.c.za=-1);a.h.Ja=0<=a.c.Oa&&0<a.c.ya;a.h.Ja&&(a.c.Na=0,a.c.ta=a.c.Oa-a.O)}
m.R=function(a,b,c){var d=this;a=!1;switch(b){case "power":case "reset":this.B[b]=c;a=!0;break;case "run":this.B[b]=c;c.onclick=function(){var a;if(a=d.u)if(a=d.u,a.h.P)a=!0;else{var b=null,c,g=C(a.id);for(c=0;c<g.length&&(b=g[c],b===a||b.h.qa);c++);if(c==g.length)for(c=0;c<g.length&&(b=g[c],b===a||b.h.P);c++);c==g.length&&(b=a);t("The "+b.type+" component ("+b.id+") is not "+(b.h.qa?"powered yet":"ready yet"+(b.La?" (waiting for notification)":""))+".");a=!1}a&&(d.h.$?tb(d,!0):d.cb(!0))};a=!0;break;
case "speed":this.B[b]=c;a=!0;break;case "setSpeed":this.B[b]=c,c.onclick=function(){ub(d,d.c.ua<<1,!0)},c.textContent=this.c.ra.toFixed(2)+"Mhz",a=!0}return a};function vb(a,b,c){a.O+=b;c&&(a.N=a.a=0)}
function wb(a,b){var c=30;c<a.U&&(c=a.U);2>c&&(c=2);var d=1;b&&1<a.c.ua&&a.c.ka&&(d=a.c.ka/a.c.$a);a.c.sb=Math.round(1E3/30);a.c.Vb=Math.floor(a.c.va/c*d);a.c.ab=Math.floor(a.c.va/30*d);a.c.ub=Math.floor(a.c.va/a.U*d);a.c.tb=Math.floor(a.c.va/2*d);b||(a.c.Ca=a.c.ab,a.c.Ba=a.c.ub,a.c.Aa=a.c.tb);a.c.bb=0}function xb(a){return a.O+a.L+a.N-a.a}function pb(a){a.c.ka=0;a.O=a.L=a.N=a.a=0;qb(a);ub(a,1)}
function ub(a,b,c){if(void 0!==b){.8>a.c.ka/a.c.ra&&(b=1);a.c.ua=b;b=a.c.$a*a.c.ua;if(a.c.ra!=b){a.c.ra=b;b=a.c.ra.toFixed(2)+"Mhz";var d=a.B.setSpeed;d&&(d.textContent=b);a.V("target speed: "+b)}c&&a.u&&yb(a.u)}vb(a,a.L);a.L=0;a.c.sa=ga();a.c.la=0;wb(a)}
m.cb=function(a){if(Ia(this,!0)){if(!this.h.$){ub(this);this.u&&this.u.start(this.c.sa,xb(this));this.h.$=!0;this.h.pb=!0;this.D&&this.D.start();var b=this.B.run;b&&(b.textContent="Halt");this.u&&(this.u.ma(!0),a&&yb(this.u,!0))}this.c.bb>=this.c.va&&wb(this,!0);this.c.Da=0;this.c.Ma=ga();this.c.la&&(a=this.c.Ma-this.c.la,a>this.c.sb&&(this.c.sa+=a,this.c.sa>this.c.Ma&&(this.c.sa=this.c.Ma)));try{do{this.zb(this.h.Ja?1:this.c.Vb);var c=this.N-this.a;this.L+=c;this.c.Da+=c;vb(this,0,!0);a=c;this.h.Ja&&
(b=!1,this.c.Na=this.c.Na+this.rb()|0,this.c.ta-=a,0>=this.c.ta&&(this.c.ta+=this.c.ya,b=!0),0<=this.c.za&&this.c.za<=xb(this)&&(this.c.ya=this.c.za=-1,qb(this),tb(this),b=!0),b&&this.V(xb(this)+" cycles: checksum="+n(this.c.Na)));this.c.Ba-=c;0>=this.c.Ba&&(this.c.Ba+=this.c.ub,this.u&&zb(this.u,this.c.Pa++),this.c.Pa>this.U&&(this.c.Pa=0));this.c.Aa-=c;0>=this.c.Aa&&(this.c.Aa+=this.c.tb,this.u&&this.u.ma());this.c.Ca-=c;if(0>=this.c.Ca){this.c.Ca+=this.c.ab;break}}while(this.h.$)}catch(e){tb(this);
rb(this);this.u&&this.u.stop(ga(),xb(this));Ia(this,!1);c=e.stack||e.message;this.h.ja=!0;this.I(c);return}c=setTimeout;a=this.ba;this.c.la=ga();b=this.c.sb;this.c.Da&&(b=Math.round(b*this.c.Da/this.c.ab));var b=b-(this.c.la-this.c.Ma),d=this.c.la-this.c.sa;d&&(this.c.ka=Math.round(this.L/(10*d))/100,864E5<=d&&(this.O=0,ub(this)));if(0>b||this.c.ka<this.c.ra)b=0;this.c.bb+=this.c.Da;this.c.la+=b;c(a,b)}else rb(this),this.u&&this.u.stop(ga(),xb(this))};m.zb=function(){return 0};
function tb(a,b){a.h.xa&&(a.h.Ya=!0);a.N-=a.a;a.a=0;vb(a,a.L);a.L=0;if(a.h.$){a.h.$=!1;a.D&&a.D.stop();var c=a.B.run;c&&(c.textContent="Run")}a.h.Ka=b}function rb(a){a.u&&(zb(a.u,-1),a.u.ma(void 0))}function Ab(a){this.ga=+a.model||8080;mb.call(this,a,1E6);this.W=Bb;pb(this);this.h.Ka=this.h.Jb=!1;this.Y=0;this.T=[];this.X=0;Cb(this)}y(Ab,mb);function Db(a,b){a.T.push(b)}m=Ab.prototype;m.reset=function(){this.h.$&&tb(this);Cb(this);pb(this);this.h.ja=!1;this.parent.reset.call(this)};
function Cb(a){a.b=0;a.f=0;a.w=0;a.g=0;a.A=0;a.i=0;a.j=0;a.v=0;J(a,a.X);Fb(a,0);a.F=0}function Gb(a,b){a.X=b;J(a,b)}m.rb=function(){var a=this.b+this.f+this.w+this.g+this.A+this.i+this.j|0;return a=a+this.v+this.o+Hb(this)|0};
m.save=function(){var a=new K(this);L(a,0,[this.b,this.f,this.w,this.g,this.A,this.i,this.j,this.v,this.o,Hb(this)]);L(a,1,[this.F,this.O,this.c.ua]);for(var b=this.m,c=0,d=[],e=0;e<b.j;e++){var f=b.b[e];if(f.Z||f.nb){d[c++]=e;var h=c++;a:if(f=f.save()){for(var g=0,k=0,l=[];g<f.length;){for(var r=f[g],p=g+1;p<f.length&&f[p]===r;)p++;l[k++]=p-g;l[k++]=r;g=p}if(l.length<f.length){f=l;break a}}d[h]=f}}L(a,2,d);return a.data()};
m.restore=function(a){var b=a[0];this.b=b[0];this.f=b[1];this.w=b[2];this.g=b[3];this.A=b[4];this.i=b[5];this.j=b[6];this.v=b[7]&65535;J(this,b[8]);Fb(this,b[9]);b=a[1];this.F=b[0];this.O=b[1];ub(this,b[3]);a:{b=this.m;a=a[2];var c;for(c=0;c<a.length-1;c+=2){var d=a[c],e=a[c+1];if(e&&e.length<b.v){for(var f=0,h=Array(b.v),g=0;g<e.length-1;)for(var k=e[g++],l=e[g++];k--;)h[f++]=l;e=h}f=b.b[d];if(!f||!f.restore(e)){t("Unable to restore memory block "+d);b=!1;break a}}b=!0}return b};
m.R=function(a,b,c){var d=!1;switch(b){case "A":case "B":case "C":case "BC":case "D":case "E":case "DE":case "H":case "L":case "HL":case "SP":case "PC":case "PS":case "IF":case "SF":case "ZF":case "AF":case "PF":case "CF":this.B[b]=c;this.Y++;d=!0;break;default:d=this.parent.R.call(this,a,b,c)}return d};function Ib(a){return a.f<<8|a.w}function Jb(a,b){a.f=b>>8&255;a.w=b&255}function Kb(a){return a.g<<8|a.A}function Lb(a,b){a.g=b>>8&255;a.A=b&255}function M(a){return a.i<<8|a.j}
function N(a,b){a.i=b>>8&255;a.j=b&255}function J(a,b){a.o=b&65535}function O(a){return a.l&256?1:0}function Q(a,b){a.l=a.l&255|b}function Mb(a){return La[a.s&255]?4:0}function Hb(a){return a.H&-214|(a.s&128?128:0)|(a.l&255?0:64)|((a.s^a.C)&16?16:0)|Mb(a)|O(a)}function Fb(a,b){a.l=a.s=a.C=0;b&1&&(a.l|=256);b&4||(a.s|=1);b&16&&(a.C|=16);b&64||(a.l|=255);b&128&&(a.s^=192);a.H=a.H&-726|b&512|2}function R(a,b){a.C=a.b^b;return a.s=(a.l=a.b+b)&255}
function Nb(a,b){a.C=a.b^b;return a.s=(a.l=a.b+b+(a.l&256?1:0))&255}function Ob(a,b){a.l=a.s=a.C=a.b&b;(a.b|b)&8&&(a.C^=16);return a.l}function Pb(a,b){a.C=b^255;b=a.s=b+255&255;a.l=a.l&-256|b;return b}function Qb(a,b){a.C=b;b=a.s=b+1&255;a.l=a.l&-256|b;return b}function Rb(a,b){return a.s=a.l=a.C=a.b|b}function S(a,b){b^=255;a.C=a.b^b;return a.s=(a.l=a.b+b+1^256)&255}function Sb(a,b){b^=255;a.C=a.b^b;return a.s=(a.l=a.b+b+(a.l&256?0:1)^256)&255}function Tb(a,b){return a.s=a.l=a.C=a.b^b}m.G=function(a){return this.m.G(a)};
m.S=function(a,b){this.m.S(a,b)};function T(a){var b=a.G(a.o);J(a,a.o+1);return b}function U(a){var b=Va(a.m,a.o);J(a,a.o+2);return b}function V(a){var b=Va(a.m,a.v);a.v=a.v+2&65535;return b}function W(a,b){a.v=a.v-2&65535;Xa(a.m,a.v,b)}function X(a,b,c,d){d=d||2;a.B[b]&&(void 0===c&&(a.h.ja=!0,a.I("Value for "+b+" is invalid"),tb(a)),c=!a.h.$||a.h.ob?n(c,d):"--------".substr(0,d),a.B[b].textContent!=c&&(a.B[b].textContent=c))}
m.ma=function(a){this.Y&&(a||!this.h.$||this.h.ob)&&(X(this,"A",this.b),X(this,"B",this.f),X(this,"C",this.w),X(this,"BC",Ib(this),4),X(this,"D",this.g),X(this,"E",this.A),X(this,"DE",Kb(this),4),X(this,"H",this.i),X(this,"L",this.j),X(this,"HL",M(this),4),X(this,"SP",this.v,4),X(this,"PC",this.o,4),a=Hb(this),X(this,"PS",a,4),X(this,"IF",a&512?1:0,1),X(this,"SF",a&128?1:0,1),X(this,"ZF",a&64?1:0,1),X(this,"AF",a&16?1:0,1),X(this,"PF",a&4?1:0,1),X(this,"CF",a&1?1:0,1));if(a=this.B.speed)a.textContent=
this.h.$&&this.c.ka?this.c.ka.toFixed(2)+"Mhz":"Stopped"};m.zb=function(a){this.h.Ka=!0;this.h.Jb=!1;this.h.pb=!1;this.N=this.a=a;do{if(a=this.F)this.F&8&&this.H&512?(a=199|(this.F&7)<<3,this.F&=-16,this.H&=-513,this.W[a].call(this),a=!0):a=!1,a=!a;if(a&&this.F&16){this.a=0;break}this.W[T(this)].call(this)}while(0<this.a);return this.h.Ka?this.N-this.a:void 0===this.h.Ka?0:-1};ta(function(){for(var a=E(document,"pc8080","cpu"),b=0;b<a.length;b++){var c=a[b],d=D(c),d=new Ab(d);Ha(d,c)}});
function Ub(){this.a-=4}function Vb(){J(this,U(this));this.a-=10}function Wb(){J(this,V(this));this.a-=10}function Xb(){var a=U(this);W(this,this.o);J(this,a);this.a-=17}
var Bb=[Ub,function(){Jb(this,U(this));this.a-=10},function(){this.S(Ib(this),this.b);this.a-=7},function(){Jb(this,Ib(this)+1);this.a-=5},function(){this.f=Qb(this,this.f);this.a-=5},function(){this.f=Pb(this,this.f);this.a-=5},function(){this.f=T(this);this.a-=7},function(){var a=this.b<<1;this.b=a&255|a>>8;Q(this,a&256);this.a-=4},Ub,function(){var a;N(this,a=M(this)+Ib(this));Q(this,a>>8&256);this.a-=10},function(){this.b=this.G(Ib(this));this.a-=7},function(){Jb(this,Ib(this)-1);this.a-=5},function(){this.w=
Qb(this,this.w);this.a-=5},function(){this.w=Pb(this,this.w);this.a-=5},function(){this.w=T(this);this.a-=7},function(){var a=this.b<<8&256;this.b=(a|this.b)>>1;Q(this,a);this.a-=4},Ub,function(){Lb(this,U(this));this.a-=10},function(){this.S(Kb(this),this.b);this.a-=7},function(){Lb(this,Kb(this)+1);this.a-=5},function(){this.g=Qb(this,this.g);this.a-=5},function(){this.g=Pb(this,this.g);this.a-=5},function(){this.g=T(this);this.a-=7},function(){var a=this.b<<1;this.b=a&255|O(this);Q(this,a&256);
this.a-=4},Ub,function(){var a;N(this,a=M(this)+Kb(this));Q(this,a>>8&256);this.a-=10},function(){this.b=this.G(Kb(this));this.a-=7},function(){Lb(this,Kb(this)-1);this.a-=5},function(){this.A=Qb(this,this.A);this.a-=5},function(){this.A=Pb(this,this.A);this.a-=5},function(){this.A=T(this);this.a-=7},function(){var a=this.b<<8;this.b=(O(this)<<8|this.b)>>1;Q(this,a&256);this.a-=4},Ub,function(){N(this,U(this));this.a-=10},function(){var a=U(this);Xa(this.m,a,M(this));this.a-=16},function(){N(this,
M(this)+1);this.a-=5},function(){this.i=Qb(this,this.i);this.a-=5},function(){this.i=Pb(this,this.i);this.a-=5},function(){this.i=T(this);this.a-=7},function(){var a=0,b=O(this);if((this.s^this.C)&16||9<(this.b&15))a|=6;if(b||154<=this.b)a|=96,b=1;this.b=R(this,a);Q(this,b?256:0);this.a-=4},Ub,function(){var a;N(this,a=M(this)+M(this));Q(this,a>>8&256);this.a-=10},function(){var a;a=U(this);a=Va(this.m,a);N(this,a);this.a-=16},function(){N(this,M(this)-1);this.a-=5},function(){this.j=Qb(this,this.j);
this.a-=5},function(){this.j=Pb(this,this.j);this.a-=5},function(){this.j=T(this);this.a-=7},function(){this.b=~this.b&255;this.a-=4},Ub,function(){this.v=U(this)&65535;this.a-=10},function(){this.S(U(this),this.b);this.a-=13},function(){this.v=this.v+1&65535;this.a-=5},function(){var a=M(this);this.S(a,Qb(this,this.G(a)));this.a-=10},function(){var a=M(this);this.S(a,Pb(this,this.G(a)));this.a-=10},function(){this.S(M(this),T(this));this.a-=10},function(){this.l|=256;this.a-=4},Ub,function(){var a;
N(this,a=M(this)+this.v);Q(this,a>>8&256);this.a-=10},function(){this.b=this.G(U(this));this.a-=13},function(){this.v=this.v-1&65535;this.a-=5},function(){this.b=Qb(this,this.b);this.a-=5},function(){this.b=Pb(this,this.b);this.a-=5},function(){this.b=T(this);this.a-=7},function(){Q(this,O(this)?0:256);this.a-=4},function(){this.a-=5},function(){this.f=this.w;this.a-=5},function(){this.f=this.g;this.a-=5},function(){this.f=this.A;this.a-=5},function(){this.f=this.i;this.a-=5},function(){this.f=this.j;
this.a-=5},function(){this.f=this.G(M(this));this.a-=7},function(){this.f=this.b;this.a-=5},function(){this.w=this.f;this.a-=5},function(){this.a-=5},function(){this.w=this.g;this.a-=5},function(){this.w=this.A;this.a-=5},function(){this.w=this.i;this.a-=5},function(){this.w=this.j;this.a-=5},function(){this.w=this.G(M(this));this.a-=7},function(){this.w=this.b;this.a-=5},function(){this.g=this.f;this.a-=5},function(){this.g=this.w;this.a-=5},function(){this.a-=5},function(){this.g=this.A;this.a-=
5},function(){this.g=this.i;this.a-=5},function(){this.g=this.j;this.a-=5},function(){this.g=this.G(M(this));this.a-=7},function(){this.g=this.b;this.a-=5},function(){this.A=this.f;this.a-=5},function(){this.A=this.w;this.a-=5},function(){this.A=this.g;this.a-=5},function(){this.a-=5},function(){this.A=this.i;this.a-=5},function(){this.A=this.j;this.a-=5},function(){this.A=this.G(M(this));this.a-=7},function(){this.A=this.b;this.a-=5},function(){this.i=this.f;this.a-=5},function(){this.i=this.w;this.a-=
5},function(){this.i=this.g;this.a-=5},function(){this.i=this.A;this.a-=5},function(){this.a-=5},function(){this.i=this.j;this.a-=5},function(){this.i=this.G(M(this));this.a-=7},function(){this.i=this.b;this.a-=5},function(){this.j=this.f;this.a-=5},function(){this.j=this.w;this.a-=5},function(){this.j=this.g;this.a-=5},function(){this.j=this.A;this.a-=5},function(){this.j=this.i;this.a-=5},function(){this.a-=5},function(){this.j=this.G(M(this));this.a-=7},function(){this.j=this.b;this.a-=5},function(){this.S(M(this),
this.f);this.a-=7},function(){this.S(M(this),this.w);this.a-=7},function(){this.S(M(this),this.g);this.a-=7},function(){this.S(M(this),this.A);this.a-=7},function(){this.S(M(this),this.i);this.a-=7},function(){this.S(M(this),this.j);this.a-=7},function(){var a=this.o-1;if(this.T.length)for(var b=0;b<this.T.length;b++)if(this.T[b](a))return;this.F|=16;this.a-=7;this.H&512||tb(this)},function(){this.S(M(this),this.b);this.a-=7},function(){this.b=this.f;this.a-=5},function(){this.b=this.w;this.a-=5},
function(){this.b=this.g;this.a-=5},function(){this.b=this.A;this.a-=5},function(){this.b=this.i;this.a-=5},function(){this.b=this.j;this.a-=5},function(){this.b=this.G(M(this));this.a-=7},function(){this.a-=5},function(){this.b=R(this,this.f);this.a-=4},function(){this.b=R(this,this.w);this.a-=4},function(){this.b=R(this,this.g);this.a-=4},function(){this.b=R(this,this.A);this.a-=4},function(){this.b=R(this,this.i);this.a-=4},function(){this.b=R(this,this.j);this.a-=4},function(){this.b=R(this,this.G(M(this)));
this.a-=7},function(){this.b=R(this,this.b);this.a-=4},function(){this.b=Nb(this,this.f);this.a-=4},function(){this.b=Nb(this,this.w);this.a-=4},function(){this.b=Nb(this,this.g);this.a-=4},function(){this.b=Nb(this,this.A);this.a-=4},function(){this.b=Nb(this,this.i);this.a-=4},function(){this.b=Nb(this,this.j);this.a-=4},function(){this.b=Nb(this,this.G(M(this)));this.a-=7},function(){this.b=Nb(this,this.b);this.a-=4},function(){this.b=S(this,this.f);this.a-=4},function(){this.b=S(this,this.w);
this.a-=4},function(){this.b=S(this,this.g);this.a-=4},function(){this.b=S(this,this.A);this.a-=4},function(){this.b=S(this,this.i);this.a-=4},function(){this.b=S(this,this.j);this.a-=4},function(){this.b=S(this,this.G(M(this)));this.a-=7},function(){this.b=S(this,this.b);this.a-=4},function(){this.b=Sb(this,this.f);this.a-=4},function(){this.b=Sb(this,this.w);this.a-=4},function(){this.b=Sb(this,this.g);this.a-=4},function(){this.b=Sb(this,this.A);this.a-=4},function(){this.b=Sb(this,this.i);this.a-=
4},function(){this.b=Sb(this,this.j);this.a-=4},function(){this.b=Sb(this,this.G(M(this)));this.a-=7},function(){this.b=Sb(this,this.b);this.a-=4},function(){this.b=Ob(this,this.f);this.a-=4},function(){this.b=Ob(this,this.w);this.a-=4},function(){this.b=Ob(this,this.g);this.a-=4},function(){this.b=Ob(this,this.A);this.a-=4},function(){this.b=Ob(this,this.i);this.a-=4},function(){this.b=Ob(this,this.j);this.a-=4},function(){this.b=Ob(this,this.G(M(this)));this.a-=7},function(){this.b=Ob(this,this.b);
this.a-=4},function(){this.b=Tb(this,this.f);this.a-=4},function(){this.b=Tb(this,this.w);this.a-=4},function(){this.b=Tb(this,this.g);this.a-=4},function(){this.b=Tb(this,this.A);this.a-=4},function(){this.b=Tb(this,this.i);this.a-=4},function(){this.b=Tb(this,this.j);this.a-=4},function(){this.b=Tb(this,this.G(M(this)));this.a-=7},function(){this.b=Tb(this,this.b);this.a-=4},function(){this.b=Rb(this,this.f);this.a-=4},function(){this.b=Rb(this,this.w);this.a-=4},function(){this.b=Rb(this,this.g);
this.a-=4},function(){this.b=Rb(this,this.A);this.a-=4},function(){this.b=Rb(this,this.i);this.a-=4},function(){this.b=Rb(this,this.j);this.a-=4},function(){this.b=Rb(this,this.G(M(this)));this.a-=7},function(){this.b=Rb(this,this.b);this.a-=4},function(){S(this,this.f);this.a-=4},function(){S(this,this.w);this.a-=4},function(){S(this,this.g);this.a-=4},function(){S(this,this.A);this.a-=4},function(){S(this,this.i);this.a-=4},function(){S(this,this.j);this.a-=4},function(){S(this,this.G(M(this)));
this.a-=7},function(){S(this,this.b);this.a-=4},function(){this.l&255&&(J(this,V(this)),this.a-=6);this.a-=5},function(){Jb(this,V(this));this.a-=10},function(){var a=U(this);this.l&255&&J(this,a);this.a-=10},Vb,function(){var a=U(this);this.l&255&&(W(this,this.o),J(this,a),this.a-=6);this.a-=11},function(){W(this,Ib(this));this.a-=11},function(){this.b=R(this,T(this));this.a-=7},function(){W(this,this.o);J(this,0);this.a-=11},function(){this.l&255||(J(this,V(this)),this.a-=6);this.a-=5},Wb,function(){var a=
U(this);this.l&255||J(this,a);this.a-=10},Vb,function(){var a=U(this);this.l&255||(W(this,this.o),J(this,a),this.a-=6);this.a-=11},Xb,function(){this.b=Nb(this,T(this));this.a-=7},function(){W(this,this.o);J(this,8);this.a-=11},function(){O(this)||(J(this,V(this)),this.a-=6);this.a-=5},function(){Lb(this,V(this));this.a-=10},function(){var a=U(this);O(this)||J(this,a);this.a-=10},function(){for(var a=T(this),b=this.m,c=this.b,d=this.o+-2&65535,e=1,f=0;0<e;){var h=b.o[a],g=b.C[a]||1,k=1==g?255:2==
g?65535:-1,k=(c>>>=f)&k;if(void 0!==h&&h[0])h[0](a,k,d);f+=g<<3;a+=g;e-=g}this.a-=10},function(){var a=U(this);O(this)||(W(this,this.o),J(this,a),this.a-=6);this.a-=11},function(){W(this,Kb(this));this.a-=11},function(){this.b=S(this,T(this));this.a-=7},function(){W(this,this.o);J(this,16);this.a-=11},function(){O(this)&&(J(this,V(this)),this.a-=6);this.a-=5},Wb,function(){var a=U(this);O(this)&&J(this,a);this.a-=10},function(){for(var a=T(this),b=this.m,c=this.o+-2&65535,d=1,e=0,f=0;0<d;){var h=
b.l[a],g=b.D[a]||1,k=1==g?255:2==g?65535:-1,l=k;void 0!==h&&h[0]&&(l=h[0](a,c),void 0===l?l=k:l&=k);e|=l<<f;f+=g<<3;a+=g;d-=g}this.b=e&255;this.a-=10},function(){var a=U(this);O(this)&&(W(this,this.o),J(this,a),this.a-=6);this.a-=11},Xb,function(){this.b=Sb(this,T(this));this.a-=7},function(){W(this,this.o);J(this,24);this.a-=11},function(){Mb(this)||(J(this,V(this)),this.a-=6);this.a-=5},function(){N(this,V(this));this.a-=10},function(){var a=U(this);Mb(this)||J(this,a);this.a-=10},function(){var a=
V(this);W(this,M(this));N(this,a);this.a-=18},function(){var a=U(this);Mb(this)||(W(this,this.o),J(this,a),this.a-=6);this.a-=11},function(){W(this,M(this));this.a-=11},function(){this.b=Ob(this,T(this));this.a-=7},function(){W(this,this.o);J(this,32);this.a-=11},function(){Mb(this)&&(J(this,V(this)),this.a-=6);this.a-=5},function(){J(this,M(this));this.a-=5},function(){var a=U(this);Mb(this)&&J(this,a);this.a-=10},function(){var a=M(this);N(this,Kb(this));Lb(this,a);this.a-=5},function(){var a=U(this);
Mb(this)&&(W(this,this.o),J(this,a),this.a-=6);this.a-=11},Xb,function(){this.b=Tb(this,T(this));this.a-=7},function(){W(this,this.o);J(this,40);this.a-=11},function(){this.s&128||(J(this,V(this)),this.a-=6);this.a-=5},function(){var a=V(this);Fb(this,a&255|this.H&-256);this.b=a>>8;this.a-=10},function(){var a=U(this);this.s&128||J(this,a);this.a-=10},function(){this.H&=-513;this.a-=4},function(){var a=U(this);this.s&128||(W(this,this.o),J(this,a),this.a-=6);this.a-=11},function(){W(this,Hb(this)&
255|this.b<<8);this.a-=11},function(){this.b=Rb(this,T(this));this.a-=7},function(){W(this,this.o);J(this,48);this.a-=11},function(){this.s&128&&(J(this,V(this)),this.a-=6);this.a-=5},function(){this.v=M(this)&65535;this.a-=5},function(){var a=U(this);this.s&128&&J(this,a);this.a-=10},function(){this.H|=512;this.a-=4},function(){var a=U(this);this.s&128&&(W(this,this.o),J(this,a),this.a-=6);this.a-=11},Xb,function(){S(this,T(this));this.a-=7},function(){W(this,this.o);J(this,56);this.a-=11}];
function Y(a){u.call(this,"ChipSet",a,Y);var b=a.model;b&&!Yb[b]&&t("Unrecognized ChipSet model: "+b);this.c=Yb[b]||Z;this.ga=this.c.ha;a.sound&&(this.i=null,window&&(this.i=window.AudioContext||window.webkitAudioContext),this.i&&new this.i);F(this)}y(Y);
var Z={ha:1978.1,Hb:{ca:0,ic:1,mc:16,sc:32,Ac:64,zc:128,wa:14},ia:{ca:1,Bb:1,Gb:2,Cb:4,Db:16,Eb:32,Fb:64,wa:8},Ib:{ca:2,hc:3,Hc:4,jc:8,vc:16,wc:32,xc:64,kc:128,wa:0},Dc:{ca:3},Bc:{ca:2,tc:7},Fc:{ca:3,Ic:1,Ec:2,yc:4,rc:8,lc:16,fc:32},Cc:{ca:4},Gc:{ca:5,nc:1,oc:2,pc:4,qc:8,Jc:16}},Zb={ha:100,gc:{ca:66},uc:{ca:98}},Yb={SI1978:Z,VT100:Zb};Y.prototype.R=function(){return!1};
Y.prototype.fa=function(a,b,c,d){this.m=b;this.a=c;this.K=d;this.u=a;a=this.c.wb;var e;void 0===e&&(e=0);if(a)for(var f in a){c=b;d=+f+e;var h=a[f].bind(this);if(void 0!==h)for(var g=+f+e;g<=d;g++)void 0!==c.l[g]?t("Input port 0x"+n(g,4)+" already registered"):c.l[g]=[h,!1]}e=this.c.xb;var k;void 0===k&&(k=0);if(e)for(var l in e)if(f=b,a=+l+k,c=e[l].bind(this),void 0!==c)for(d=+l+k;d<=a;d++)void 0!==f.o[d]?t("Output port 0x"+n(d,4)+" already registered"):f.o[d]=[c,!1]};
Y.prototype.aa=function(a,b){if(!b)if(!a)this.reset();else if(!this.restore(a))return!1;return!0};Y.prototype.da=function(a){return a?this.save():!0};Z.Za=[[Z.Hb.wa,Z.ia.wa,Z.Ib.wa,0,0,0,0]];Zb.Za=[[0,0]];m=Y.prototype;m.reset=function(){this.restore(this.c.Za)||this.I("reset error")};m.save=function(){var a=new K(this);switch(this.ga){case Z.ha:L(a,0,[this.v,this.b,this.D,this.f,this.g,this.o,this.s]);break;case Zb.ha:L(a,0,[this.j,this.l])}return a.data()};
m.restore=function(a){var b;if(a&&(b=a[0])&&b.length)switch(this.ga){case Z.ha:return this.v=b[0],this.b=b[1],this.D=b[2],this.f=b[3],this.g=b[4],this.o=b[5],this.s=b[6],!0;case Zb.ha:return this.j=b[0],this.l=b[1],!0}return!1};m.start=function(){};m.stop=function(){};function $b(a,b,c){a.b&=~b;c&&(a.b|=b)}m.Ob=function(){return this.v};m.Pb=function(){return this.b};m.Qb=function(){return this.D};m.Nb=function(){return this.f>>8-this.g&255};m.Xb=function(a,b){this.g=b};
m.Zb=function(a,b){this.o=b};m.Yb=function(a,b){this.f=b<<8|this.f>>8};m.$b=function(a,b){this.s=b};m.ac=function(){};m.bc=function(a,b){this.j=b};m.cc=function(a,b){this.l=b};Z.wb={0:Y.prototype.Ob,1:Y.prototype.Pb,2:Y.prototype.Qb,3:Y.prototype.Nb};Z.xb={2:Y.prototype.Xb,3:Y.prototype.Zb,4:Y.prototype.Yb,5:Y.prototype.$b,6:Y.prototype.ac};Zb.wb={};Zb.xb={66:Y.prototype.bc,98:Y.prototype.cc};
ta(function(){for(var a=E(document,"pc8080","chipset"),b=0;b<a.length;b++){var c=a[b],d=D(c),d=new Y(d);Ha(d,c)}});function ac(a){u.call(this,"ROM",a,ac);this.b=null;this.j=a.addr;this.c=a.size;this.l=a.writable;this.f=a.alias;this.g=a.file;this.o=ba(this.g);if(this.g){a=this.g;var b=ca(this.o);"json"!=b&&"hex"!=b&&(a=ia()+"/api/v1/dump?file="+this.g+"&format=bytes&decimal=true");var c=this;q(a,null,!0,function(a,b,f){bc(c,a,b,f)})}}y(ac);var cc=[0,5];
ac.prototype.fa=function(a,b,c,d){this.m=b;this.a=c;this.K=d;dc(this)};ac.prototype.aa=function(){this.i&&(this.K&&this.K.a(this.id,this.j,this.c,this.i),delete this.i);return!0};ac.prototype.da=function(){return!0};
function bc(a,b,c,d){if(d)a.I("Unable to load system ROM (error "+d+": "+b+")");else{Fa(a.Wa,b,c);if("["==c.charAt(0)||"{"==c.charAt(0))try{var e=eval("("+c+")"),f=e.bytes,h=e.data;if(f)a.b=f;else if(h)for(a.b=Array(4*h.length),d=c=0;c<h.length;c++)a.b[d++]=h[c]&255,a.b[d++]=h[c]>>8&255,a.b[d++]=h[c]>>16&255,a.b[d++]=h[c]>>24&255;else a.b=e;a.i=e.symbols;if(!a.b.length){t("Empty ROM: "+b);return}if(1==a.b.length){t(a.b[0]);return}}catch(g){a.I("ROM data error: "+g.message);return}else for(b=c.replace(/\n/gm,
" ").replace(/ +$/,"").split(" "),a.b=Array(b.length),e=0;e<b.length;e++)a.b[e]=aa(b[e]);dc(a)}}
function dc(a){if(!Ja(a))if(!a.g)F(a);else if(a.b&&a.m){a.c||(a.c=a.b.length);if(a.b.length!=a.c){var b="ROM size (0x"+n(a.b.length)+") does not match specified size ("+("0x"+n(a.c))+")";a.h.ja=!0;a.I(b)}else if(ec(a,a.j)){b=[];"number"==typeof a.f?b.push(a.f):null!=a.f&&a.f.length&&(b=a.f);for(var c=0;c<b.length;c++){for(var d=a,e=b[c],f=d.m,h=d.c,g=[],k=d.j>>>f.c;0<h&&k<f.b.length;)g.push(f.b[k++]),h-=f.m;f=d.m;d=d.c;h=0;for(e>>>=f.c;0<d&&e<f.b.length;){k=g[h++];if(!k)break;f.b[e++]=k;d-=f.m}}delete a.b}F(a)}}
function ec(a,b){if(Ra(a.m,b,a.c,a.l?1:db)){var c;for(c=0;c<a.b.length;c++)Wa(a.m,b+c,a.b[c]);if(a.l&&256==b){for(c=0;c<cc.length;c++)Wa(a.m,cc[c],118);Db(a.a,function(a){return function(b){if(0<=cc.indexOf(b)){var c=!1,h=a.a,g=a.K;if(5==b)switch(c=!0,h.w){case 2:fc(a,String.fromCharCode(h.A));break;case 9:for(var k=Kb(h),l="",r=255;r--;){var p=a.a.G(k++);if(36==p)break;l+=String.fromCharCode(p)}fc(a,l);break;default:c=!1}c?Wb.call(h):g&&(a.V("\nCP/M vector 0x"+n(b,4)),J(h,b),tb(g));b=!0}else b=!1;
return b}}(a));Gb(a.a,b)}return!0}return!1}function fc(a,b){b=b.replace(/\r/g,"");a.ea&&(a.ea.value+=b,a.ea.scrollTop=a.ea.scrollHeight)}ta(function(){for(var a=E(document,"pc8080","rom"),b=0;b<a.length;b++){var c=a[b],d=D(c),d=new ac(d);Ha(d,c)}});function gc(a){u.call(this,"RAM",a,gc);this.f=a.addr;this.c=a.size;this.b=!1}y(gc);m=gc.prototype;m.fa=function(a,b,c,d){this.m=b;this.a=c;this.K=d;F(this)};m.aa=function(a,b){b||this.reset();return!0};m.da=function(a){return a?this.save():!0};
m.reset=function(){!this.b&&this.c&&Ra(this.m,this.f,this.c,1)&&(this.b=!0);this.b||t("No RAM allocated")};m.save=function(){return null};m.restore=function(){return!0};ta(function(){for(var a=E(document,"pc8080","ram"),b=0;b<a.length;b++){var c=a[b],d=D(c),d=new gc(d);Ha(d,c)}});function hc(a){u.call(this,"Keyboard",a,hc);this.reset();F(this)}y(hc);var ic={"1p":49,"2p":50,coin:51,left:37,right:39,fire:32},jc={65:37,68:39,76:32},kc={l1:1,l2:2,l3:4,l4:8,locked:16,local:32,online:64};
hc.prototype.reset=function(){this.a={}};
hc.prototype.R=function(a,b,c){var d=this,e=a+"-"+b;if(void 0===this.B[e]){if("led"==a&&kc[b])return this.B[e]=c,!0;switch(b){case "kbd":return c.onkeydown=function(a){return lc(d,a,!0)},c.onkeyup=function(a){return lc(d,a,!1)},!0;default:if(void 0!==ic[b])return this.B[e]=c,a=function(a,b){return function(){mc(a,b,!0)}}(this,b),b=function(a,b){return function(){mc(a,b,!1)}}(this,b),"ontouchstart"in window?(c.ontouchstart=a,c.ontouchend=b):(c.onmousedown=a,c.onmouseup=c.onmouseout=b),!0}}return!1};
hc.prototype.fa=function(a,b,c,d){this.K=d;this.D=Na(a,"ChipSet")};function lc(a,b,c){var d=!0,e;a:{e=b.keyCode;e=jc[e]||e;for(var f in ic)if(ic[f]===e){e=f;break a}e=null}e&&(d=mc(a,e,c));d||b.preventDefault();return d}function mc(a,b,c){a.a[b]=c;if(a.D)switch(b){case "1p":$b(a.D,Z.ia.Cb,c);break;case "2p":$b(a.D,Z.ia.Gb,c);break;case "coin":$b(a.D,Z.ia.Bb,c);break;case "left":$b(a.D,Z.ia.Eb,c);break;case "right":$b(a.D,Z.ia.Fb,c);break;case "fire":$b(a.D,Z.ia.Db,c)}return!1}
ta(function(){for(var a=E(document,"pc8080","keyboard"),b=0;b<a.length;b++){var c=a[b],d=D(c),d=new hc(d);Ha(d,c)}});
function nc(a,b,c,d,e){var f=this;this.hb=oa("Gecko/");var h=["","moz","ms","webkit"];u.call(this,"Video",a,nc);this.s=a.screenWidth;this.o=a.screenHeight;this.U=a.bufferAddr;this.Rb=a.bufferRAM;var g=a.bufferFormat;this.F=g&&pc[g.toLowerCase()]||qc;this.Ha=a.bufferCols;this.ba=a.bufferRows;this.Kb=this.M=a.cellWidth||1;this.J=a.cellHeight||1;this.Sa=null;this.na=a.bufferBits||1;this.Sb=a.bufferLeft||0;if(this.c=a.bufferRotate)this.c=this.c%360,0<this.c&&(this.c-=360),-90!=this.c&&(this.I("unsupported buffer rotation: "+
this.c),this.c=0);this.qb=a.interruptRate;this.Ub=a.refreshRate||60;this.l=b;this.f=c;this.X=(this.Wb=d)||b||null;this.Lb=this.s;this.Mb=this.o;this.eb=this.s/this.Ha|0;this.gb=this.o/this.ba|0;1<this.J&&this.ba++;b=a.smoothing;(c=ya.smoothing)&&(b="true"==c);if(null!=b)for(c=0;c<h.length;c++)if(d=(d=h[c])?d+"ImageSmoothingEnabled":"imageSmoothingEnabled",void 0!==this.f[d]){this.f[d]=b;break}if(this.g=a.screenRotate)this.g=this.g%360,0<this.g&&(this.g-=360),-90!=this.g?(this.I("unsupported screen rotation: "+
this.g),this.g=0):(this.f.translate(0,this.o),this.f.rotate(this.g*Math.PI/180),this.f.scale(this.o/this.s,this.s/this.o));if(this.b=e)if(this.b.pa=e.requestFullscreen||e.msRequestFullscreen||e.mozRequestFullScreen||e.webkitRequestFullscreen,this.b.pa){for(c=0;c<h.length;c++)if(d=h[c]+"fullscreenchange","on"+d in document){document.addEventListener(d,function(){rc(f,document.fullscreenElement||document.msFullscreenElement||document.mozFullScreenElement||document.webkitFullscreenElement?!0:!1)},!1);
break}for(c=0;c<h.length;c++)if(d=h[c]+"fullscreenerror","on"+d in document){document.addEventListener(d,function(){rc(f,null)},!1);break}}if(this.H=a.fontROM)"json"!=ca(this.H)&&(this.H=ia()+"/api/v1/dump?file="+this.H+"&format=bytes"),q(this.H,null,!0,function(a,b,c){sc(f,a,b,c)});this.Xa={}}y(nc);var qc=0,pc={vt100:2};
nc.prototype.fa=function(a,b,c,d){this.u=a;this.m=b;this.a=c;this.K=d;this.F||(this.D=Na(a,"ChipSet"))&&this.D.ga==Z.ha&&(this.F=1);this.i=this.Ha*this.M;this.v=this.ba*this.J;b=this.i;c=this.v;this.c&&(b=this.v,c=this.i);this.Ia=(this.i*this.na>>3)*this.v;if(this.Rb||Ra(this.m,this.U,this.Ia,3))1<this.M?tc(this,this.Ha*this.ba):(this.ib=this.f.createImageData(b,c),this.lb=16/this.na|0,tc(this,this.Ia>>1)),this.j=document.createElement("canvas"),this.j.width=b,this.j.height=c,this.Ta=this.j.getContext("2d"),
this.N={},this.Y=1<<this.na,this.O=Array(this.Y+2),this.O[0]=[0,0,0,255],this.O[1]=[255,255,255,255],1==this.F&&(this.O[this.Y+0]=[255,255,0,255],this.O[this.Y+1]=[0,255,0,255]),2==this.F&&(this.Tb=60,this.Ua=!1,this.T=Array(this.Ha));if(this.C=Na(a,"Keyboard")){for(var e in this.Xa)this.C.R("led",e,this.Xa[e]);this.l&&this.C.R(this.Wb?"textarea":"canvas","kbd",this.X)}this.H||F(this)};
function sc(a,b,c,d){if(d)a.I("Unable to load font ROM (error "+d+": "+b+")");else{Fa(a.Wa,b,c);try{var e=eval("("+c+")"),f=e.bytes||e;if(!f||!f.length){t("Empty font ROM: "+b);return}if(1==f.length){t(f[0]);return}if(2048==f.length)uc(a,f);else{a.I("Unrecognized font data length ("+f.length+")");return}}catch(h){a.I("Font ROM data error: "+h.message);return}(a.f||a.K)&&F(a)}}
function uc(a,b){a.Sa=b;a.N[96]=[vc(a,a.M,a.J),vc(a,a.M,a.J,a.Ua)];a.N[64]=[vc(a,2*a.M,a.J),vc(a,2*a.M,a.J,a.Ua)];a.N[32]=a.N[0]=[vc(a,2*a.M,2*a.J),vc(a,2*a.M,2*a.J,a.Ua)]}
function vc(a,b,c,d){var e=8>=a.Kb?8:16,f=8<e?15:0,h=a.Sa.length/e,g=!1===d,k={M:b,J:c};k.canvas=document.createElement("canvas");k.canvas.width=16*b;k.canvas.height=h/16*c;k.context=k.canvas.getContext("2d");for(var l=k.context.createImageData(b,c),r=0;r<h;r++){for(var p=0,z=p;p<a.J;p++)for(var x=r*e+(f+p&e-1),x=d&&8==p?255:a.Sa[x],A=0;A<c/a.J;A++){for(var I=0,B=I;I<a.M;I++)for(var w=x&128>>(7<I?7:I),H=0;H<b/a.M;H++)g&&(w=!w),wc(a,l,B,z,w?1:0),B++;z++}k.context.putImageData(l,(r&15)*b,(r>>4)*c)}return k}
nc.prototype.aa=function(){return!0};nc.prototype.R=function(a,b,c){var d=this;if("led"==a||"rled"==a)return this.Xa[b]=c,!0;switch(b){case "fullScreen":return this.B[b]=c,this.b&&this.b.pa?c.onclick=function(){d.pa()}:c.parentNode.removeChild(c),!0}return!1};
nc.prototype.pa=function(){var a=!1;if(this.b){if(this.b.pa){a="100%";if(screen&&screen.width&&screen.height){var b=screen.width/screen.height,c=this.s/this.o;b>c&&(a=Math.round(c/b*100)+"%")}this.hb?(this.l.style.width=a,this.l.style.width=a,this.l.style.display="block",this.l.style.margin="auto"):(this.b.style.width=a,this.b.style.height="auto");this.b.style.backgroundColor="black";this.b.pa();a=!0}this.X&&this.X.focus()}return a};
function rc(a,b){!b&&a.b&&(a.hb?a.l.style.width=a.l.style.height="":a.b.style.width=a.b.style.height="")}function tc(a,b){a.jb=b;a.W=!1;if(void 0===a.L||a.L.length!=a.jb)a.L=Array(a.jb)}function wc(a,b,c,d,e){d=a.c?(b.height-c-1)*b.width+d:c+d*b.width;e&&1==a.F&&(208<=c&&236>c?e=a.Y+0:28<=c&&72>c&&(e=a.Y+1));a=a.O[e];d*=a.length;b.data[d]=a[0];b.data[d+1]=a[1];b.data[d+2]=a[2];b.data[d+3]=a[3]}
ta(function(){for(var a=E(document,"pc8080","video"),b=0;b<a.length;b++){var c=a[b],d=D(c),e=document.createElement("canvas");if(void 0===e||!e.getContext){c.innerHTML="<br/>Missing &lt;canvas&gt; support. Please try a newer web browser.";break}e.setAttribute("class","pcjs-canvas");e.setAttribute("width",d.screenWidth);e.setAttribute("height",d.screenHeight);e.style.backgroundColor=d.screenColor;e.style.height="auto";0<=(window?window.navigator.userAgent:"").indexOf("MSIE")&&(c.onresize=function(a,
b,c,d){return function(){b.style.height=(a.clientWidth*d/c|0)+"px"}}(c,e,d.screenWidth,d.screenHeight),c.onresize());var f=+(d.aspect||ya.aspect);f&&.3<=f&&3.33>=f&&(sa("onresize",function(a,b,c){return function(){b.style.height=(a.clientWidth/c|0)+"px"}}(c,e,f)),window.onresize());c.appendChild(e);f=document.createElement("textarea");oa("iOS")&&(f.setAttribute("autocapitalize","off"),f.setAttribute("autocorrect","off"));c.appendChild(f);var h=e.getContext("2d"),d=new nc(d,e,h,f,c);Ha(d,c)}});
function K(a,b,c){this.id=a.id;this.key=xc(a,b,c);this.K=a.K;yc(this,a.vb)}function xc(a,b,c){a=a.id;if(b){var d=b.indexOf(".");0<d&&(a+=".v"+b.substr(0,d))}c&&(a+="."+c);return a}
K.prototype={constructor:K,value:function(){return this[this.id]},data:function(){return this[this.id]},toString:function(){var a=this[this.id];return"string"==typeof a?a:JSON.stringify(a)},clear:function(a){yc(this);var b=[];try{for(var c=0,d=window.localStorage.length;c<d;c++)b.push(window.localStorage.key(c))}catch(e){}for(c=0;c<b.length;c++)if((d=b[c])&&(a||d.substr(0,this.key.length)==this.key)){try{window.localStorage.removeItem(d)}catch(e){}b.splice(c,1);c=0}}};
function yc(a,b){a[a.id]={};b&&L(a,"parms",b);a.a=!1}function zc(a){var b=!0;if(la()){var c=JSON.stringify(a[a.id]);na(a.key,c)||(t("Unable to store "+c.length+" bytes in browser local storage"),b=!1)}return b}function Ac(a){var b=!0;try{a[a.id]=JSON.parse(a[a.id])}catch(c){t(c.message||c),b=!1}return b}function Bc(a,b){return b?(a[a.id]=b,a.a=!0):a.a?!0:la()&&(b=ma(a.key))?(a[a.id]=b,a.a=!0):!1}function Cc(a,b){return a[a.id][b]||null}function L(a,b,c){try{a[a.id][b]=c}catch(d){}}
function Dc(a,b,c){u.call(this,"Computer",a,Dc);this.h.P=!1;Ec(this,b);this.D=ob(this,"autoPower",a);this.f=0;this.L=a.busWidth||a.buswidth;this.b=Fc;this.s=null;this.l=this.H=!1;this.N=ob(this,"url")||"";(Math.random()+.1).toString(36);this.c=Gc(this);if(this.a=Ga("CPU",this.id)){this.K=Ga("Debugger",this.id);this.j=[];for(b=null;b=Na(this,"Video",b);)this.j.push(b);this.m=new Pa({id:this.Wa+".bus",busWidth:this.L},this.a,this.K);var d,e=C(this.id);if((this.g=Ga("Panel",this.id))&&this.g.ea)for(b=
0;b<e.length;b++)d=e[b],d.I=this.g.I,d.V=this.g.V,d.ea=this.g.ea;this.V("PC8080 v1.23.3\nCopyright \u00a9 2012-2016 Jeff Parsons <Jeff@pcjs.org>\nLicense: GPL version 3 or later <http://gnu.org/licenses/gpl.html>");for(b=0;b<e.length;b++)d=e[b],d.fa&&d.fa(this,this.m,this.a,this.K);b=null;d=a.resume;void 0!==d&&(1<d.length?b=this.u=d:this.b=parseInt(d,10));var f;if(a=ob(this,"state")||(f=!0,a.state))b=this.C=a,f||(this.l=!0,this.b=Fc),this.b&&(this.v=new K(this,"1.23.3"),Bc(this.v)?b=null:delete this.v);
!b&&this.b&&(b=Hc(this))&&(this.l=!0);if(b){var h=this;q(b,null,!0,function(a,b,c){c?(h.u=null,h.l=!1,h.I("Unable to load machine state from server (error "+c+(b?": "+(String.prototype.trim?b.trim():b.replace(/^\s+|\s+$/g,"")):"")+")")):(h.s=b,h.H=!0);F(h)})}else F(this);this.B.power||(this.D=!0);!c&&this.D&&Ic(this,this.Ea)}else t("Unable to find CPU component")}y(Dc);var Fc=0;
function Ec(a,b){if(!b){var c;if("object"==typeof resources&&(c=resources.parms))try{b=eval("("+c+")")}catch(d){t(d.message+" ("+c+")")}}a.o=b}function ob(a,b,c){var d=b.toLowerCase(),d=ya[b]||ya[d];void 0===d&&a.o&&(d=a.o[b]);void 0===d&&c&&(d=c[b]);void 0===d&&"object"==typeof resources&&resources[b]&&(d=b);return d}function Ic(a,b,c){for(var d=C(a.id),e=0;e<=d.length;e++){var f=e<d.length?d[e]:a;if(!Ja(f)){Ja(f,function(){Ic(a,b,c)});return}}b.call(a,c)}
function Jc(a,b){var c=new K(a,"1.23.3","validate");if(Bc(c)&&Ac(c)){var d=Cc(c,"timestamp"),e=b?Cc(b,"timestamp"):"unknown";d!=e&&(a.I("Machine state may be out-of-date\n("+d+" vs. "+e+")\nCheck your browser's local storage limits"),b||c.clear())}}m=Dc.prototype;
m.Ea=function(a){void 0===a&&(a=this.b||(this.s?1:Fc));if(!this.f){this.f++;var b=!1,c=!1;this.F=!1;var d=this.v||new K(this,"1.23.3");if(-1==a)b=!0;else if(a>Fc){if(Bc(d,this.s)){this.i=new K(this,"1.23.3","failsafe");Bc(this.i)&&(Kc(this,d),a=2,yc(this.i));L(this.i,"timestamp",ha());zc(this.i);var e=this.b&&!this.l;if(1==a||ja("Click OK to restore the previous PC8080 machine state, or CANCEL to reset the machine.")){if(c=Ac(d)){var f=Cc(d,"code"),h=Cc(d,"data");f&&("ok"==f?Bc(d,h):("error"==f&&
"no machine state"!=h?(this.I("Error: "+h),"unable to verify user"==h&&(na("user",""),this.c=null)):this.V(f+": "+h),yc(d),Bc(d)?(c=Ac(d),e=!0):c=!1))}e&&Jc(this,c?d:null)}else 2==a&&d.clear()}else Jc(this);delete this.s;delete this.v}e=C(this.id);for(f=0;f<e.length;f++)h=e[f],h!==this&&h!=this.a&&(c=Lc(this,h,d,b,c));b=[d,a,c];-1!=a?Ic(this,this.kb,b):this.kb(b)}};
function Lc(a,b,c,d,e){if(!b.h.P){b.h.P=!0;if(b.aa){var f=null;e&&((f=Cc(c,b.id))||(f=Cc(c,b.id.replace(/[a-z0-9]\./i,"."))));"string"===typeof f&&(f=null);!b.aa(f,d)&&f&&(t("Unable to restore state for "+b.type),a.C&&!a.H?(c.clear(),a.b=Fc,window&&window.location.reload()):a.F=!0,b.aa(null),e=!1)}if(!d&&b.fb)for(a=b.fb.split("|"),c=0;c<a.length;c++)b.status(a[c])}return e}
m.kb=function(a){var b=a[0],c=0>a[1];a=a[2];this.O=!0;this.h.P=!0;var d=this.B.power;d&&(d.textContent="Shutdown");this.a&&(Lc(this,this.a,b,c,a),sb(this.a));this.F&&(Kc(this,b),b.clear());!c&&this.i&&(this.i.clear(),delete this.i);this.f=0};
function Kc(a,b){if(ja("There may be a problem with your PC8080 machine.\n\nTo help us diagnose it, click OK to send this PC8080 machine state to http://www.pcjs.org.")){var c=a.c||"",d=b.toString(),e={app:"PC8080",ver:"1.23.3"};e.url=a.N;e.user=c;e.type="bug";e.data=d;q("http://www.pcjs.org/api/v1/report",e,!0)}}
function Mc(a,b,c){var d,e="none";if(a.f)return null;a.f--;var f=new K(a,"1.23.3"),h=new K(a,"1.23.3","validate"),g=ha();L(h,"timestamp",g);L(f,"timestamp",g);L(f,"version","1.23.3");L(f,"url",window?window.location.href:null);L(f,"browser",window?window.navigator.userAgent:"");a.a&&a.a.da&&(c&&tb(a.a),d=a.a.da(b,c),"object"===typeof d&&L(f,a.a.id,d),c&&(a.a.h.P=!1,!1===d&&(e=null)));for(var g=C(a.id),k=0;k<g.length;k++){var l=g[k];l.h.P&&(l.da&&(d=l.da(b,c),"object"===typeof d&&L(f,l.id,d)),c&&(l.h.P=
!1,!1===d&&(e=null)))}e&&(c?(g=d=!1,b?(a.c&&Nc(a,a.c,f.toString()),zc(h)&&zc(f)||(e=null,d=g=!0)):a.b&&(d=!0,g=3==a.b),d&&f.clear(g)):e=f.toString());c&&(a.h.P=!1,b=a.B.power)&&(b.textContent="Power");a.f=0;return e}m.reset=function(){this.m&&this.m.reset&&this.m.reset();for(var a=C(this.id),b=0;b<a.length;b++){var c=a[b];c!==this&&c!==this.m&&c.reset&&c.reset()}};m.start=function(a,b){for(var c=C(this.id),d=0;d<c.length;d++){var e=c[d];"CPU"!=e.type&&e!==this&&e.start&&e.start(a,b)}};
m.stop=function(a,b){for(var c=C(this.id),d=0;d<c.length;d++){var e=c[d];"CPU"!=e.type&&e!==this&&e.stop&&e.stop(a,b)}};
m.R=function(a,b,c){var d=this;switch(b){case "power":return this.B[b]=c,c.onclick=function(){d.f||(d.h.P?Mc(d,!1,!0):Ic(d,d.Ea))},!0;case "reset":return this.B[b]=c,c.onclick=function(){if(d.h.P&&!d.f)if(d.b&&!d.u){var a=ja("Click OK to save changes to this PC8080 machine.\n\nWARNING: If you CANCEL, all disk changes will be discarded.");Mc(d,a,!0);!a&&d.C?window&&window.location.reload():d.Ea(Fc)}else d.reset(),d.a&&sb(d.a)},!0;case "save":if(da(ia(),"pcjs.org")){c.parentNode.removeChild(c);break}this.B[b]=
c;c.onclick=function(){var a=Gc(d,!0);if(a){var b=!!(d.b&&!d.u||d.C),c=Mc(d,b);b?Nc(d,a,c):d.I("Resume disabled, machine state not saved")}};return!0}return!1};
function Gc(a,b){var c=a.c;c||(c=ma("user"),void 0!==c?!c&&b&&(c=null,window&&(c=window.prompt("Saving machine states on the pcjs.org server is currently unsupported.\n\nIf you're running your own server, enter your user ID below.","")),c&&((c=Oc(a,c))||a.I("The user ID is invalid."))):b&&a.I("Browser local storage is not available"));return c}
function Oc(a,b){a.c=null;var c=q(ia()+"/api/v1/user?req=verify&user="+b),d=c[1];if(!c[0]&&d)try{c=eval("("+d+")"),c.code&&"ok"==c.code&&(na("user",c.data),a.c=c.data)}catch(e){t(e.message+" ("+d+")")}return a.c}function Hc(a){var b=null;a.c&&(b=ia()+"/api/v1/user?req=load&user="+a.c+"&state="+xc(a,"1.23.3"));return b}
function Nc(a,b,c){if(c){var d={req:"store"};d.user=b;d.state=xc(a,"1.23.3");d.data=c;b=q(ia()+"/api/v1/user",d);d=b[0];if(b[1]){if(d){var e=d.indexOf("\n");0<e&&(d=d.substr(0,e));d.indexOf("Error: ")||(d=d.substr(7))}d='{"code":'+b[1]+',"data":"'+d+'"}'}b=JSON.parse(d);b&&"ok"==b.code?a.I("Machine state saved to server"):c&&(c=b&&b.data||"unable to save machine state",c="error"==b.code?"Error: "+c:"Error "+b.code+": "+c,a.I(c),na("user",""),a.c=null)}}
function Na(a,b,c){a=C(a.id);for(var d=0;d<a.length;d++){var e=a[d];if(c)c==e&&(c=null);else if(e.type==b)return e}return null}function yb(a,b){if(a.j.length){var c=0,d=0;b&&window&&(c=window.scrollX,d=window.scrollY);var e=a.j[0];e.X&&e.X.focus();b&&window&&window.scrollTo(c,d)}}m.ma=function(a){this.a&&this.a.ma(a);this.g&&this.g.ma(a)};
function zb(a,b){for(var c=0;c<a.j.length;c++){var d=a.j[c],e=!0;if(0<=b){if(d.qb)if(b&1)e=d.a,e.F=e.F&-8|10,e=!1;else{var f=d.a;f.F=f.F&-8|9}if(f=e&&d.W){for(var f=d.m,h=d.Ia,g=!0,k=d.U>>>f.c;0<h&&k<f.b.length;)f.b[k].Z&&(f.b[k].Z=g=!1,f.b[k].nb=!0),h-=f.m,k++;f=g}f&&(e=!1)}if(e)if(1<d.M)switch(d.F){case 2:for(var l=d.U,e=-1,f=0,h=60==d.Tb?2:5,k=g=0;f<d.ba;){for(var r=0,p=l,z=e;;){var x=Ua(d.m,p++);if(127==(x&127)){l=Ua(d.m,p++);e=l&96;l=d.U|(l&31)<<8|Ua(d.m,p);break}if(r<d.T.length)d.T[r++]=x;else break}if(h)h--;
else{for(;r<d.T.length;)d.T[r++]=0;for(p=0;p<r;p++){x=d.T[p];if(!d.W||x!==d.L[g]){var A=d,I=d.Ta,B=x&127;if(x=A.N[z][x&128?1:0]){var w=(B&15)*x.M,B=(B>>4)*x.J,H=void 0,P=void 0,Ca=void 0,cb=void 0,oc=x.M,Eb=x.J;I?(H=p*A.M,P=f*A.J,Ca=A.M,cb=A.J):(H=p*A.eb,P=f*A.gb,Ca=A.eb,cb=A.gb);x.M>A.M&&(H*=2,Ca*=2);x.J>A.J&&(0==z&&(B+=A.J),Eb=A.J);I?I.drawImage(x.canvas,w,B,oc,Eb,H,P,Ca,cb):(H+=0,P+=0,A.f.drawImage(x.canvas,w,B,oc,Eb,H,P,Ca,cb))}k++}g++}f++}}d.W=!0;k&&d.Ta&&d.f.drawImage(d.j,0,0,d.i,d.v-d.J,0,
0,d.Lb,d.Mb)}else{g=d.U;k=g+d.Ia;l=z=r=0;e=d.i;p=0;f=d.v;A=h=0;I=d.na;x=(1<<I)-1;d.Sb&&(I=-I,A=16+I);for(;g<k;){w=d.m;B=g;H=B&w.f;P=(B&w.g)>>>w.c;w=H!=w.f?w.b[P].yb(H,B):w.b[P++].Qa(H,B)|w.b[P&w.u].Qa(0,B+1)<<8;if(d.W&&w===d.L[r])z+=d.lb;else{d.L[r]=w;(B=A)&&(w=w>>8|(w&255)<<8);z<e&&(e=z);for(H=d.lb;H--;)P=w>>B&x,wc(d,d.ib,z++,l,P),B+=I;z>p&&(p=z);l<f&&(f=l);l>=h&&(h=l+1)}g+=2;r++;if(z>=d.i&&(z=0,l++,l>d.v))break}d.W=!0;e<d.i&&(g=p-e,h-=f,d.c&&(k=e,r=g,e=f,g=h,f=d.i-(k+r),h=r),d.Ta.putImageData(d.ib,
0,0,e,f,g,h),d.f.drawImage(d.j,0,0,d.j.width,d.j.height,0,0,d.s,d.o))}}}ta(function(){for(var a=E(document,"pc8080-machine"),b=0;b<a.length;b++)for(var c=a[b],d=D(c),c=E(c,"pc8080","computer"),e=0;e<c.length;e++){var f=c[e],h=D(f),h=new Dc(h,d,!0);Ha(h,f);h.D&&Ic(h,h.Ea)}});pa.show.push(function(){for(var a=E(document,"pc8080","computer"),b=0;b<a.length;b++){var c=D(a[b]);(c=Ga("Computer",c.id))&&c.O&&!c.h.P&&c.Ea(-1)}});
pa.exit.push(function(){for(var a=E(document,"pc8080","computer"),b=0;b<a.length;b++){var c=D(a[b]);(c=Ga("Computer",c.id))&&c.h.P&&Mc(c,!(!c.b||c.u),!0)}});var Pc=0;function Qc(a,b,c,d,e,f){e("Loading "+a+"...");q(a,null,!0,function(h,g,k){k?(g||(g="unable to load "+a+" ("+k+")"),f(g,null)):Rc(g,a,b,c,d,e,f)})}
function Rc(a,b,c,d,e,f,h){function g(a,f){if(f)h(f,null);else{if(c){Fa(c,b,a);var g=b;g&&0>g.indexOf("/")&&"/"==window.location.pathname.slice(-1)&&(g=window.location.pathname+g);d?"}"==d.slice(-1)?(d=d.slice(0,-1),1<d.length&&(d+=",")):d='{state:"'+d+'",':d="{";d+='url:"'+g+'"}';"object"==typeof resources&&(g=null);a=a.replace(/(<machine[^>]*\sid=)(['"]).*?\2/,"$1$2"+c+"$2"+(d?" parms='"+d+"'":"")+(g?' url="'+g+'"':""))}e||(a=a.replace(/(<xsl:variable name="APPCLASS">).*?(<\/xsl:variable>)/,"$1pc8080$2"));
g=null;if("<"==a.charAt(0))try{e||(a=a.replace(/<!DOCTYPE(.|[\r\n])*]>\s*/g,"")),window.ActiveXObject||"ActiveXObject"in window?(g=new window.ActiveXObject("Microsoft.XMLDOM"),g.async=!1,g.loadXML(a)):g=(new window.DOMParser).parseFromString(a,"text/xml")}catch(p){g=null,a=p.message}else a="unrecognized XML: "+(255<a.length?a.substr(0,255)+"...":a);h(a,g)}}a?e?Sc(a,f,g):g(a,null):h("no data"+(b?" for file: "+b:""),null)}
function Sc(a,b,c){var d;if(d=/<([a-z]+)\s+ref="(.*?)"(.*?)\/>/g.exec(a)){var e=d[2];b("Loading "+e+"...");q(e,null,!0,function(f,h,g){if(g||!h)c(a,"unable to resolve XML reference: "+d[0]+" ("+g+")");else{if(f=d[3])if(g=h.match(new RegExp("<"+d[1]+"[^>]*>"))){for(var k=g[0],l,r=/( [a-z]+=)(['"])(.*?)\2/g;l=r.exec(f);)k=0>k.indexOf(l[1])?k.replace(">",l[0]+">"):k.replace(new RegExp(l[1]+"(['\"])(.*?)\\1"),l[0]);g[0]!=k&&(h=h.replace(g[0],k))}else{c(a,"missing <"+d[1]+"> in "+e);return}h=h.replace(/<\?xml[^>]*>[\r\n]*/,
"");a=a.replace(d[0],h);Sc(a,b,c)}})}else c(a,null)}
function Tc(a,b,c,d){function e(a){if(void 0===g){var b=h&&E(h,"machine-warning");g=b&&b[0]||h}g&&(g.innerHTML=fa(a))}function f(a){e("Error: "+a);k&&(--Pc||va(!0));k=!1}var h,g,k=!0;Pc++;Ea[a]={};try{if(h=document.getElementById(a)){var l;if("object"==typeof resources&&(l=resources.css)){var r=document.head||document.getElementsByTagName("head")[0],p=document.createElement("style");p.type="text/css";p.styleSheet?p.styleSheet.cssText=l:p.appendChild(document.createTextNode(l));r.appendChild(p)}c||
(c="/versions/pc8080/1.23.3/components.xsl");l=function(d,g){g?Qc(c,null,null,!1,e,function(d,l){if(l)if(Fa(a,c,d),e("Processing "+b+"..."),window.ActiveXObject||"ActiveXObject"in window){var k=g.transformNode(l);k?(h.outerHTML=k,--Pc||va(!0)):f("transformNodeToObject failed")}else document.implementation&&document.implementation.createDocument?(k=new XSLTProcessor,k.importStylesheet(l),(k=k.transformToFragment(g,document))?h.parentNode?(h.parentNode.replaceChild(k,h),--Pc||va(!0)):f("invalid machine element: "+
a):f("transformToFragment failed")):f("unable to transform XML: unsupported browser");else f(d)}):f(d)};"<"!=b.charAt(0)?Qc(b,a,d,!0,e,l):Rc(b,null,a,d,!1,e,l)}else f("missing machine element: "+a)}catch(z){f(z.message)}return k}window.embedPC8080=function(a,b,c,d){va(!1);return Tc(a,b,c,d)};window.enableEvents=va;window.sendEvent=wa;
function Uc(a,b,c,d){if(!c&&b){d.push(b);a=Ea[d[0]];b=null;for(var e in a)if(da(e,"components.xsl")){b=e.replace(".xsl",".css");break}b?q(b,null,!0,function(a,b){Vc(b,d)}):Vc(null,d)}else t("Error ("+c+") requesting "+a)}
function Vc(a,b){var c,d,e,f=b[0],h=b[1];c=b[4];c=c.match(/^(\s*\(function\(\)\{)([\s\S]*)(}\)\(\);\s*)$/);var g=Ea[f],k={},l;for(l in g){var r=g[l],p=ca(l);if("xml"==p){for(p=/[ \t]*<disk [^>]*path=(['"])(.*?)\1.*?<\/disk>\n?/g;d=p.exec(g[l]);){var z=d[2];z&&(g[z]||(r=r.replace(d[0],"")))}d=l=ba(l)}else"xsl"==p&&(e=l=ba(l));k[l]=r}a&&(k[l="css"]=a);b[2]&&(k[l="parms"]=b[2]);b[3]&&(k[l="state"]=b[3]);d&&e?(l=JSON.stringify(k),h+=".js",c=c[1]+"var resources="+l+";"+c[2]+c[3],c=c.replace(/\u00A9/g,
"&#xA9;"),l=h,g=null,k="data:application/javascript,",k=oa("Firefox")?k+encodeURIComponent(c):k+encodeURI(c),l&&(g=document.createElement("a"),"string"!=typeof g.download&&(g=null)),g?(g.href=k,g.download=l,document.body.appendChild(g),g.click(),document.body.removeChild(g),c="Check your Downloads folder for "+l+"."):(window.open(k),c="Check your browser for a new window/tab containing the requested data"+(l?" ("+l+")":"")+"."),c+=', copy it to your web server as "'+h+'", and then add the following to your web page:\n\n',
c+='<div id="'+f+'"></div>\n',c+="...\n",c+='<script type="text/javascript" src="'+h+'">\x3c/script>\n',c+='<script type="text/javascript">embedPC("'+f+'","'+d+'","'+e+'");\x3c/script>\n\n',c+="The machine should appear where the <div> is located.",t(c)):t("Missing XML/XSL resources")}
window.savePC=function(a,b,c){var d=Ga("Computer",a),e=Ga("Debugger",a);if(d){var f=Mc(d,!0),h=d.o?JSON.stringify(d.o):null;b||(b="/versions/pcjs/1.23.3/pc"+(e?"-dbg":"")+".js");if(c&&c({state:f,vb:h}))return!0;q(b,null,!0,function(c,d,e){Uc(c,d,e,[a,ba(b,!0),h,f])});return!0}t("Unable to identify machine '"+a+"'");return!1};})();
