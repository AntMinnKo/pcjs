(function(){var m;function ca(a){var b=16,c;if(a){b||(b=16);if("$"==a.charAt(0))b=16,a=a.substr(1);else if("0x"==a.substr(0,2))b=16,a=a.substr(2);else{var d=a.charAt(a.length-1).toLowerCase();"h"==d?(b=16,d=null):"."==d&&(b=10,d=null);null==d&&(a=a.substr(0,a.length-1))}var e,d=a,f=b;(f&&10!=f?16==f?null!==d.match(/^[0-9a-f]+$/i):2==f&&null!==d.match(/^[01]+$/i):null!==d.match(/^[0-9]+$/))&&!isNaN(e=parseInt(a,b))&&(c=e|0)}return c}
function n(a,b){var c="";void 0===b?b=8:8<b&&(b=8);if(null==a||isNaN(a))for(;0<b--;)c="?"+c;else for(;0<b--;){var d=a&15,d=d+(0<=d&&9>=d?48:55),c=String.fromCharCode(d)+c;a>>=4}return c}function da(a,b){var c=a,d=a.lastIndexOf("/");0<=d&&(c=a.substr(d+1));d=c.indexOf("&");0<d&&(c=c.substr(0,d));b&&(d=c.lastIndexOf("."),0<d&&(c=c.substring(0,d)));return c}function ea(a){var b="",c=a.lastIndexOf(".");0<=c&&(b=a.substr(c+1).toLowerCase());return b}
function fa(a,b){return-1!==a.indexOf(b,a.length-b.length)}var ga={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#039;"};function ha(a){return a.replace(/[&<>"']/g,function(a){return ga[a]})}var ia=Date.now||function(){return+new Date};function ka(){function a(a){return(10>a?"0":"")+a}var b=new Date;return b.getFullYear()+"-"+a(b.getMonth()+1)+"-"+a(b.getDate())+" "+a(b.getHours())+":"+a(b.getMinutes())+":"+a(b.getSeconds())}
function p(a,b,c,d){var e=0,f=null,h=null;if("object"==typeof resources&&(f=resources[a]))return d&&d(a,f,e),[f,e];if(c&&"function"==typeof resources)return resources(a,function(b,c){d&&d(a,b,c)}),h;var g=window.XMLHttpRequest?new window.XMLHttpRequest:new window.ActiveXObject("Microsoft.XMLHTTP");c&&(g.onreadystatechange=function(){4===g.readyState&&(f=g.responseText,200==g.status||!g.status&&f.length&&"file:"==(window?window.location.protocol:"file:")||(e=g.status||-1),d&&d(a,f,e))});if(b&&"object"==
typeof b){var l="",k;for(k in b)b.hasOwnProperty(k)&&(l&&(l+="&"),l+=k+"="+encodeURIComponent(b[k]));l=l.replace(/%20/g,"+");g.open("POST",a,!!c);g.setRequestHeader("Content-type","application/x-www-form-urlencoded");g.send(l)}else g.open("GET",a,!!c),"bytes"==b&&g.overrideMimeType("text/plain; charset=x-user-defined"),g.send();c||(f=g.responseText,200!=g.status&&(e=g.status||-1),d&&d(a,f,e),h=[f,e]);return h}function la(){return"http://"+(window?window.location.host:"www.pcjs.org")}
function r(a){window&&window.alert(a)}function ma(a){var b=!1;window&&(b=window.confirm(a));return b}var na=null;function oa(){if(null==na){var a=!1;if(window)try{window.localStorage.setItem("PCjs.localStorage","PCjs.localStorage"),a="PCjs.localStorage"==window.localStorage.getItem("PCjs.localStorage"),window.localStorage.removeItem("PCjs.localStorage")}catch(b){a=!1}na=a}return na}function pa(a){var b;if(window)try{b=window.localStorage.getItem(a)}catch(c){}return b}
function qa(a,b){try{return window.localStorage.setItem(a,b),!0}catch(c){}return!1}function ra(a){if(window){var b=window?window.navigator.userAgent:"";return"iOS"==a&&b.match(/(iPod|iPhone|iPad)/)&&b.match(/AppleWebKit/)||"MSIE"==a&&b.match(/(MSIE|Trident)/)||0<=b.indexOf(a)?!0:!1}return!1}var sa={init:[],show:[],exit:[]},ta=!1,ua=!0;function va(a,b){if(window){var c=window[a];window[a]="function"!==typeof c?b:function(){c&&c();b()}}}function wa(a){sa.init.push(a)}
function xa(a){if(ua)try{for(var b=0;b<a.length;b++)a[b]()}catch(c){r("An unexpected exception occurred:\n\n"+c.message+"\n\nPlease send this information to support@pcjs.org. Thanks.")}}function ya(a){!ua&&a?(ua=!0,ta&&za("init")):ua=a}function za(a){sa[a]&&xa(sa[a])}va("onload",function(){ta=!0;xa(sa.init)});va("onpageshow",function(){xa(sa.show)});va(ra("Opera")||ra("iOS")?"onunload":"onbeforeunload",function(){xa(sa.exit)});
function t(a,b,c){this.type=a;b||(b={id:"",name:""});this.id=b.id;this.name=b.name;this.Pa=b.comment;this.eb=b;void 0===this.id&&(this.id="");b=this.id.indexOf(".");0<b?(this.pa=this.id.substr(0,b),this.Ra=this.id.substr(b+1)):this.Ra=this.id;this[a]=c;this.h={ja:!1,ra:!1,Ja:!1,N:!1,ea:!1};this.Da=null;this.h.ea=!1;this.B={};this.J=null;v.push(this)}var Aa=void 0,Ba={};
if(window){Aa||(Aa=window.location.search.substr(1));for(var Ca,Da=/\+/g,Ea=/([^&=]+)=?([^&]*)/g;Ca=Ea.exec(Aa);)Ba[decodeURIComponent(Ca[1].replace(Da," "))]=decodeURIComponent(Ca[2].replace(Da," "))}function Fa(a){function b(){}if(window){if(!a)throw new TypeError;if(Object.create)return Object.create(a);var c=typeof a;if("object"!==c&&"function"!==c)throw new TypeError;}b.prototype=a;return new b}
function w(a,b){b||(b=t);a.prototype=Fa(b.prototype);a.prototype.constructor=a;a.prototype.parent=b.prototype}var v=[],Ga={};function Ha(a,b,c){Ga[a]&&b&&(Ga[a][b]=c)}function x(a){var b,c=[];a&&(a=0<(b=a.indexOf("."))?a.substr(0,b+1):"");for(b=0;b<v.length;b++){var d=v[b];a&&d.id.indexOf(a)||c.push(d)}return c}
function Ia(a,b){var c;if(void 0!==a){var d;b&&(b=0<(d=b.indexOf("."))?b.substr(0,d+1):"");for(d=0;d<v.length;d++)if(c)c==v[d]&&(c=null);else if(!(a!=v[d].type||b&&v[d].id.indexOf(b)))return v[d]}return null}function y(a){var b=null;if(a=a.getAttribute("data-value"))try{b=eval("("+a+")")}catch(c){r(c.message+" ("+a+")")}return b}
function Ja(a,b){for(var c=z(b.parentNode,"pc8080-control"),d=0;d<c.length;d++)for(var e=c[d].childNodes,f=0;f<e.length;f++){var h=e[f];if(1===h.nodeType){var g=h.getAttribute("class");if(g)for(var l=g.split(" "),k=0;k<l.length;k++)switch(g=l[k],g){case "pc8080-binding":(g=y(h))&&g.binding&&a.O(g.type,g.binding,h,g.value),k=l.length}}}}
function z(a,b,c){c&&(b+="-"+c+"-object");if(a.getElementsByClassName)return a.getElementsByClassName(b);var d;c=[];a=a.getElementsByTagName("*");var e=new RegExp("(^| )"+b+"( |$)");b=0;for(d=a.length;b<d;b++)e.test(a[b].className)&&c.push(a[b]);return c}
t.prototype={constructor:t,parent:null,toString:function(){return this.name?this.name:this.id||this.type},O:function(a,b,c){switch(b){case "clear":return this.B[b]||(this.B[b]=c,c.onclick=function(a){return function(){a.B.print&&(a.B.print.value="")}}(this)),!0;case "print":return this.B[b]||(this.ba=this.B[b]=c,c.value="",this.R=function(a){return function(b,c){8192<a.value.length&&(a.value=a.value.substr(a.value.length-4096));a.value+=(void 0!==c?c+": ":"")+(b||"")+"\n";a.scrollTop=a.scrollHeight}}(c),
this.I=function(a,b,c){this.R(a,"notice",c)}),!0;default:return!1}},log:function(){},R:function(){},status:function(a){this.R(this.Ra+": "+a)},I:function(a,b){b||r(a)},Y:function(){return this.h.N=!0},X:function(a,b){b&&(this.h.N=!1);return!0}};function Ma(a,b){if(a.h.Ja)return a.h.ra&&(a.h.ra=!1),a.h.Ja=!1;if(a.h.ea)return a.R(a.toString()+" error"),!1;a.h.ra=b;return a.h.ra}function B(a){if(!a.h.ea&&(a.h.ja=!0,a.h.ja)){var b=a.Da;a.Da=null;b&&b()}}
function Na(a,b){b&&(a.h.ja?b():a.Da=b);return a.h.ja}
var Oa="undefined"!==typeof ArrayBuffer,Pa=[1,0,0,1,0,1,1,0,0,1,1,0,1,0,0,1,0,1,1,0,1,0,0,1,1,0,0,1,0,1,1,0,0,1,1,0,1,0,0,1,1,0,0,1,0,1,1,0,1,0,0,1,0,1,1,0,0,1,1,0,1,0,0,1,0,1,1,0,1,0,0,1,1,0,0,1,0,1,1,0,1,0,0,1,0,1,1,0,0,1,1,0,1,0,0,1,1,0,0,1,0,1,1,0,0,1,1,0,1,0,0,1,0,1,1,0,1,0,0,1,1,0,0,1,0,1,1,0,0,1,1,0,1,0,0,1,1,0,0,1,0,1,1,0,1,0,0,1,0,1,1,0,0,1,1,0,1,0,0,1,1,0,0,1,0,1,1,0,0,1,1,0,1,0,0,1,0,1,1,0,1,0,0,1,1,0,0,1,0,1,1,0,1,0,0,1,0,1,1,0,0,1,1,0,1,0,0,1,0,1,1,0,1,0,0,1,1,0,0,1,0,1,1,0,0,1,1,0,1,
0,0,1,1,0,0,1,0,1,1,0,1,0,0,1,0,1,1,0,0,1,1,0,1,0,0,1];function Qa(a){t.call(this,"Panel",a,Qa)}w(Qa);m=Qa.prototype;m.O=function(a,b,c,d){return this.u&&this.u.O(a,b,c,d)||this.a&&this.a.O(a,b,c,d)||this.H&&this.H.O(a,b,c,d)?!0:this.parent.O.call(this,a,b,c,d)};m.ca=function(a,b,c,d){this.u=a;this.o=b;this.a=c;this.J=d;this.H=Ra(a,"Keyboard")};m.Y=function(a,b){b||Sa();return!0};m.X=function(){return!0};m.ha=function(){};
function Sa(){for(var a=!1,b=z(document,"pc8080","panel"),c=0;c<b.length;c++){var d=b[c],e=y(d),f;a:{f=e.id;if(void 0!==f)for(var h=void 0,h=0;h<v.length;h++)if(v[h].id===f){f=v[h];break a}f=null}f||(a=!0,f=new Qa(e));Ja(f,d);a&&B(f)}}wa(Sa);
function Ta(a,b,c){t.call(this,"Bus",a,Ta);this.a=b;this.J=c;this.j=a.busWidth||16;this.s=Math.pow(2,this.j);this.i=this.s-1|0;this.c=16>=this.j?10:20>=this.j?12:24>=this.j?14:15;this.f=1<<this.c;this.A=this.f>>2;this.g=this.f-1;this.o=this.s/this.f|0;this.u=this.o-1;this.l=[];this.m=[];this.G=[];this.C=[];a=new C;Ua(a,this.J);this.b=Array(this.o);for(b=0;b<this.o;b++)this.b[b]=a;B(this)}w(Ta);Ta.prototype.reset=function(){};Ta.prototype.Y=function(a,b){b||this.reset();return!0};
function Va(a,b,c,d){for(var e=b,f=c,h=e>>>a.c;0<f&&h<a.b.length;){var g=a.b[h],l=h*a.f,k=a.f-(e-l);k>f&&(k=f);if(g&&g.size){if(g.type==d){if(e+f<=g.qa)return g.Ia+=g.qa-e,g.qa=e,!0;if(e>=g.qa+g.Ia){k=g.size-(e-l);k>f&&(k=f);g.Ia=e-g.qa+k;e=l+a.f;f-=k;h++;continue}}return Wa(1,e,f)}e=new C(e,k,a.f,d);Ua(e,a.J,g);a.b[h++]=e;e=l+a.f;f-=k}return 0>=f?(a.status(Math.floor(c/1024)+"Kb "+Xa[d]+" at "+("0x"+n(b,4))),!0):Wa(2,b,c)}
Ta.prototype.F=function(a){return this.b[(a&this.i)>>>this.c].za(a&this.g,a)};function Ya(a,b){var c=b&a.g,d=(b&a.i)>>>a.c;return c!=a.g?a.b[d].yb(c,b):a.b[d++].za(c,b)|a.b[d&a.u].za(0,b+1)<<8}Ta.prototype.P=function(a,b){this.b[(a&this.i)>>>this.c].Aa(a&this.g,b&255,a)};function Za(a,b,c){a.b[(b&a.i)>>>a.c].hb(b&a.g,c&255,b)}function ab(a,b,c){var d=b&a.g,e=(b&a.i)>>>a.c;d!=a.g?a.b[e].zb(d,c&65535,b):(a.b[e++].Aa(d,c&255,b),a.b[e&a.u].Aa(0,c>>8&255,b+1))}
function Wa(a,b,c){r("Memory block error ("+a+": "+n(b)+","+n(c)+")");return!1}var bb;if(Oa){var cb=new ArrayBuffer(2);(new DataView(cb)).setUint16(0,256,!0);bb=256===(new Uint16Array(cb))[0]}else bb=!1;var db=bb;
function C(a,b,c,d){this.id=eb+=2;this.a=null;this.qa=a;this.Ia=b;this.size=c||0;this.type=d||fb;this.g=d==gb;Ua(this);this.T=this.Xa=!1;if(c)if(Oa)this.c=new ArrayBuffer(c),this.f=new DataView(this.c,0,c),this.b=new Uint8Array(this.c,0,c),this.o=new Uint16Array(this.c,0,c>>1),this.a=new Int32Array(this.c,0,c>>2),hb(this,db?ib:jb);else{this.a=Array(c>>2);for(a=0;a<this.a.length;a++)this.a[a]=0;hb(this,kb)}else hb(this)}var fb=0,gb=2,Xa=["NONE","RAM","ROM","VID","H/W"],eb=0;
C.prototype={constructor:C,parent:null,save:function(){var a,b;if(Oa)for(a=Array(this.size>>2),b=0;b<a.length;b++)a[b]=this.f.getInt32(b<<2,!0);else a=this.a;return a},restore:function(a){if(a&&this.size==a.length<<2){var b;if(Oa)for(b=0;b<a.length;b++)this.f.setInt32(b<<2,a[b],!0);else this.a=a;return this.T=!0}return!1},l:function(){return 255},m:function(){},B:function(a,b){return this.za(a++,b++)|this.za(a,b)<<8},u:function(a,b,c){this.Aa(a++,b&255,c++);this.Aa(a,b>>8,c)},C:function(a){return this.a[a>>
2]>>>((a&3)<<3)&255},L:function(a){var b=a>>2;a=(a&3)<<3;var c=this.a[b]>>a;return 24>a?c&65535:c&255|(this.a[b+1]&255)<<8},S:function(a,b){var c=a>>2,d=(a&3)<<3;this.a[c]=this.a[c]&~(255<<d)|b<<d;this.T=!0},pa:function(a,b){var c=a>>2,d=(a&3)<<3;24>d?this.a[c]=this.a[c]&~(65535<<d)|b<<d:(this.a[c]=this.a[c]&16777215|b<<24,c++,this.a[c]=this.a[c]&-256|b>>8);this.T=!0},A:function(a,b){return this.Na(a,b)},H:function(a,b){return this.fb(a,b)},Z:function(a,b,c){this.g||this.hb(a,b,c)},W:function(a,b,
c){this.g||this.aa(a,b,c)},s:function(a){return this.b[a]},G:function(a){return this.b[a]},D:function(a){return this.f.getUint16(a,!0)},K:function(a){return a&1?this.b[a]|this.b[a+1]<<8:this.o[a>>1]},M:function(a,b){this.b[a]=b;this.T=!0},$:function(a,b){this.b[a]=b;this.T=!0},V:function(a,b){this.f.setUint16(a,b,!0);this.T=!0},da:function(a,b){a&1?(this.b[a]=b,this.b[a+1]=b>>8):this.o[a>>1]=b;this.T=!0}};function Ua(a,b,c){a.J=b;a.i=a.j=0;c&&((a.i=c.i)&&lb(a,mb,!1),(a.j=c.j)&&nb(a,mb,!1))}
function nb(a,b,c){c&&a.j||(a.Aa=!a.g&&b[2]||a.m,a.zb=!a.g&&b[3]||a.u);if(c||void 0===c)a.hb=b[2]||a.m,a.aa=b[3]||a.u}function lb(a,b,c){c&&a.i||(a.za=b[0]||a.l,a.yb=b[1]||a.B);if(c||void 0===c)a.Na=b[0]||a.l,a.fb=b[1]||a.B}function hb(a,b){b||(b=ob);lb(a,b,void 0);nb(a,b,void 0)}var ob=[],kb=[C.prototype.C,C.prototype.L,C.prototype.S,C.prototype.pa],mb=[C.prototype.A,C.prototype.H,C.prototype.Z,C.prototype.W];
if(Oa)var jb=[C.prototype.s,C.prototype.D,C.prototype.M,C.prototype.V],ib=[C.prototype.G,C.prototype.K,C.prototype.$,C.prototype.da];
function pb(a,b){t.call(this,"CPU",a,pb);var c=a.cycles||b,d=a.multiplier||1;this.c={};this.c.oa=c;this.c.Ha=0;this.c.na=d;this.c.Ka=Math.round(this.c.oa/1E4)/100;this.c.ka=this.c.Ka*this.c.na;this.h.U=!1;this.h.Za=!1;this.h.Wa=a.autoStart;this.h.Ya=!1;this.h.Ba=!1;this.c.Fa=this.c.ma=0;this.c.Ga=a.csStart;this.c.sa=a.csInterval;this.c.ta=a.csStop;this.da=this.Oa.bind(this);B(this)}w(pb);var qb=["power","reset"];m=pb.prototype;
m.ca=function(a,b,c,d){this.u=a;this.o=b;this.J=d;for(b=0;b<qb.length;b++)(c=this.B[qb[b]])&&this.u.O(null,qb[b],c);this.$=(b=Ra(a,"Video"))&&Math.max(b.$,b.ib)||60;this.G=Ra(a,"ChipSet");a=rb(a,"autoStart");null!=a&&(this.h.Wa="true"==a?!0:"false"==a?!1:!!a);B(this)};m.reset=function(){this.c.Ha=0};m.save=function(){return null};m.restore=function(){return!1};
m.Y=function(a,b){if(!b){if(a&&this.restore){sb(this);if(!this.restore(a))return!1;tb(this)}else this.reset();this.R("No debugger detected")}ub(this);return!0};m.X=function(a){return a?this.save():!0};function vb(a){(a.h.Wa||void 0===a.B.run)&&a.Oa(!0)}m.$a=function(){return 0};function tb(a){void 0===a.c.Ga&&(a.c.Ga=0);void 0===a.c.sa&&(a.c.sa=-1);void 0===a.c.ta&&(a.c.ta=-1);a.h.Ba=0<=a.c.Ga&&0<a.c.sa;a.h.Ba&&(a.c.Fa=0,a.c.ma=a.c.Ga-a.M)}
m.O=function(a,b,c){var d=this;a=!1;switch(b){case "power":case "reset":this.B[b]=c;a=!0;break;case "run":this.B[b]=c;c.onclick=function(){var a;if(a=d.u)if(a=d.u,a.h.N)a=!0;else{var b=null,c,g=x(a.id);for(c=0;c<g.length&&(b=g[c],b===a||b.h.ja);c++);if(c==g.length)for(c=0;c<g.length&&(b=g[c],b===a||b.h.N);c++);c==g.length&&(b=a);r("The "+b.type+" component ("+b.id+") is not "+(b.h.ja?"powered yet":"ready yet"+(b.Da?" (waiting for notification)":""))+".");a=!1}a&&(d.h.U?wb(d,!0):d.Oa(!0))};a=!0;break;
case "speed":this.B[b]=c;a=!0;break;case "setSpeed":this.B[b]=c,c.onclick=function(){xb(d,d.c.na<<1,!0)},c.textContent=this.c.ka.toFixed(2)+"Mhz",a=!0}return a};function yb(a,b,c){a.M+=b;c&&(a.L=a.a=0)}
function zb(a,b){var c=30;c<a.$&&(c=a.$);2>c&&(c=2);var d=1;b&&1<a.c.na&&a.c.fa&&(d=a.c.fa/a.c.Ka);a.c.ab=Math.round(1E3/30);a.c.sb=Math.floor(a.c.oa/c*d);a.c.La=Math.floor(a.c.oa/30*d);a.c.cb=Math.floor(a.c.oa/a.$*d);a.c.bb=Math.floor(a.c.oa/2*d);b||(a.c.wa=a.c.La,a.c.va=a.c.cb,a.c.ua=a.c.bb);a.c.Ma=0}function Ab(a){return a.M+a.K+a.L-a.a}function sb(a){a.c.fa=0;a.M=a.K=a.L=a.a=0;tb(a);xb(a,1)}
function xb(a,b,c){if(void 0!==b){.8>a.c.fa/a.c.ka&&(b=1);a.c.na=b;b=a.c.Ka*a.c.na;if(a.c.ka!=b){a.c.ka=b;b=a.c.ka.toFixed(2)+"Mhz";var d=a.B.setSpeed;d&&(d.textContent=b);a.R("target speed: "+b)}c&&a.u&&Bb(a.u)}yb(a,a.K);a.K=0;a.c.la=ia();a.c.ga=0;zb(a)}
m.Oa=function(a){if(Ma(this,!0)){if(!this.h.U){xb(this);this.u&&this.u.start(this.c.la,Ab(this));this.h.U=!0;this.h.Za=!0;this.G&&this.G.start();var b=this.B.run;b&&(b.textContent="Halt");this.u&&(this.u.ha(!0),a&&Bb(this.u,!0))}this.c.Ma>=this.c.oa&&zb(this,!0);this.c.xa=0;this.c.Ea=ia();this.c.ga&&(a=this.c.Ea-this.c.ga,a>this.c.ab&&(this.c.la+=a,this.c.la>this.c.Ea&&(this.c.la=this.c.Ea)));try{do{this.gb(this.h.Ba?1:this.c.sb);var c=this.L-this.a;this.K+=c;this.c.xa+=c;yb(this,0,!0);a=c;this.h.Ba&&
(b=!1,this.c.Fa=this.c.Fa+this.$a()|0,this.c.ma-=a,0>=this.c.ma&&(this.c.ma+=this.c.sa,b=!0),0<=this.c.ta&&this.c.ta<=Ab(this)&&(this.c.sa=this.c.ta=-1,tb(this),wb(this),b=!0),b&&this.R(Ab(this)+" cycles: checksum="+n(this.c.Fa)));this.c.va-=c;0>=this.c.va&&(this.c.va+=this.c.cb,this.u&&Cb(this.u,this.c.Ha++),this.c.Ha>this.$&&(this.c.Ha=0));this.c.ua-=c;0>=this.c.ua&&(this.c.ua+=this.c.bb,this.u&&this.u.ha());this.c.wa-=c;if(0>=this.c.wa){this.c.wa+=this.c.La;break}}while(this.h.U)}catch(e){wb(this);
ub(this);this.u&&this.u.stop(ia(),Ab(this));Ma(this,!1);c=e.stack||e.message;this.h.ea=!0;this.I(c);return}c=setTimeout;a=this.da;this.c.ga=ia();b=this.c.ab;this.c.xa&&(b=Math.round(b*this.c.xa/this.c.La));var b=b-(this.c.ga-this.c.Ea),d=this.c.ga-this.c.la;d&&(this.c.fa=Math.round(this.K/(10*d))/100,864E5<=d&&(this.M=0,xb(this)));if(0>b||this.c.fa<this.c.ka)b=0;this.c.Ma+=this.c.xa;this.c.ga+=b;c(a,b)}else ub(this),this.u&&this.u.stop(ia(),Ab(this))};m.gb=function(){return 0};
function wb(a,b){a.h.ra&&(a.h.Ja=!0);a.L-=a.a;a.a=0;yb(a,a.K);a.K=0;if(a.h.U){a.h.U=!1;a.G&&a.G.stop();var c=a.B.run;c&&(c.textContent="Run")}a.h.Ca=b}function ub(a){a.u&&(Cb(a.u,-1),a.u.ha(void 0))}function Db(a){this.Z=+a.model||8080;pb.call(this,a,1E6);this.V=Eb;sb(this);this.h.Ca=this.h.nb=!1;this.aa=0;this.S=[];this.W=0;Fb(this)}w(Db,pb);function Gb(a,b){a.S.push(b)}m=Db.prototype;m.reset=function(){this.h.U&&wb(this);Fb(this);sb(this);this.h.ea=!1;this.parent.reset.call(this)};
function Fb(a){a.b=0;a.f=0;a.v=0;a.g=0;a.w=0;a.i=0;a.j=0;a.A=0;D(a,a.W);Hb(a,0);a.D=0}function Ib(a,b){a.W=b;D(a,b)}m.$a=function(){var a=this.b+this.f+this.v+this.g+this.w+this.i+this.j|0;return a=a+this.A+this.m+Jb(this)|0};
m.save=function(){var a=new E(this);F(a,0,[this.b,this.f,this.v,this.g,this.w,this.i,this.j,this.A,this.m,Jb(this)]);F(a,1,[this.D,this.M,this.c.na]);for(var b=this.o,c=0,d=[],e=0;e<b.o;e++){var f=b.b[e];if(f.T||f.Xa){d[c++]=e;var h=c++;a:if(f=f.save()){for(var g=0,l=0,k=[];g<f.length;){for(var u=f[g],q=g+1;q<f.length&&f[q]===u;)q++;k[l++]=q-g;k[l++]=u;g=q}if(k.length<f.length){f=k;break a}}d[h]=f}}F(a,2,d);return a.data()};
m.restore=function(a){var b=a[0];this.b=b[0];this.f=b[1];this.v=b[2];this.g=b[3];this.w=b[4];this.i=b[5];this.j=b[6];this.A=b[7]&65535;D(this,b[8]);Hb(this,b[9]);b=a[1];this.D=b[0];this.M=b[1];xb(this,b[3]);a:{b=this.o;a=a[2];var c;for(c=0;c<a.length-1;c+=2){var d=a[c],e=a[c+1];if(e&&e.length<b.A){for(var f=0,h=Array(b.A),g=0;g<e.length-1;)for(var l=e[g++],k=e[g++];l--;)h[f++]=k;e=h}f=b.b[d];if(!f||!f.restore(e)){r("Unable to restore memory block "+d);b=!1;break a}}b=!0}return b};
m.O=function(a,b,c){var d=!1;switch(b){case "A":case "B":case "C":case "BC":case "D":case "E":case "DE":case "H":case "L":case "HL":case "SP":case "PC":case "PS":case "IF":case "SF":case "ZF":case "AF":case "PF":case "CF":this.B[b]=c;this.aa++;d=!0;break;default:d=this.parent.O.call(this,a,b,c)}return d};function Kb(a){return a.f<<8|a.v}function Lb(a,b){a.f=b>>8&255;a.v=b&255}function G(a){return a.g<<8|a.w}function Mb(a,b){a.g=b>>8&255;a.w=b&255}function H(a){return a.i<<8|a.j}
function J(a,b){a.i=b>>8&255;a.j=b&255}function D(a,b){a.m=b&65535}function K(a){return a.l&256?1:0}function L(a,b){a.l=a.l&255|b}function Nb(a){return Pa[a.s&255]?4:0}function Jb(a){return a.H&-214|(a.s&128?128:0)|(a.l&255?0:64)|((a.s^a.C)&16?16:0)|Nb(a)|K(a)}function Hb(a,b){a.l=a.s=a.C=0;b&1&&(a.l|=256);b&4||(a.s|=1);b&16&&(a.C|=16);b&64||(a.l|=255);b&128&&(a.s^=192);a.H=a.H&-726|b&512|2}function N(a,b){a.C=a.b^b;return a.s=(a.l=a.b+b)&255}
function O(a,b){a.C=a.b^b;return a.s=(a.l=a.b+b+(a.l&256?1:0))&255}function P(a,b){a.l=a.s=a.C=a.b&b;(a.b|b)&8&&(a.C^=16);return a.l}function Ob(a,b){a.C=b^255;b=a.s=b+255&255;a.l=a.l&-256|b;return b}function Pb(a,b){a.C=b;b=a.s=b+1&255;a.l=a.l&-256|b;return b}function Q(a,b){return a.s=a.l=a.C=a.b|b}function R(a,b){b^=255;a.C=a.b^b;return a.s=(a.l=a.b+b+1^256)&255}function S(a,b){b^=255;a.C=a.b^b;return a.s=(a.l=a.b+b+(a.l&256?0:1)^256)&255}function T(a,b){return a.s=a.l=a.C=a.b^b}m.F=function(a){return this.o.F(a)};
m.P=function(a,b){this.o.P(a,b)};function U(a){var b=a.F(a.m);D(a,a.m+1);return b}function V(a){var b=Ya(a.o,a.m);D(a,a.m+2);return b}function W(a){var b=Ya(a.o,a.A);a.A=a.A+2&65535;return b}function X(a,b){a.A=a.A-2&65535;ab(a.o,a.A,b)}function Y(a,b,c,d){d=d||2;a.B[b]&&(void 0===c&&(a.h.ea=!0,a.I("Value for "+b+" is invalid"),wb(a)),c=!a.h.U||a.h.Ya?n(c,d):"--------".substr(0,d),a.B[b].textContent!=c&&(a.B[b].textContent=c))}
m.ha=function(a){this.aa&&(a||!this.h.U||this.h.Ya)&&(Y(this,"A",this.b),Y(this,"B",this.f),Y(this,"C",this.v),Y(this,"BC",Kb(this),4),Y(this,"D",this.g),Y(this,"E",this.w),Y(this,"DE",G(this),4),Y(this,"H",this.i),Y(this,"L",this.j),Y(this,"HL",H(this),4),Y(this,"SP",this.A,4),Y(this,"PC",this.m,4),a=Jb(this),Y(this,"PS",a,4),Y(this,"IF",a&512?1:0,1),Y(this,"SF",a&128?1:0,1),Y(this,"ZF",a&64?1:0,1),Y(this,"AF",a&16?1:0,1),Y(this,"PF",a&4?1:0,1),Y(this,"CF",a&1?1:0,1));if(a=this.B.speed)a.textContent=
this.h.U&&this.c.fa?this.c.fa.toFixed(2)+"Mhz":"Stopped"};m.gb=function(a){this.h.Ca=!0;this.h.nb=!1;this.h.Za=!1;this.L=this.a=a;do{if(a=this.D)this.D&8&&this.H&512?(a=199|(this.D&7)<<3,this.D&=-16,this.H&=-513,this.V[a].call(this),a=!0):a=!1,a=!a;if(a&&this.D&16){this.a=0;break}this.V[U(this)].call(this)}while(0<this.a);return this.h.Ca?this.L-this.a:void 0===this.h.Ca?0:-1};wa(function(){for(var a=z(document,"pc8080","cpu"),b=0;b<a.length;b++){var c=a[b],d=y(c),d=new Db(d);Ja(d,c)}});
function Qb(){this.a-=4}function Rb(){D(this,V(this));this.a-=10}function Sb(){D(this,W(this));this.a-=10}function Tb(){var a=V(this);X(this,this.m);D(this,a);this.a-=17}
var Eb=[Qb,function(){Lb(this,V(this));this.a-=10},function(){this.P(Kb(this),this.b);this.a-=7},function(){Lb(this,Kb(this)+1);this.a-=5},function(){this.f=Pb(this,this.f);this.a-=5},function(){this.f=Ob(this,this.f);this.a-=5},function(){this.f=U(this);this.a-=7},function(){var a=this.b<<1;this.b=a&255|a>>8;L(this,a&256);this.a-=4},Qb,function(){var a;J(this,a=H(this)+Kb(this));L(this,a>>8&256);this.a-=10},function(){this.b=this.F(Kb(this));this.a-=7},function(){Lb(this,Kb(this)-1);this.a-=5},function(){this.v=
Pb(this,this.v);this.a-=5},function(){this.v=Ob(this,this.v);this.a-=5},function(){this.v=U(this);this.a-=7},function(){var a=this.b<<8&256;this.b=(a|this.b)>>1;L(this,a);this.a-=4},Qb,function(){Mb(this,V(this));this.a-=10},function(){this.P(G(this),this.b);this.a-=7},function(){Mb(this,G(this)+1);this.a-=5},function(){this.g=Pb(this,this.g);this.a-=5},function(){this.g=Ob(this,this.g);this.a-=5},function(){this.g=U(this);this.a-=7},function(){var a=this.b<<1;this.b=a&255|K(this);L(this,a&256);this.a-=
4},Qb,function(){var a;J(this,a=H(this)+G(this));L(this,a>>8&256);this.a-=10},function(){this.b=this.F(G(this));this.a-=7},function(){Mb(this,G(this)-1);this.a-=5},function(){this.w=Pb(this,this.w);this.a-=5},function(){this.w=Ob(this,this.w);this.a-=5},function(){this.w=U(this);this.a-=7},function(){var a=this.b<<8;this.b=(K(this)<<8|this.b)>>1;L(this,a&256);this.a-=4},Qb,function(){J(this,V(this));this.a-=10},function(){var a=V(this);ab(this.o,a,H(this));this.a-=16},function(){J(this,H(this)+1);
this.a-=5},function(){this.i=Pb(this,this.i);this.a-=5},function(){this.i=Ob(this,this.i);this.a-=5},function(){this.i=U(this);this.a-=7},function(){var a=0,b=K(this);if((this.s^this.C)&16||9<(this.b&15))a|=6;if(b||154<=this.b)a|=96,b=1;this.b=N(this,a);L(this,b?256:0);this.a-=4},Qb,function(){var a;J(this,a=H(this)+H(this));L(this,a>>8&256);this.a-=10},function(){var a;a=V(this);a=Ya(this.o,a);J(this,a);this.a-=16},function(){J(this,H(this)-1);this.a-=5},function(){this.j=Pb(this,this.j);this.a-=
5},function(){this.j=Ob(this,this.j);this.a-=5},function(){this.j=U(this);this.a-=7},function(){this.b=~this.b&255;this.a-=4},Qb,function(){this.A=V(this)&65535;this.a-=10},function(){this.P(V(this),this.b);this.a-=13},function(){this.A=this.A+1&65535;this.a-=5},function(){var a=H(this);this.P(a,Pb(this,this.F(a)));this.a-=10},function(){var a=H(this);this.P(a,Ob(this,this.F(a)));this.a-=10},function(){this.P(H(this),U(this));this.a-=10},function(){this.l|=256;this.a-=4},Qb,function(){var a;J(this,
a=H(this)+this.A);L(this,a>>8&256);this.a-=10},function(){this.b=this.F(V(this));this.a-=13},function(){this.A=this.A-1&65535;this.a-=5},function(){this.b=Pb(this,this.b);this.a-=5},function(){this.b=Ob(this,this.b);this.a-=5},function(){this.b=U(this);this.a-=7},function(){L(this,K(this)?0:256);this.a-=4},function(){this.a-=5},function(){this.f=this.v;this.a-=5},function(){this.f=this.g;this.a-=5},function(){this.f=this.w;this.a-=5},function(){this.f=this.i;this.a-=5},function(){this.f=this.j;this.a-=
5},function(){this.f=this.F(H(this));this.a-=7},function(){this.f=this.b;this.a-=5},function(){this.v=this.f;this.a-=5},function(){this.a-=5},function(){this.v=this.g;this.a-=5},function(){this.v=this.w;this.a-=5},function(){this.v=this.i;this.a-=5},function(){this.v=this.j;this.a-=5},function(){this.v=this.F(H(this));this.a-=7},function(){this.v=this.b;this.a-=5},function(){this.g=this.f;this.a-=5},function(){this.g=this.v;this.a-=5},function(){this.a-=5},function(){this.g=this.w;this.a-=5},function(){this.g=
this.i;this.a-=5},function(){this.g=this.j;this.a-=5},function(){this.g=this.F(H(this));this.a-=7},function(){this.g=this.b;this.a-=5},function(){this.w=this.f;this.a-=5},function(){this.w=this.v;this.a-=5},function(){this.w=this.g;this.a-=5},function(){this.a-=5},function(){this.w=this.i;this.a-=5},function(){this.w=this.j;this.a-=5},function(){this.w=this.F(H(this));this.a-=7},function(){this.w=this.b;this.a-=5},function(){this.i=this.f;this.a-=5},function(){this.i=this.v;this.a-=5},function(){this.i=
this.g;this.a-=5},function(){this.i=this.w;this.a-=5},function(){this.a-=5},function(){this.i=this.j;this.a-=5},function(){this.i=this.F(H(this));this.a-=7},function(){this.i=this.b;this.a-=5},function(){this.j=this.f;this.a-=5},function(){this.j=this.v;this.a-=5},function(){this.j=this.g;this.a-=5},function(){this.j=this.w;this.a-=5},function(){this.j=this.i;this.a-=5},function(){this.a-=5},function(){this.j=this.F(H(this));this.a-=7},function(){this.j=this.b;this.a-=5},function(){this.P(H(this),
this.f);this.a-=7},function(){this.P(H(this),this.v);this.a-=7},function(){this.P(H(this),this.g);this.a-=7},function(){this.P(H(this),this.w);this.a-=7},function(){this.P(H(this),this.i);this.a-=7},function(){this.P(H(this),this.j);this.a-=7},function(){var a=this.m-1;if(this.S.length)for(var b=0;b<this.S.length;b++)if(this.S[b](a))return;this.D|=16;this.a-=7;this.H&512||wb(this)},function(){this.P(H(this),this.b);this.a-=7},function(){this.b=this.f;this.a-=5},function(){this.b=this.v;this.a-=5},
function(){this.b=this.g;this.a-=5},function(){this.b=this.w;this.a-=5},function(){this.b=this.i;this.a-=5},function(){this.b=this.j;this.a-=5},function(){this.b=this.F(H(this));this.a-=7},function(){this.a-=5},function(){this.b=N(this,this.f);this.a-=4},function(){this.b=N(this,this.v);this.a-=4},function(){this.b=N(this,this.g);this.a-=4},function(){this.b=N(this,this.w);this.a-=4},function(){this.b=N(this,this.i);this.a-=4},function(){this.b=N(this,this.j);this.a-=4},function(){this.b=N(this,this.F(H(this)));
this.a-=7},function(){this.b=N(this,this.b);this.a-=4},function(){this.b=O(this,this.f);this.a-=4},function(){this.b=O(this,this.v);this.a-=4},function(){this.b=O(this,this.g);this.a-=4},function(){this.b=O(this,this.w);this.a-=4},function(){this.b=O(this,this.i);this.a-=4},function(){this.b=O(this,this.j);this.a-=4},function(){this.b=O(this,this.F(H(this)));this.a-=7},function(){this.b=O(this,this.b);this.a-=4},function(){this.b=R(this,this.f);this.a-=4},function(){this.b=R(this,this.v);this.a-=
4},function(){this.b=R(this,this.g);this.a-=4},function(){this.b=R(this,this.w);this.a-=4},function(){this.b=R(this,this.i);this.a-=4},function(){this.b=R(this,this.j);this.a-=4},function(){this.b=R(this,this.F(H(this)));this.a-=7},function(){this.b=R(this,this.b);this.a-=4},function(){this.b=S(this,this.f);this.a-=4},function(){this.b=S(this,this.v);this.a-=4},function(){this.b=S(this,this.g);this.a-=4},function(){this.b=S(this,this.w);this.a-=4},function(){this.b=S(this,this.i);this.a-=4},function(){this.b=
S(this,this.j);this.a-=4},function(){this.b=S(this,this.F(H(this)));this.a-=7},function(){this.b=S(this,this.b);this.a-=4},function(){this.b=P(this,this.f);this.a-=4},function(){this.b=P(this,this.v);this.a-=4},function(){this.b=P(this,this.g);this.a-=4},function(){this.b=P(this,this.w);this.a-=4},function(){this.b=P(this,this.i);this.a-=4},function(){this.b=P(this,this.j);this.a-=4},function(){this.b=P(this,this.F(H(this)));this.a-=7},function(){this.b=P(this,this.b);this.a-=4},function(){this.b=
T(this,this.f);this.a-=4},function(){this.b=T(this,this.v);this.a-=4},function(){this.b=T(this,this.g);this.a-=4},function(){this.b=T(this,this.w);this.a-=4},function(){this.b=T(this,this.i);this.a-=4},function(){this.b=T(this,this.j);this.a-=4},function(){this.b=T(this,this.F(H(this)));this.a-=7},function(){this.b=T(this,this.b);this.a-=4},function(){this.b=Q(this,this.f);this.a-=4},function(){this.b=Q(this,this.v);this.a-=4},function(){this.b=Q(this,this.g);this.a-=4},function(){this.b=Q(this,this.w);
this.a-=4},function(){this.b=Q(this,this.i);this.a-=4},function(){this.b=Q(this,this.j);this.a-=4},function(){this.b=Q(this,this.F(H(this)));this.a-=7},function(){this.b=Q(this,this.b);this.a-=4},function(){R(this,this.f);this.a-=4},function(){R(this,this.v);this.a-=4},function(){R(this,this.g);this.a-=4},function(){R(this,this.w);this.a-=4},function(){R(this,this.i);this.a-=4},function(){R(this,this.j);this.a-=4},function(){R(this,this.F(H(this)));this.a-=7},function(){R(this,this.b);this.a-=4},
function(){this.l&255&&(D(this,W(this)),this.a-=6);this.a-=5},function(){Lb(this,W(this));this.a-=10},function(){var a=V(this);this.l&255&&D(this,a);this.a-=10},Rb,function(){var a=V(this);this.l&255&&(X(this,this.m),D(this,a),this.a-=6);this.a-=11},function(){X(this,Kb(this));this.a-=11},function(){this.b=N(this,U(this));this.a-=7},function(){X(this,this.m);D(this,0);this.a-=11},function(){this.l&255||(D(this,W(this)),this.a-=6);this.a-=5},Sb,function(){var a=V(this);this.l&255||D(this,a);this.a-=
10},Rb,function(){var a=V(this);this.l&255||(X(this,this.m),D(this,a),this.a-=6);this.a-=11},Tb,function(){this.b=O(this,U(this));this.a-=7},function(){X(this,this.m);D(this,8);this.a-=11},function(){K(this)||(D(this,W(this)),this.a-=6);this.a-=5},function(){Mb(this,W(this));this.a-=10},function(){var a=V(this);K(this)||D(this,a);this.a-=10},function(){for(var a=U(this),b=this.o,c=this.b,d=this.m+-2&65535,e=1,f=0;0<e;){var h=b.m[a],g=b.C[a]||1,l=1==g?255:2==g?65535:-1,l=(c>>>=f)&l;if(void 0!==h&&
h[0])h[0](a,l,d);f+=g<<3;a+=g;e-=g}this.a-=10},function(){var a=V(this);K(this)||(X(this,this.m),D(this,a),this.a-=6);this.a-=11},function(){X(this,G(this));this.a-=11},function(){this.b=R(this,U(this));this.a-=7},function(){X(this,this.m);D(this,16);this.a-=11},function(){K(this)&&(D(this,W(this)),this.a-=6);this.a-=5},Sb,function(){var a=V(this);K(this)&&D(this,a);this.a-=10},function(){for(var a=U(this),b=this.o,c=this.m+-2&65535,d=1,e=0,f=0;0<d;){var h=b.l[a],g=b.G[a]||1,l=1==g?255:2==g?65535:
-1,k=l;void 0!==h&&h[0]&&(k=h[0](a,c),void 0===k?k=l:k&=l);e|=k<<f;f+=g<<3;a+=g;d-=g}this.b=e&255;this.a-=10},function(){var a=V(this);K(this)&&(X(this,this.m),D(this,a),this.a-=6);this.a-=11},Tb,function(){this.b=S(this,U(this));this.a-=7},function(){X(this,this.m);D(this,24);this.a-=11},function(){Nb(this)||(D(this,W(this)),this.a-=6);this.a-=5},function(){J(this,W(this));this.a-=10},function(){var a=V(this);Nb(this)||D(this,a);this.a-=10},function(){var a=W(this);X(this,H(this));J(this,a);this.a-=
18},function(){var a=V(this);Nb(this)||(X(this,this.m),D(this,a),this.a-=6);this.a-=11},function(){X(this,H(this));this.a-=11},function(){this.b=P(this,U(this));this.a-=7},function(){X(this,this.m);D(this,32);this.a-=11},function(){Nb(this)&&(D(this,W(this)),this.a-=6);this.a-=5},function(){D(this,H(this));this.a-=5},function(){var a=V(this);Nb(this)&&D(this,a);this.a-=10},function(){var a=H(this);J(this,G(this));Mb(this,a);this.a-=5},function(){var a=V(this);Nb(this)&&(X(this,this.m),D(this,a),this.a-=
6);this.a-=11},Tb,function(){this.b=T(this,U(this));this.a-=7},function(){X(this,this.m);D(this,40);this.a-=11},function(){this.s&128||(D(this,W(this)),this.a-=6);this.a-=5},function(){var a=W(this);Hb(this,a&255|this.H&-256);this.b=a>>8;this.a-=10},function(){var a=V(this);this.s&128||D(this,a);this.a-=10},function(){this.H&=-513;this.a-=4},function(){var a=V(this);this.s&128||(X(this,this.m),D(this,a),this.a-=6);this.a-=11},function(){X(this,Jb(this)&255|this.b<<8);this.a-=11},function(){this.b=
Q(this,U(this));this.a-=7},function(){X(this,this.m);D(this,48);this.a-=11},function(){this.s&128&&(D(this,W(this)),this.a-=6);this.a-=5},function(){this.A=H(this)&65535;this.a-=5},function(){var a=V(this);this.s&128&&D(this,a);this.a-=10},function(){this.H|=512;this.a-=4},function(){var a=V(this);this.s&128&&(X(this,this.m),D(this,a),this.a-=6);this.a-=11},Tb,function(){R(this,U(this));this.a-=7},function(){X(this,this.m);D(this,56);this.a-=11}];
function Z(a){t.call(this,"ChipSet",a,Z);var b=a.model;b&&!Ub[b]&&r("Unrecognized ChipSet model: "+b);this.Z=Ub[b]||Vb;a.sound&&(this.m=null,window&&(this.m=window.AudioContext||window.webkitAudioContext),this.m&&new this.m);B(this)}w(Z);var Vb=1978.1,Ub={SI1978:Vb};m=Z.prototype;m.O=function(){return!1};
m.ca=function(a,b,c,d){this.o=b;this.a=c;this.J=d;this.u=a;if(this.Z==Vb){var e;a=Wb;void 0===e&&(e=0);for(var f in a){c=b;d=+f+e;var h=a[f].bind(this);if(void 0!==h)for(var g=+f+e;g<=d;g++)void 0!==c.l[g]?r("Input port 0x"+n(g,4)+" already registered"):c.l[g]=[h,!1]}var l;e=Xb;void 0===l&&(l=0);for(var k in e)if(f=b,a=+k+l,c=e[k].bind(this),void 0!==c)for(d=+k+l;d<=a;d++)void 0!==f.m[d]?r("Output port 0x"+n(d,4)+" already registered"):f.m[d]=[c,!1]}};
m.Y=function(a,b){if(!b)if(!a)this.reset();else if(!this.restore(a))return!1;return!0};m.X=function(a){return a?this.save():!0};m.reset=function(){this.j=14;this.b=8;this.g=this.i=this.f=this.c=this.l=0};m.save=function(){var a=new E(this);this.Z==Vb&&F(a,0,[this.j,this.b,this.l,this.c,this.f,this.g,this.i]);return a.data()};m.restore=function(a){a=a[0];this.Z==Vb&&(this.j=a[0],this.b=a[1],this.l=a[2],this.c=a[3],this.f=a[4],this.g=a[5],this.i=a[6]);return!0};m.start=function(){};m.stop=function(){};
function Yb(a,b,c){a.b&=~b;c&&(a.b|=b)}m.pb=function(){return this.j};m.qb=function(){return this.b};m.rb=function(){return this.l};m.ob=function(){return this.c>>8-this.f&255};m.tb=function(a,b){this.f=b};m.vb=function(a,b){this.g=b};m.ub=function(a,b){this.c=b<<8|this.c>>8};m.wb=function(a,b){this.i=b};m.xb=function(){};var Wb={0:Z.prototype.pb,1:Z.prototype.qb,2:Z.prototype.rb,3:Z.prototype.ob},Xb={2:Z.prototype.tb,3:Z.prototype.vb,4:Z.prototype.ub,5:Z.prototype.wb,6:Z.prototype.xb};
wa(function(){for(var a=z(document,"pc8080","chipset"),b=0;b<a.length;b++){var c=a[b],d=y(c),d=new Z(d);Ja(d,c)}});function Zb(a){t.call(this,"ROM",a,Zb);this.b=null;this.j=a.addr;this.c=a.size;this.l=a.writable;this.f=a.alias;this.g=a.file;this.m=da(this.g);if(this.g){a=this.g;var b=ea(this.m);"json"!=b&&"hex"!=b&&(a=la()+"/api/v1/dump?file="+this.g+"&format=bytes&decimal=true");var c=this;p(a,null,!0,function(a,b,f){$b(c,a,b,f)})}}w(Zb);var ac=[0,5];
Zb.prototype.ca=function(a,b,c,d){this.o=b;this.a=c;this.J=d;bc(this)};Zb.prototype.Y=function(){this.i&&(this.J&&this.J.a(this.id,this.j,this.c,this.i),delete this.i);return!0};Zb.prototype.X=function(){return!0};
function $b(a,b,c,d){if(d)a.I("Unable to load system ROM (error "+d+": "+b+")");else{Ha(a.pa,b,c);if("["==c.charAt(0)||"{"==c.charAt(0))try{var e=eval("("+c+")"),f=e.bytes,h=e.data;if(f)a.b=f;else if(h)for(a.b=Array(4*h.length),d=c=0;c<h.length;c++)a.b[d++]=h[c]&255,a.b[d++]=h[c]>>8&255,a.b[d++]=h[c]>>16&255,a.b[d++]=h[c]>>24&255;else a.b=e;a.i=e.symbols;if(!a.b.length){r("Empty ROM: "+b);return}if(1==a.b.length){r(a.b[0]);return}}catch(g){a.I("ROM data error: "+g.message);return}else for(b=c.replace(/\n/gm,
" ").replace(/ +$/,"").split(" "),a.b=Array(b.length),e=0;e<b.length;e++)a.b[e]=ca(b[e]);bc(a)}}
function bc(a){if(!Na(a))if(!a.g)B(a);else if(a.b&&a.o){a.c||(a.c=a.b.length);if(a.b.length!=a.c){var b="ROM size (0x"+n(a.b.length)+") does not match specified size ("+("0x"+n(a.c))+")";a.h.ea=!0;a.I(b)}else if(cc(a,a.j)){b=[];"number"==typeof a.f?b.push(a.f):null!=a.f&&a.f.length&&(b=a.f);for(var c=0;c<b.length;c++){for(var d=a,e=b[c],f=d.o,h=d.c,g=[],l=d.j>>>f.c;0<h&&l<f.b.length;)g.push(f.b[l++]),h-=f.f;f=d.o;d=d.c;h=0;for(e>>>=f.c;0<d&&e<f.b.length;){l=g[h++];if(!l)break;f.b[e++]=l;d-=f.f}}delete a.b}B(a)}}
function cc(a,b){if(Va(a.o,b,a.c,a.l?1:gb)){var c;for(c=0;c<a.b.length;c++)Za(a.o,b+c,a.b[c]);if(a.l&&256==b){for(c=0;c<ac.length;c++)Za(a.o,ac[c],118);Gb(a.a,function(a){return function(b){if(0<=ac.indexOf(b)){var c=!1,h=a.a,g=a.J;if(5==b)switch(c=!0,h.v){case 2:dc(a,String.fromCharCode(h.w));break;case 9:for(var l=G(h),k="",u=255;u--;){var q=a.a.F(l++);if(36==q)break;k+=String.fromCharCode(q)}dc(a,k);break;default:c=!1}c?Sb.call(h):g&&(a.R("\nCP/M vector 0x"+n(b,4)),D(h,b),wb(g));b=!0}else b=!1;
return b}}(a));Ib(a.a,b)}return!0}return!1}function dc(a,b){b=b.replace(/\r/g,"");a.ba&&(a.ba.value+=b,a.ba.scrollTop=a.ba.scrollHeight)}wa(function(){for(var a=z(document,"pc8080","rom"),b=0;b<a.length;b++){var c=a[b],d=y(c),d=new Zb(d);Ja(d,c)}});function ec(a){t.call(this,"RAM",a,ec);this.f=a.addr;this.c=a.size;this.b=!1}w(ec);m=ec.prototype;m.ca=function(a,b,c,d){this.o=b;this.a=c;this.J=d;B(this)};m.Y=function(a,b){b||this.reset();return!0};m.X=function(a){return a?this.save():!0};
m.reset=function(){!this.b&&this.c&&Va(this.o,this.f,this.c,1)&&(this.b=!0);this.b||r("No RAM allocated")};m.save=function(){return null};m.restore=function(){return!0};wa(function(){for(var a=z(document,"pc8080","ram"),b=0;b<a.length;b++){var c=a[b],d=y(c),d=new ec(d);Ja(d,c)}});function fc(a){t.call(this,"Keyboard",a,fc);this.reset();B(this)}w(fc);var gc={"1p":49,"2p":50,coin:51,left:37,right:39,fire:32},hc={65:37,68:39,76:32};fc.prototype.reset=function(){this.a={}};
fc.prototype.O=function(a,b,c){var d=this;a=a+"-"+b;if(void 0===this.B[a])switch(b){case "kbd":return c.onkeydown=function(a){return jc(d,a,!0)},c.onkeyup=function(a){return jc(d,a,!1)},!0;default:if(void 0!==gc[b])return this.B[a]=c,a=function(a,b){return function(){kc(a,b,!0)}}(this,b),b=function(a,b){return function(){kc(a,b,!1)}}(this,b),"ontouchstart"in window?(c.ontouchstart=a,c.ontouchend=b):(c.onmousedown=a,c.onmouseup=c.onmouseout=b),!0}return!1};
fc.prototype.ca=function(a,b,c,d){this.J=d;this.G=Ra(a,"ChipSet")};function jc(a,b,c){var d=!0,e;a:{e=b.keyCode;e=hc[e]||e;for(var f in gc)if(gc[f]===e){e=f;break a}e=null}e&&(d=kc(a,e,c));d||b.preventDefault();return d}function kc(a,b,c){a.a[b]=c;if(a.G)switch(b){case "1p":Yb(a.G,4,c);break;case "2p":Yb(a.G,2,c);break;case "coin":Yb(a.G,1,c);break;case "left":Yb(a.G,32,c);break;case "right":Yb(a.G,64,c);break;case "fire":Yb(a.G,16,c)}return!1}
wa(function(){for(var a=z(document,"pc8080","keyboard"),b=0;b<a.length;b++){var c=a[b],d=y(c),d=new fc(d);Ja(d,c)}});
function lc(a,b,c,d,e){var f=this;this.Qa=ra("Gecko/");var h=["","moz","ms","webkit"];t.call(this,"Video",a,lc);this.M=a.screenWidth;this.C=a.screenHeight;this.aa=a.bufferAddr;this.kb=a.bufferRAM;var g=a.bufferFormat;this.V=g&&mc[g.toLowerCase()]||nc;this.j=a.bufferCols;this.A=a.bufferRows;this.S=a.bufferBits||1;this.lb=a.bufferLeft||0;if(this.c=a.bufferRotate)this.c=this.c%360,0<this.c&&(this.c-=360),-90!=this.c&&(this.I("unsupported buffer rotation: "+this.c),this.c=0);this.ib=a.interruptRate;this.$=
a.refreshRate||60;this.i=b;this.g=c;this.D=(this.mb=d)||b||null;b=a.smoothing;(c=Ba.smoothing)&&(b="true"==c);if(null!=b)for(c=0;c<h.length;c++)if(d=(d=h[c])?d+"ImageSmoothingEnabled":"imageSmoothingEnabled",void 0!==this.g[d]){this.g[d]=b;break}if(this.f=a.screenRotate)this.f=this.f%360,0<this.f&&(this.f-=360),-90!=this.f?(this.I("unsupported screen rotation: "+this.f),this.f=0):(this.g.translate(0,this.C),this.g.rotate(this.f*Math.PI/180),this.g.scale(this.C/this.M,this.M/this.C));oc(this);b=this.j;
c=this.A;this.c&&(b=this.A,c=this.j);this.Sa=this.g.createImageData(b,c);this.l=document.createElement("canvas");this.l.width=b;this.l.height=c;this.jb=this.l.getContext("2d");if(this.b=e)if(this.b.ia=e.requestFullscreen||e.msRequestFullscreen||e.mozRequestFullScreen||e.webkitRequestFullscreen,this.b.ia){for(c=0;c<h.length;c++)if(d=h[c]+"fullscreenchange","on"+d in document){document.addEventListener(d,function(){pc(f,document.fullscreenElement||document.msFullscreenElement||document.mozFullScreenElement||
document.webkitFullscreenElement?!0:!1)},!1);break}for(c=0;c<h.length;c++)if(d=h[c]+"fullscreenerror","on"+d in document){document.addEventListener(d,function(){pc(f,null)},!1);break}}if(this.m=a.fontROM)"json"!=ea(this.m)&&(this.m=la()+"/api/v1/dump?file="+this.m+"&format=bytes"),p(this.m,null,!0,function(a,b,c){qc(f,a,b,c)})}w(lc);var nc=0,mc={vt100:2};
lc.prototype.ca=function(a,b,c,d){this.u=a;this.o=b;this.a=c;this.J=d;this.V||(this.G=Ra(a,"ChipSet"))&&this.G.Z==Vb&&(this.V=1,oc(this));!this.kb&&(this.W=(this.j*this.S>>3)*this.A,Va(this.o,this.aa,this.W,3)&&(this.Ta=this.W>>1,this.Ua=16/this.S|0,this.da=!1,void 0===this.L||this.L.length!=this.Ta))&&(this.L=Array(this.Ta));(this.H=Ra(a,"Keyboard"))&&this.i&&this.H.O(this.mb?"textarea":"canvas","kbd",this.D);this.m||B(this)};
function qc(a,b,c,d){if(d)a.I("Unable to load font ROM (error "+d+": "+b+")");else{Ha(a.pa,b,c);try{var e=eval("("+c+")"),f=e.bytes||e;if(!f.length){r("Empty font ROM: "+b);return}if(1==f.length){r(f[0]);return}if(2048!=f.length){a.I("Unrecognized font data length ("+f.length+")");return}}catch(h){a.I("Font ROM data error: "+h.message);return}(a.g||a.J)&&B(a)}}
lc.prototype.O=function(a,b,c){var d=this;switch(b){case "fullScreen":return this.B[b]=c,this.b&&this.b.ia?c.onclick=function(){d.ia()}:c.parentNode.removeChild(c),!0}return!1};
lc.prototype.ia=function(){var a=!1;if(this.b){if(this.b.ia){a="100%";if(screen&&screen.width&&screen.height){var b=screen.width/screen.height,c=this.M/this.C;b>c&&(a=Math.round(c/b*100)+"%")}this.Qa?(this.i.style.width=a,this.i.style.width=a,this.i.style.display="block",this.i.style.margin="auto"):(this.b.style.width=a,this.b.style.height="auto");this.b.style.backgroundColor="black";this.b.ia();a=!0}this.D&&this.D.focus()}return a};
function pc(a,b){!b&&a.b&&(a.Qa?a.i.style.width=a.i.style.height="":a.b.style.width=a.b.style.height="")}function oc(a){a.K=1<<a.S;a.s=Array(a.K+2);a.s[0]=[0,0,0,255];a.s[1]=[255,255,255,255];1==a.V&&(a.s[a.K+0]=[255,255,0,255],a.s[a.K+1]=[0,255,0,255])}
wa(function(){for(var a=z(document,"pc8080","video"),b=0;b<a.length;b++){var c=a[b],d=y(c),e=document.createElement("canvas");if(void 0===e||!e.getContext){c.innerHTML="<br/>Missing &lt;canvas&gt; support. Please try a newer web browser.";break}e.setAttribute("class","pcjs-canvas");e.setAttribute("width",d.screenWidth);e.setAttribute("height",d.screenHeight);e.style.backgroundColor=d.screenColor;e.style.height="auto";0<=(window?window.navigator.userAgent:"").indexOf("MSIE")&&(c.onresize=function(a,
b,c,d){return function(){b.style.height=(a.clientWidth*d/c|0)+"px"}}(c,e,d.screenWidth,d.screenHeight),c.onresize());var f=+(d.aspect||Ba.aspect);f&&.3<=f&&3.33>=f&&(va("onresize",function(a,b,c){return function(){b.style.height=(a.clientWidth/c|0)+"px"}}(c,e,f)),window.onresize());c.appendChild(e);f=document.createElement("textarea");ra("iOS")&&(f.setAttribute("autocapitalize","off"),f.setAttribute("autocorrect","off"));c.appendChild(f);var h=e.getContext("2d"),d=new lc(d,e,h,f,c);Ja(d,c)}});
function E(a,b,c){this.id=a.id;this.key=rc(a,b,c);this.J=a.J;sc(this,a.eb)}function rc(a,b,c){a=a.id;if(b){var d=b.indexOf(".");0<d&&(a+=".v"+b.substr(0,d))}c&&(a+="."+c);return a}
E.prototype={constructor:E,value:function(){return this[this.id]},data:function(){return this[this.id]},toString:function(){var a=this[this.id];return"string"==typeof a?a:JSON.stringify(a)},clear:function(a){sc(this);var b=[];try{for(var c=0,d=window.localStorage.length;c<d;c++)b.push(window.localStorage.key(c))}catch(e){}for(c=0;c<b.length;c++)if((d=b[c])&&(a||d.substr(0,this.key.length)==this.key)){try{window.localStorage.removeItem(d)}catch(e){}b.splice(c,1);c=0}}};
function sc(a,b){a[a.id]={};b&&F(a,"parms",b);a.a=!1}function tc(a){var b=!0;if(oa()){var c=JSON.stringify(a[a.id]);qa(a.key,c)||(r("Unable to store "+c.length+" bytes in browser local storage"),b=!1)}return b}function uc(a){var b=!0;try{a[a.id]=JSON.parse(a[a.id])}catch(c){r(c.message||c),b=!1}return b}function vc(a,b){return b?(a[a.id]=b,a.a=!0):a.a?!0:oa()&&(b=pa(a.key))?(a[a.id]=b,a.a=!0):!1}function wc(a,b){return a[a.id][b]||null}function F(a,b,c){try{a[a.id][b]=c}catch(d){}}
function xc(a,b,c){t.call(this,"Computer",a,xc);this.h.N=!1;yc(this,b);this.G=rb(this,"autoPower",a);this.f=0;this.K=a.busWidth||a.buswidth;this.b=zc;this.s=null;this.l=this.H=!1;this.L=rb(this,"url")||"";(Math.random()+.1).toString(36);this.c=Ac(this);if(this.a=Ia("CPU",this.id)){this.J=Ia("Debugger",this.id);this.j=[];for(b=null;b=Ra(this,"Video",b);)this.j.push(b);this.o=new Ta({id:this.pa+".bus",busWidth:this.K},this.a,this.J);var d,e=x(this.id);if((this.g=Ia("Panel",this.id))&&this.g.ba)for(b=
0;b<e.length;b++)d=e[b],d.I=this.g.I,d.R=this.g.R,d.ba=this.g.ba;this.R("PC8080 v1.23.3\nCopyright \u00a9 2012-2016 Jeff Parsons <Jeff@pcjs.org>\nLicense: GPL version 3 or later <http://gnu.org/licenses/gpl.html>");for(b=0;b<e.length;b++)d=e[b],d.ca&&d.ca(this,this.o,this.a,this.J);b=null;d=a.resume;void 0!==d&&(1<d.length?b=this.u=d:this.b=parseInt(d,10));var f;if(a=rb(this,"state")||(f=!0,a.state))b=this.C=a,f||(this.l=!0,this.b=zc),this.b&&(this.A=new E(this,"1.23.3"),vc(this.A)?b=null:delete this.A);
!b&&this.b&&(b=Bc(this))&&(this.l=!0);if(b){var h=this;p(b,null,!0,function(a,b,c){c?(h.u=null,h.l=!1,h.I("Unable to load machine state from server (error "+c+(b?": "+(String.prototype.trim?b.trim():b.replace(/^\s+|\s+$/g,"")):"")+")")):(h.s=b,h.H=!0);B(h)})}else B(this);this.B.power||(this.G=!0);!c&&this.G&&Cc(this,this.ya)}else r("Unable to find CPU component")}w(xc);var zc=0;
function yc(a,b){if(!b){var c;if("object"==typeof resources&&(c=resources.parms))try{b=eval("("+c+")")}catch(d){r(d.message+" ("+c+")")}}a.m=b}function rb(a,b,c){var d=b.toLowerCase(),d=Ba[b]||Ba[d];void 0===d&&a.m&&(d=a.m[b]);void 0===d&&c&&(d=c[b]);void 0===d&&"object"==typeof resources&&resources[b]&&(d=b);return d}function Cc(a,b,c){for(var d=x(a.id),e=0;e<=d.length;e++){var f=e<d.length?d[e]:a;if(!Na(f)){Na(f,function(){Cc(a,b,c)});return}}b.call(a,c)}
function Dc(a,b){var c=new E(a,"1.23.3","validate");if(vc(c)&&uc(c)){var d=wc(c,"timestamp"),e=b?wc(b,"timestamp"):"unknown";d!=e&&(a.I("Machine state may be out-of-date\n("+d+" vs. "+e+")\nCheck your browser's local storage limits"),b||c.clear())}}m=xc.prototype;
m.ya=function(a){void 0===a&&(a=this.b||(this.s?1:zc));if(!this.f){this.f++;var b=!1,c=!1;this.D=!1;var d=this.A||new E(this,"1.23.3");if(-1==a)b=!0;else if(a>zc){if(vc(d,this.s)){this.i=new E(this,"1.23.3","failsafe");vc(this.i)&&(Ec(this,d),a=2,sc(this.i));F(this.i,"timestamp",ka());tc(this.i);var e=this.b&&!this.l;if(1==a||ma("Click OK to restore the previous PC8080 machine state, or CANCEL to reset the machine.")){if(c=uc(d)){var f=wc(d,"code"),h=wc(d,"data");f&&("ok"==f?vc(d,h):("error"==f&&
"no machine state"!=h?(this.I("Error: "+h),"unable to verify user"==h&&(qa("user",""),this.c=null)):this.R(f+": "+h),sc(d),vc(d)?(c=uc(d),e=!0):c=!1))}e&&Dc(this,c?d:null)}else 2==a&&d.clear()}else Dc(this);delete this.s;delete this.A}e=x(this.id);for(f=0;f<e.length;f++)h=e[f],h!==this&&h!=this.a&&(c=Fc(this,h,d,b,c));b=[d,a,c];-1!=a?Cc(this,this.Va,b):this.Va(b)}};
function Fc(a,b,c,d,e){if(!b.h.N){b.h.N=!0;if(b.Y){var f=null;e&&((f=wc(c,b.id))||(f=wc(c,b.id.replace(/[a-z0-9]\./i,"."))));"string"===typeof f&&(f=null);!b.Y(f,d)&&f&&(r("Unable to restore state for "+b.type),a.C&&!a.H?(c.clear(),a.b=zc,window&&window.location.reload()):a.D=!0,b.Y(null),e=!1)}if(!d&&b.Pa)for(a=b.Pa.split("|"),c=0;c<a.length;c++)b.status(a[c])}return e}
m.Va=function(a){var b=a[0],c=0>a[1];a=a[2];this.M=!0;this.h.N=!0;var d=this.B.power;d&&(d.textContent="Shutdown");this.a&&(Fc(this,this.a,b,c,a),vb(this.a));this.D&&(Ec(this,b),b.clear());!c&&this.i&&(this.i.clear(),delete this.i);this.f=0};
function Ec(a,b){if(ma("There may be a problem with your PC8080 machine.\n\nTo help us diagnose it, click OK to send this PC8080 machine state to http://www.pcjs.org.")){var c=a.c||"",d=b.toString(),e={app:"PC8080",ver:"1.23.3"};e.url=a.L;e.user=c;e.type="bug";e.data=d;p("http://www.pcjs.org/api/v1/report",e,!0)}}
function Gc(a,b,c){var d,e="none";if(a.f)return null;a.f--;var f=new E(a,"1.23.3"),h=new E(a,"1.23.3","validate"),g=ka();F(h,"timestamp",g);F(f,"timestamp",g);F(f,"version","1.23.3");F(f,"url",window?window.location.href:null);F(f,"browser",window?window.navigator.userAgent:"");a.a&&a.a.X&&(c&&wb(a.a),d=a.a.X(b,c),"object"===typeof d&&F(f,a.a.id,d),c&&(a.a.h.N=!1,!1===d&&(e=null)));for(var g=x(a.id),l=0;l<g.length;l++){var k=g[l];k.h.N&&(k.X&&(d=k.X(b,c),"object"===typeof d&&F(f,k.id,d)),c&&(k.h.N=
!1,!1===d&&(e=null)))}e&&(c?(g=d=!1,b?(a.c&&Hc(a,a.c,f.toString()),tc(h)&&tc(f)||(e=null,d=g=!0)):a.b&&(d=!0,g=3==a.b),d&&f.clear(g)):e=f.toString());c&&(a.h.N=!1,b=a.B.power)&&(b.textContent="Power");a.f=0;return e}m.reset=function(){this.o&&this.o.reset&&this.o.reset();for(var a=x(this.id),b=0;b<a.length;b++){var c=a[b];c!==this&&c!==this.o&&c.reset&&c.reset()}};m.start=function(a,b){for(var c=x(this.id),d=0;d<c.length;d++){var e=c[d];"CPU"!=e.type&&e!==this&&e.start&&e.start(a,b)}};
m.stop=function(a,b){for(var c=x(this.id),d=0;d<c.length;d++){var e=c[d];"CPU"!=e.type&&e!==this&&e.stop&&e.stop(a,b)}};
m.O=function(a,b,c){var d=this;switch(b){case "power":return this.B[b]=c,c.onclick=function(){d.f||(d.h.N?Gc(d,!1,!0):Cc(d,d.ya))},!0;case "reset":return this.B[b]=c,c.onclick=function(){if(d.h.N&&!d.f)if(d.b&&!d.u){var a=ma("Click OK to save changes to this PC8080 machine.\n\nWARNING: If you CANCEL, all disk changes will be discarded.");Gc(d,a,!0);!a&&d.C?window&&window.location.reload():d.ya(zc)}else d.reset(),d.a&&vb(d.a)},!0;case "save":if(fa(la(),"pcjs.org")){c.parentNode.removeChild(c);break}this.B[b]=
c;c.onclick=function(){var a=Ac(d,!0);if(a){var b=!!(d.b&&!d.u||d.C),c=Gc(d,b);b?Hc(d,a,c):d.I("Resume disabled, machine state not saved")}};return!0}return!1};
function Ac(a,b){var c=a.c;c||(c=pa("user"),void 0!==c?!c&&b&&(c=null,window&&(c=window.prompt("Saving machine states on the pcjs.org server is currently unsupported.\n\nIf you're running your own server, enter your user ID below.","")),c&&((c=Ic(a,c))||a.I("The user ID is invalid."))):b&&a.I("Browser local storage is not available"));return c}
function Ic(a,b){a.c=null;var c=p(la()+"/api/v1/user?req=verify&user="+b),d=c[1];if(!c[0]&&d)try{c=eval("("+d+")"),c.code&&"ok"==c.code&&(qa("user",c.data),a.c=c.data)}catch(e){r(e.message+" ("+d+")")}return a.c}function Bc(a){var b=null;a.c&&(b=la()+"/api/v1/user?req=load&user="+a.c+"&state="+rc(a,"1.23.3"));return b}
function Hc(a,b,c){if(c){var d={req:"store"};d.user=b;d.state=rc(a,"1.23.3");d.data=c;b=p(la()+"/api/v1/user",d);d=b[0];if(b[1]){if(d){var e=d.indexOf("\n");0<e&&(d=d.substr(0,e));d.indexOf("Error: ")||(d=d.substr(7))}d='{"code":'+b[1]+',"data":"'+d+'"}'}b=JSON.parse(d);b&&"ok"==b.code?a.I("Machine state saved to server"):c&&(c=b&&b.data||"unable to save machine state",c="error"==b.code?"Error: "+c:"Error "+b.code+": "+c,a.I(c),qa("user",""),a.c=null)}}
function Ra(a,b,c){a=x(a.id);for(var d=0;d<a.length;d++){var e=a[d];if(c)c==e&&(c=null);else if(e.type==b)return e}return null}function Bb(a,b){if(a.j.length){var c=0,d=0;b&&window&&(c=window.scrollX,d=window.scrollY);var e=a.j[0];e.D&&e.D.focus();b&&window&&window.scrollTo(c,d)}}m.ha=function(a){this.a&&this.a.ha(a);this.g&&this.g.ha(a)};
function Cb(a,b){for(var c=0;c<a.j.length;c++){var d=a.j[c],e=!0;if(0<=b){if(b&1)e=d.a,e.D=e.D&-8|10,e=!1;else{var f=d.a;f.D=f.D&-8|9}if(f=e&&d.da){for(var f=d.o,h=d.W,g=!0,l=d.aa>>>f.c;0<h&&l<f.b.length;)f.b[l].T&&(f.b[l].T=g=!1,f.b[l].Xa=!0),h-=f.f,l++;f=g}f&&(e=!1)}if(e){var g=d.aa,l=g+d.W,k=0,u=0,q=0,e=d.j,ja=0,f=d.A,ic=h=0,Ka=d.S,Oc=(1<<Ka)-1;d.lb&&(Ka=-Ka,ic=16+Ka);for(;g<l;){var A;A=d.o;var aa=g,La=aa&A.g,M=(aa&A.i)>>>A.c;A=La!=A.g?A.b[M].fb(La,aa):A.b[M++].Na(La,aa)|A.b[M&A.u].Na(0,aa+1)<<
8;if(d.da&&A===d.L[k])u+=d.Ua;else{d.L[k]=A;(aa=ic)&&(A=A>>8|(A&255)<<8);u<e&&(e=u);for(La=d.Ua;La--;){var ba=A>>aa&Oc,M=d.Sa,I=u++,$a=ba,ba=void 0,ba=d.c?(M.height-I-1)*M.width+q:I+q*M.width;$a&&1==d.V&&(208<=I&&236>I?$a=d.K+0:28<=I&&72>I&&($a=d.K+1));I=d.s[$a];ba*=I.length;M.data[ba]=I[0];M.data[ba+1]=I[1];M.data[ba+2]=I[2];M.data[ba+3]=I[3];aa+=Ka}u>ja&&(ja=u);q<f&&(f=q);q>=h&&(h=q+1)}g+=2;k++;if(u>=d.j&&(u=0,q++,q>d.A))break}d.da=!0;e<d.j&&(g=ja-e,h-=f,d.c&&(l=e,k=g,e=f,g=h,f=d.j-(l+k),h=k),d.jb.putImageData(d.Sa,
0,0,e,f,g,h),d.g.drawImage(d.l,0,0,d.l.width,d.l.height,0,0,d.M,d.C))}}}wa(function(){for(var a=z(document,"pc8080-machine"),b=0;b<a.length;b++)for(var c=a[b],d=y(c),c=z(c,"pc8080","computer"),e=0;e<c.length;e++){var f=c[e],h=y(f),h=new xc(h,d,!0);Ja(h,f);h.G&&Cc(h,h.ya)}});sa.show.push(function(){for(var a=z(document,"pc8080","computer"),b=0;b<a.length;b++){var c=y(a[b]);(c=Ia("Computer",c.id))&&c.M&&!c.h.N&&c.ya(-1)}});
sa.exit.push(function(){for(var a=z(document,"pc8080","computer"),b=0;b<a.length;b++){var c=y(a[b]);(c=Ia("Computer",c.id))&&c.h.N&&Gc(c,!(!c.b||c.u),!0)}});var Jc=0;function Kc(a,b,c,d,e,f){e("Loading "+a+"...");p(a,null,!0,function(h,g,l){l?(g||(g="unable to load "+a+" ("+l+")"),f(g,null)):Lc(g,a,b,c,d,e,f)})}
function Lc(a,b,c,d,e,f,h){function g(a,f){if(f)h(f,null);else{if(c){Ha(c,b,a);var g=b;g&&0>g.indexOf("/")&&"/"==window.location.pathname.slice(-1)&&(g=window.location.pathname+g);d?"}"==d.slice(-1)?(d=d.slice(0,-1),1<d.length&&(d+=",")):d='{state:"'+d+'",':d="{";d+='url:"'+g+'"}';"object"==typeof resources&&(g=null);a=a.replace(/(<machine[^>]*\sid=)(['"]).*?\2/,"$1$2"+c+"$2"+(d?" parms='"+d+"'":"")+(g?' url="'+g+'"':""))}e||(a=a.replace(/(<xsl:variable name="APPCLASS">).*?(<\/xsl:variable>)/,"$1pc8080$2"));
g=null;if("<"==a.charAt(0))try{e||(a=a.replace(/<!DOCTYPE(.|[\r\n])*]>\s*/g,"")),window.ActiveXObject||"ActiveXObject"in window?(g=new window.ActiveXObject("Microsoft.XMLDOM"),g.async=!1,g.loadXML(a)):g=(new window.DOMParser).parseFromString(a,"text/xml")}catch(q){g=null,a=q.message}else a="unrecognized XML: "+(255<a.length?a.substr(0,255)+"...":a);h(a,g)}}a?e?Mc(a,f,g):g(a,null):h("no data"+(b?" for file: "+b:""),null)}
function Mc(a,b,c){var d;if(d=/<([a-z]+)\s+ref="(.*?)"(.*?)\/>/g.exec(a)){var e=d[2];b("Loading "+e+"...");p(e,null,!0,function(f,h,g){if(g||!h)c(a,"unable to resolve XML reference: "+d[0]+" ("+g+")");else{if(f=d[3])if(g=h.match(new RegExp("<"+d[1]+"[^>]*>"))){for(var l=g[0],k,u=/( [a-z]+=)(['"])(.*?)\2/g;k=u.exec(f);)l=0>l.indexOf(k[1])?l.replace(">",k[0]+">"):l.replace(new RegExp(k[1]+"(['\"])(.*?)\\1"),k[0]);g[0]!=l&&(h=h.replace(g[0],l))}else{c(a,"missing <"+d[1]+"> in "+e);return}h=h.replace(/<\?xml[^>]*>[\r\n]*/,
"");a=a.replace(d[0],h);Mc(a,b,c)}})}else c(a,null)}
function Nc(a,b,c,d){function e(a){if(void 0===g){var b=h&&z(h,"machine-warning");g=b&&b[0]||h}g&&(g.innerHTML=ha(a))}function f(a){e("Error: "+a);l&&(--Jc||ya(!0));l=!1}var h,g,l=!0;Jc++;Ga[a]={};try{if(h=document.getElementById(a)){var k;if("object"==typeof resources&&(k=resources.css)){var u=document.head||document.getElementsByTagName("head")[0],q=document.createElement("style");q.type="text/css";q.styleSheet?q.styleSheet.cssText=k:q.appendChild(document.createTextNode(k));u.appendChild(q)}c||
(c="/versions/pc8080/1.23.3/components.xsl");k=function(d,g){g?Kc(c,null,null,!1,e,function(d,k){if(k)if(Ha(a,c,d),e("Processing "+b+"..."),window.ActiveXObject||"ActiveXObject"in window){var l=g.transformNode(k);l?(h.outerHTML=l,--Jc||ya(!0)):f("transformNodeToObject failed")}else document.implementation&&document.implementation.createDocument?(l=new XSLTProcessor,l.importStylesheet(k),(l=l.transformToFragment(g,document))?h.parentNode?(h.parentNode.replaceChild(l,h),--Jc||ya(!0)):f("invalid machine element: "+
a):f("transformToFragment failed")):f("unable to transform XML: unsupported browser");else f(d)}):f(d)};"<"!=b.charAt(0)?Kc(b,a,d,!0,e,k):Lc(b,null,a,d,!1,e,k)}else f("missing machine element: "+a)}catch(ja){f(ja.message)}return l}window.embedPC8080=function(a,b,c,d){ya(!1);return Nc(a,b,c,d)};window.enableEvents=ya;window.sendEvent=za;
function Pc(a,b,c,d){if(!c&&b){d.push(b);a=Ga[d[0]];b=null;for(var e in a)if(fa(e,"components.xsl")){b=e.replace(".xsl",".css");break}b?p(b,null,!0,function(a,b){Qc(b,d)}):Qc(null,d)}else r("Error ("+c+") requesting "+a)}
function Qc(a,b){var c,d,e,f=b[0],h=b[1];c=b[4];c=c.match(/^(\s*\(function\(\)\{)([\s\S]*)(}\)\(\);\s*)$/);var g=Ga[f],l={},k;for(k in g){var u=g[k],q=ea(k);if("xml"==q){for(q=/[ \t]*<disk [^>]*path=(['"])(.*?)\1.*?<\/disk>\n?/g;d=q.exec(g[k]);){var ja=d[2];ja&&(g[ja]||(u=u.replace(d[0],"")))}d=k=da(k)}else"xsl"==q&&(e=k=da(k));l[k]=u}a&&(l[k="css"]=a);b[2]&&(l[k="parms"]=b[2]);b[3]&&(l[k="state"]=b[3]);d&&e?(k=JSON.stringify(l),h+=".js",c=c[1]+"var resources="+k+";"+c[2]+c[3],c=c.replace(/\u00A9/g,
"&#xA9;"),k=h,g=null,l="data:application/javascript,",l=ra("Firefox")?l+encodeURIComponent(c):l+encodeURI(c),k&&(g=document.createElement("a"),"string"!=typeof g.download&&(g=null)),g?(g.href=l,g.download=k,document.body.appendChild(g),g.click(),document.body.removeChild(g),c="Check your Downloads folder for "+k+"."):(window.open(l),c="Check your browser for a new window/tab containing the requested data"+(k?" ("+k+")":"")+"."),c+=', copy it to your web server as "'+h+'", and then add the following to your web page:\n\n',
c+='<div id="'+f+'"></div>\n',c+="...\n",c+='<script type="text/javascript" src="'+h+'">\x3c/script>\n',c+='<script type="text/javascript">embedPC("'+f+'","'+d+'","'+e+'");\x3c/script>\n\n',c+="The machine should appear where the <div> is located.",r(c)):r("Missing XML/XSL resources")}
window.savePC=function(a,b,c){var d=Ia("Computer",a),e=Ia("Debugger",a);if(d){var f=Gc(d,!0),h=d.m?JSON.stringify(d.m):null;b||(b="/versions/pcjs/1.23.3/pc"+(e?"-dbg":"")+".js");if(c&&c({state:f,eb:h}))return!0;p(b,null,!0,function(c,d,e){Pc(c,d,e,[a,da(b,!0),h,f])});return!0}r("Unable to identify machine '"+a+"'");return!1};})();
